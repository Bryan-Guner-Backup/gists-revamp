<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>part-4-store</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<p><a href="../official/index.html" class="navbar__brand"><strong>Redux</strong></a></p>
<p><a href="../official/introduction/getting-started.html" class="navbar__item navbar__link">Getting Started</a><a href="../essentials/part-1-overview-concepts.html" class="navbar__item navbar__link">Tutorial</a><a href="../official/api/api-reference.html" class="navbar__item navbar__link">API</a><a href="../official/faq.html" class="navbar__item navbar__link">FAQ</a><a href="../official/style-guide/style-guide.html" class="navbar__item navbar__link">Best Practices</a><a href="../official/../github.com/reduxjs/redux.html" class="navbar__item navbar__link">GitHub</a><a href="../official/introduction/getting-started.html#help-and-discussion" class="navbar__item navbar__link">Need help?</a> <a href="../official/index.html" class="navbar__brand"><strong>Redux</strong></a></p>
<ul>
<li><a href="../official/introduction/getting-started.html" class="menu__link">Getting Started</a></li>
<li><a href="../essentials/part-1-overview-concepts.html" class="menu__link">Tutorial</a></li>
<li><a href="../official/api/api-reference.html" class="menu__link">API</a></li>
<li><a href="../official/faq.html" class="menu__link">FAQ</a></li>
<li><a href="../official/style-guide/style-guide.html" class="menu__link">Best Practices</a></li>
<li><a href="../official/../github.com/reduxjs/redux.html" class="menu__link">GitHub</a></li>
<li><p><a href="../official/introduction/getting-started.html#help-and-discussion" class="menu__link">Need help?</a></p></li>
<li><a href="#!" class="menu__link menu__link--sublist">Introduction</a>
<ul>
<li><a href="../official/introduction/getting-started.html" class="menu__link">Getting Started with Redux</a></li>
<li><a href="../official/introduction/installation.html" class="menu__link">Installation</a></li>
<li><a href="../official/introduction/core-concepts.html" class="menu__link">Core Concepts</a></li>
<li><a href="../official/introduction/learning-resources.html" class="menu__link">Learning Resources</a></li>
<li><a href="../official/introduction/ecosystem.html" class="menu__link">Ecosystem</a></li>
<li><a href="../official/introduction/examples.html" class="menu__link">Examples</a></li>
</ul></li>
<li><p><a href="#!" class="menu__link menu__link--sublist menu__link--active">Tutorials</a></p>
<ul>
<li><a href="../index.html" class="menu__link">Tutorials Index</a></li>
<li><a href="../quick-start.html" class="menu__link">Quick Start</a></li>
<li><a href="../typescript-quick-start.html" class="menu__link">TypeScript Quick Start</a></li>
<li><a href="#!" class="menu__link menu__link--sublist">Redux Essentials</a>
<ul>
<li><a href="../essentials/part-1-overview-concepts.html" class="menu__link">Redux Overview and Concepts</a></li>
<li><a href="../essentials/part-2-app-structure.html" class="menu__link">Redux App Structure</a></li>
<li><a href="../essentials/part-3-data-flow.html" class="menu__link">Basic Redux Data Flow</a></li>
<li><a href="../essentials/part-4-using-data.html" class="menu__link">Using Redux Data</a></li>
<li><a href="../essentials/part-5-async-logic.html" class="menu__link">Async Logic and Data Fetching</a></li>
<li><a href="../essentials/part-6-performance-normalization.html" class="menu__link">Performance and Normalizing Data</a></li>
</ul></li>
<li><p><a href="#!" class="menu__link menu__link--sublist menu__link--active">Redux Fundamentals</a></p>
<ul>
<li><a href="part-1-overview.html" class="menu__link">Redux Overview</a></li>
<li><a href="part-2-concepts-data-flow.html" class="menu__link">Redux Concepts and Data Flow</a></li>
<li><a href="part-3-state-actions-reducers.html" class="menu__link">State, Actions, and Reducers</a></li>
<li><a href="part-4-store.html" class="menu__link menu__link--active active">Store</a></li>
<li><a href="part-5-ui-react.html" class="menu__link">UI and React</a></li>
<li><a href="part-6-async-logic.html" class="menu__link">Async Logic and Data Fetching</a></li>
<li><a href="part-7-standard-patterns.html" class="menu__link">Standard Redux Patterns</a></li>
<li><a href="part-8-modern-redux.html" class="menu__link">Modern Redux with Redux Toolkit</a></li>
</ul></li>
<li><a href="../official/recipes/recipe-index.html" class="menu__link">Recipes: Index</a></li>
<li><a href="../official/recipes/configuring-your-store.html" class="menu__link">Configuring Your Store</a></li>
<li><a href="../official/recipes/usage-with-typescript.html" class="menu__link">Usage With TypeScript</a></li>
<li><a href="../official/recipes/migrating-to-redux.html" class="menu__link">Migrating to Redux</a></li>
<li><a href="../official/recipes/using-object-spread-operator.html" class="menu__link">Using Object Spread Operator</a></li>
<li><a href="../official/recipes/reducing-boilerplate.html" class="menu__link">Reducing Boilerplate</a></li>
<li><a href="../official/recipes/server-rendering.html" class="menu__link">Server Rendering</a></li>
<li><a href="../official/recipes/writing-tests.html" class="menu__link">Writing Tests</a></li>
<li><a href="../official/recipes/computing-derived-data.html" class="menu__link">Computing Derived Data</a></li>
<li><a href="../official/recipes/implementing-undo-history.html" class="menu__link">Implementing Undo History</a></li>
<li><a href="../official/recipes/isolating-redux-sub-apps.html" class="menu__link">Isolating Redux Sub-Apps</a></li>
<li><a href="../official/recipes/code-splitting.html" class="menu__link">Code Splitting</a></li>
<li><a href="../official/recipes/troubleshooting.html" class="menu__link">Troubleshooting</a></li>
<li><a href="#!" class="menu__link menu__link--sublist">Structuring Reducers</a>
<ul>
<li><a href="../official/recipes/structuring-reducers/structuring-reducers.html" class="menu__link">Structuring Reducers</a></li>
<li><a href="../official/recipes/structuring-reducers/prerequisite-concepts.html" class="menu__link">Prerequisite Concepts</a></li>
<li><a href="../official/recipes/structuring-reducers/basic-reducer-structure.html" class="menu__link">Basic Reducer Structure</a></li>
<li><a href="../official/recipes/structuring-reducers/splitting-reducer-logic.html" class="menu__link">Splitting Reducer Logic</a></li>
<li><a href="../official/recipes/structuring-reducers/refactoring-reducer-example.html" class="menu__link">Refactoring Reducers Example</a></li>
<li><a href="../official/recipes/structuring-reducers/using-combinereducers.html" class="menu__link">Using combineReducers</a></li>
<li><a href="../official/recipes/structuring-reducers/beyond-combinereducers.html" class="menu__link">Beyond combineReducers</a></li>
<li><a href="../official/recipes/structuring-reducers/normalizing-state-shape.html" class="menu__link">Normalizing State Shape</a></li>
<li><a href="../official/recipes/structuring-reducers/updating-normalized-data.html" class="menu__link">Updating Normalized Data</a></li>
<li><a href="../official/recipes/structuring-reducers/reusing-reducer-logic.html" class="menu__link">Reusing Reducer Logic</a></li>
<li><a href="../official/recipes/structuring-reducers/immutable-update-patterns.html" class="menu__link">Immutable Update Patterns</a></li>
<li><a href="../official/recipes/structuring-reducers/initializing-state.html" class="menu__link">Initializing State</a></li>
</ul></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">Understanding Redux</a>
<ul>
<li><a href="#!" class="menu__link menu__link--sublist">Thinking in Redux</a>
<ul>
<li><a href="../official/understanding/thinking-in-redux/motivation.html" class="menu__link">Motivation</a></li>
<li><a href="../official/understanding/thinking-in-redux/three-principles.html" class="menu__link">Three Principles</a></li>
<li><a href="../official/understanding/thinking-in-redux/glossary.html" class="menu__link">Glossary</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">History and Design</a>
<ul>
<li><a href="../official/understanding/history-and-design/prior-art.html" class="menu__link">Prior Art</a></li>
<li><a href="../official/understanding/history-and-design/middleware.html" class="menu__link">Middleware</a></li>
</ul></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">FAQ</a>
<ul>
<li><a href="../official/faq.html" class="menu__link">FAQ Index</a></li>
<li><a href="../official/faq/general.html" class="menu__link">General</a></li>
<li><a href="../official/faq/reducers.html" class="menu__link">Reducers</a></li>
<li><a href="../official/faq/organizing-state.html" class="menu__link">Organizing State</a></li>
<li><a href="../official/faq/store-setup.html" class="menu__link">Store Setup</a></li>
<li><a href="../official/faq/actions.html" class="menu__link">Actions</a></li>
<li><a href="../official/faq/immutable-data.html" class="menu__link">Immutable Data</a></li>
<li><a href="../official/faq/code-structure.html" class="menu__link">Code Structure</a></li>
<li><a href="../official/faq/performance.html" class="menu__link">Performance</a></li>
<li><a href="../official/faq/design-decisions.html" class="menu__link">Design Decisions</a></li>
<li><a href="../official/faq/react-redux.html" class="menu__link">React Redux</a></li>
<li><a href="../official/faq/miscellaneous.html" class="menu__link">Miscellaneous</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">Style Guide</a>
<ul>
<li><a href="../official/style-guide/style-guide.html" class="menu__link">Style Guide: Best Practices</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">API Reference</a>
<ul>
<li><a href="../official/api/api-reference.html" class="menu__link">API Reference</a></li>
<li><a href="../official/api/createstore.html" class="menu__link">createStore</a></li>
<li><a href="../official/api/store.html" class="menu__link">Store</a></li>
<li><a href="../official/api/combinereducers.html" class="menu__link">combineReducers</a></li>
<li><a href="../official/api/applymiddleware.html" class="menu__link">applyMiddleware</a></li>
<li><a href="../official/api/bindactioncreators.html" class="menu__link">bindActionCreators</a></li>
<li><a href="../official/api/compose.html" class="menu__link">compose</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">Redux Toolkit</a>
<ul>
<li><a href="../official/redux-toolkit/overview.html" class="menu__link">Redux Toolkit: Overview</a></li>
</ul></li>
</ul>
<h1 id="redux-fundamentals-part-4-store"><span id="redux-fundamentals-part-4-store" class="anchor enhancedAnchor_2LWZ"></span>Redux Fundamentals, Part 4: Store<a href="#redux-fundamentals-part-4-store" class="hash-link" title="Direct link to heading">#</a></h1>
<h5 id="what-youll-learn"><span class="admonition-icon"> </span>What You’ll Learn</h5>
<ul>
<li>How to create a Redux store</li>
<li>How to use the store to update state and listen for updates</li>
<li>How to configure the store to extend its capabilities</li>
<li>How to set up the Redux DevTools Extension to debug your app</li>
</ul>
<h2 id="introduction"><span id="introduction" class="anchor enhancedAnchor_2LWZ"></span>Introduction<a href="#introduction" class="hash-link" title="Direct link to heading">#</a></h2>
<p>In <a href="part-3-state-actions-reducers.html">Part 3: State, Actions, and Reducers</a>, we started writing our example todo app. We listed business requirements, defined the <strong>state</strong> structure we need to make the app work, and created a series of action types to describe “what happened” and match the kinds of events that can happen as a user interacts with our app. We also wrote <strong>reducer</strong> functions that can handle updating our <code>state.todos</code> and <code>state.filters</code> sections, and saw how we can use the Redux <code>combineReducers</code> function to create a “root reducer” based on the different “slice reducers” for each feature in our app.</p>
<p>Now, it’s time to pull those pieces together, with the central piece of a Redux app: the <strong>store</strong>.</p>
<h2 id="redux-store"><span id="redux-store" class="anchor enhancedAnchor_2LWZ"></span>Redux Store<a href="#redux-store" class="hash-link" title="Direct link to heading">#</a></h2>
<p>The Redux <strong>store</strong> brings together the state, actions, and reducers that make up your app. The store has several responsibilities:</p>
<ul>
<li>Holds the current application state inside</li>
<li>Allows access to the current state via <a href="../../api/store.html#getState"><code>store.getState()</code></a>;</li>
<li>Allows state to be updated via <a href="../../api/store.html#dispatch"><code>store.dispatch(action)</code></a>;</li>
<li>Registers listener callbacks via <a href="../../api/store.html#subscribe"><code>store.subscribe(listener)</code></a>;</li>
<li>Handles unregistering of listeners via the <code>unsubscribe</code> function returned by <a href="../../api/store.html#subscribe"><code>store.subscribe(listener)</code></a>.</li>
</ul>
<p>It’s important to note that <strong>you’ll only have a single store in a Redux application</strong>. When you want to split your data handling logic, you’ll use <a href="part-3-state-actions-reducers.html#splitting-reducers">reducer composition</a> and create multiple reducers that can be combined together, instead of creating separate stores.</p>
<h3 id="creating-a-store"><span id="creating-a-store" class="anchor enhancedAnchor_2LWZ"></span>Creating a Store<a href="#creating-a-store" class="hash-link" title="Direct link to heading">#</a></h3>
<p><strong>Every Redux store has a single root reducer function</strong>. In the previous section, we <a href="part-3-state-actions-reducers.html#combinereducers">created a root reducer function using <code>combineReducers</code></a>. That root reducer is currently defined in <code>src/reducer.js</code> in our example app. Let’s import that root reducer and create our first store.</p>
<p>The Redux core library has <a href="../../api/createstore.html"><strong>a <code>createStore</code> API</strong></a> that will create the store. Add a new file called <code>store.js</code>, and import <code>createStore</code> and the root reducer. Then, call <code>createStore</code> and pass in the root reducer:</p>
<p>src/store.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createStore </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>rootReducer</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./reducer’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> store </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createStore</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">rootReducer</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> store</span>### <span id="loading-initial-state" class="anchor enhancedAnchor_2LWZ"></span>Loading Initial State<a href="#loading-initial-state" class="hash-link" title="Direct link to heading">#</a></p>
<p><code>createStore</code> can also accept a <code>preloadedState</code> value as its second argument. You could use this to add initial data when the store is created, such as values that were included in an HTML page sent from the server, or persisted in <code>localStorage</code> and read back when the user visits the page again, like this:</p>
<p>storeStatePersistenceExample.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createStore </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>rootReducer</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./reducer’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">let</span><span class="token plain"> preloadedState</span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> persistedTodosString </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token dom variable" style="color: #f8f8f2">localStorage</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getItem</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘todos’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">persistedTodosString</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> preloadedState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> todos</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">parse</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">persistedTodosString</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> store </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createStore</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">rootReducer</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> preloadedState</span><span class="token punctuation" style="color: #f8f8f2">)</span>## <span id="dispatching-actions" class="anchor enhancedAnchor_2LWZ"></span>Dispatching Actions<a href="#dispatching-actions" class="hash-link" title="Direct link to heading">#</a></p>
<p>Now that we have created a store, let’s verify our program works! Even without any UI, we can already test the update logic.</p>
<h5 id="tip"><span class="admonition-icon"> </span>tip</h5>
<p>Before you run this code, try going back to <code>src/features/todos/todosSlice.js</code>, and remove all the example todo objects from the <code>initialState</code> so that it’s an empty array. That will make the output from this example a bit easier to read.</p>
<p>src/index.js</p>
<p><span class="token comment" style="color: #c6cad2">// Omit existing React imports</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>store</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./store’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Log the initial state</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘Initial state:’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// {todos: [….], filters: {status, colors}}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Every time the state changes, log it</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Note that subscribe() returns a function for unregistering the listener</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> unsubscribe </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">subscribe</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘State after dispatch:’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Now, dispatch some actions</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Learn about actions’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Learn about reducers’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Learn about stores’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoToggled’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoToggled’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘filters/statusFilterChanged’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Active’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘filters/colorFilterChanged’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> color</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘red’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> changeType</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘added’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Stop listening to state updates</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token function" style="color: #e6d874">unsubscribe</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Dispatch one more action to see what happens</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Try creating a store’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Omit existing React rendering logic</span>Remember, every time we call <code>store.dispatch(action)</code>:</p>
<ul>
<li>The store calls <code>rootReducer(state, action)</code>
<ul>
<li>That root reducer may call other slice reducers inside of itself, like <code>todosReducer(state.todos, action)</code></li>
</ul></li>
<li>The store saves the <em>new</em> state value inside</li>
<li>The store calls all the listener subscription callbacks</li>
<li>If a listener has access to the <code>store</code>, it can now call <code>store.getState()</code> to read the latest state value</li>
</ul>
<p>If we look at the console log output from that example, you can see how the Redux state changes as each action was dispatched:</p>
<figure>
<img src="../../../d33wubrfki0l68.cloudfront.net/9d150ae03734f187be6fd7782d7a1d87a78441db/cd37e/assets/images/initial-state-updates-67635eb69036940412b749502d6f1e5" alt="Logged Redux state after dispatching actions" /><figcaption>Logged Redux state after dispatching actions</figcaption>
</figure>
<p>Notice that our app did <em>not</em> log anything from the last action. That’s because we removed the listener callback when we called <code>unsubscribe()</code>, so nothing else ran after the action was dispatched.</p>
<p>We specified the behavior of our app before we even started writing the UI. That helps give us confidence that the app will work as intended.</p>
<h5 id="info"><span class="admonition-icon"> </span>info</h5>
<p>If you want, you can now try writing tests for your reducers. Because they’re <a href="../../understanding/thinking-in-redux/three-principles.html#changes-are-made-with-pure-functions">pure functions</a>, it should be straightforward to test them. Call them with an example <code>state</code> and <code>action</code>, take the result, and check to see if it matches what you expect:</p>
<p>todosSlice.spec.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>todosReducer</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./todosSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token function" style="color: #e6d874">test</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘Toggles a todo based on id’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> id</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Test text’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> completed</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">false</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> action </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoToggled’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> result </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">todosReducer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">expect</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">result</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">toBe</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token boolean" style="color: #ae81ff">true</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span>## <span id="inside-a-redux-store" class="anchor enhancedAnchor_2LWZ"></span>Inside a Redux Store<a href="#inside-a-redux-store" class="hash-link" title="Direct link to heading">#</a></p>
<p>It might be helpful to take a peek inside a Redux store to see how it works. Here’s a miniature example of a working Redux store, in about 25 lines of code:</p>
<p>miniReduxStoreExample.js</p>
<p><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createStore</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">reducer</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> preloadedState</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">let</span><span class="token plain"> state </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> preloadedState</span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> listeners </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> state</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">subscribe</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">listener</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> listeners</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">push</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">listener</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">unsubscribe</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> index </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> listeners</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">indexOf</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">listener</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> listeners</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">splice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">index</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> state </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">reducer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> listeners</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">forEach</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">listener</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">listener</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘@<span class="citation" data-cites="redux/INIT">@redux/INIT</span>’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> dispatch</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> subscribe</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> getState </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>This small version of a Redux store works well enough that you could use it to replace the actual Redux <code>createStore</code> function you’ve been using in your app so far. (Try it and see for yourself!) <a href="../../../github.com/reduxjs/redux/blob/v4.0.5/src/createStore.html">The actual Redux store implementation is longer and a bit more complicated</a>, but most of that is comments, warning messages, and handling some edge cases.</p>
<p>As you can see, the actual logic here is fairly short:</p>
<ul>
<li>The store has the current <code>state</code> value and <code>reducer</code> function inside of itself</li>
<li><code>getState</code> returns the current state value</li>
<li><code>subscribe</code> keeps an array of listener callbacks and returns a function to remove the new callback</li>
<li><code>dispatch</code> calls the reducer, saves the state, and runs the listeners</li>
<li>The store dispatches one action on startup to initialize the reducers with their state</li>
<li>The store API is an object with <code>{dispatch, subscribe, getState}</code> inside</li>
</ul>
<p>To emphasize one of those in particular: notice that <code>getState</code> just returns whatever the current <code>state</code> value is. That means that <strong>by default, nothing prevents you from accidentally mutating the current state value!</strong> This code will run without any errors, but it’s incorrect:</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> state </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// ❌ Don’t do this - it mutates the current state!</span><span class="token plain"></span></p>
<p><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">filters</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Active’</span>In other words:</p>
<ul>
<li>The Redux store doesn’t make an extra copy of the <code>state</code> value when you call <code>getState()</code>. It’s exactly the same reference that was returned from the root reducer function</li>
<li>The Redux store doesn’t do anything else to prevent accidental mutations. It <em>is</em> possible to mutate the state, either inside a reducer or outside the store, and you must always be careful to avoid mutations.</li>
</ul>
<p>One common cause of accidental mutations is sorting arrays. <a href="../../../doesitmutate.xyz/sort/index.html"><strong>Calling <code>array.sort()</code> actually mutates the existing array</strong></a>. If we called <code>const sortedTodos = state.todos.sort()</code>, we’d end up mutating the real store state unintentionally.</p>
<h5 id="tip-1"><span class="admonition-icon"> </span>tip</h5>
<p>In <a href="part-8-modern-redux.html">Part 8: Modern Redux</a>, we’ll see how Redux Toolkit helps avoid mutations in reducers, and detects and warns about accidental mutations outside of reducers.</p>
<h2 id="configuring-the-store"><span id="configuring-the-store" class="anchor enhancedAnchor_2LWZ"></span>Configuring the Store<a href="#configuring-the-store" class="hash-link" title="Direct link to heading">#</a></h2>
<p>We’ve already seen that we can pass <code>rootReducer</code> and <code>preloadedState</code> arguments to <code>createStore</code>. However, <code>createStore</code> can also take one more argument, which is used to customize the store’s abilities and give it new powers.</p>
<p>Redux stores are customized using something called a <strong>store enhancer</strong>. A store enhancer is like a special version of <code>createStore</code> that adds another layer wrapping around the original Redux store. An enhanced store can then change how the store behaves, by supplying its own versions of the store’s <code>dispatch</code>, <code>getState</code>, and <code>subscribe</code> functions instead of the originals.</p>
<p>For this tutorial, we won’t go into details about how store enhancers actually work - we’ll focus on how to use them.</p>
<h3 id="creating-a-store-with-enhancers"><span id="creating-a-store-with-enhancers" class="anchor enhancedAnchor_2LWZ"></span>Creating a Store with Enhancers<a href="#creating-a-store-with-enhancers" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Our project has two small example store enhancers available, in the <code>src/exampleAddons/enhancers.js</code> file:</p>
<ul>
<li><code>sayHiOnDispatch</code>: an enhancer that always logs <code>'Hi'!</code> to the console every time an action is dispatched</li>
<li><code>includeMeaningOfLife</code>: an enhancer that always adds the field <code>meaningOfLife: 42</code> to the value returned from <code>getState()</code></li>
</ul>
<p>Let’s start by using <code>sayHiOnDispatch</code>. First, we’ll import it, and pass it to <code>createStore</code>:</p>
<p>src/store.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createStore </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>rootReducer</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./reducer’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> sayHiOnDispatch </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./exampleAddons/enhancers’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> store </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createStore</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">rootReducer</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token keyword nil" style="color: #f92672">undefined</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> sayHiOnDispatch</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> store</span>We don’t have a <code>preloadedState</code> value here, so we’ll pass <code>undefined</code> as the second argument instead.</p>
<p>Next, let’s try dispatching an action:</p>
<p>src/index.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>store</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./store’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘Dispatching action’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Learn about actions’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘Dispatch complete’</span><span class="token punctuation" style="color: #f8f8f2">)</span>Now look at the console. You should see <code>'Hi!'</code> logged there, in between the other two log statements:</p>
<figure>
<img src="data:image/png;base64,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" alt="sayHi store enhancer logging" /><figcaption>sayHi store enhancer logging</figcaption>
</figure>
<p>The <code>sayHiOnDispatch</code> enhancer wrapped the original <code>store.dispatch</code> function with its own specialized version of <code>dispatch</code>. When we called <code>store.dispatch()</code>, we were actually calling the wrapper function from <code>sayHiOnDispatch</code>, which called the original and then printed ‘Hi’.</p>
<p>Now, let’s try adding a second enhancer. We can import <code>includeMeaningOfLife</code> from that same file… but we have a problem. <strong><code>createStore</code> only accepts one enhancer as its third argument!</strong> How can we pass <em>two</em> enhancers at the same time?</p>
<p>What we really need is some way to merge both the <code>sayHiOnDispatch</code> enhancer and the <code>includeMeaningOfLife</code> enhancer into a single combined enhancer, and then pass that instead.</p>
<p>Fortunately, <strong>the Redux core includes <a href="../../api/compose.html">a <code>compose</code> function</a> that can be used to merge multiple enhancers together</strong>. Let’s use that here:</p>
<p>src/store.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createStore</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> compose </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>rootReducer</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./reducer’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span></span></p>
<p><span> sayHiOnDispatch</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span></span></p>
<p><span> includeMeaningOfLife</span></p>
<p><span></span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./exampleAddons/enhancers’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> composedEnhancer </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">compose</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">sayHiOnDispatch</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> includeMeaningOfLife</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> store </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createStore</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">rootReducer</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token keyword nil" style="color: #f92672">undefined</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> composedEnhancer</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> store</span>Now we can see what happens if we use the store:</p>
<p>src/index.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>store</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./store’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Learn about actions’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// log: ‘Hi!’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘State after dispatch:’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// log: {todos: […], filters: {status, colors}, meaningOfLife: 42}</span>And the logged output looks like this:</p>
<figure>
<img src="../../../d33wubrfki0l68.cloudfront.net/3ad0cba4033646d27f22f76eb8c38e27faedae3d/bcbac/assets/images/meaningoflife-enhancer-logging-46b98c1363a85b3657bd6e" alt="meaningOfLife store enhancer logging" /><figcaption>meaningOfLife store enhancer logging</figcaption>
</figure>
<p>So, we can see that both enhancers are modifying the behavior of the store at the same time. <code>sayHiOnDispatch</code> has changed how <code>dispatch</code> works, and <code>includeMeaningOfLife</code> has changed how <code>getState</code> works.</p>
<p>Store enhancers are a very powerful way to modify the store, and almost all Redux apps will include at least one enhancer when setting up the store.</p>
<h5 id="tip-2"><span class="admonition-icon"> </span>tip</h5>
<p>If you don’t have any <code>preloadedState</code> to pass in, you can pass the <code>enhancer</code> as the second argument instead:</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> store </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createStore</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">rootReducer</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> storeEnhancer</span><span class="token punctuation" style="color: #f8f8f2">)</span>## <span id="middleware" class="anchor enhancedAnchor_2LWZ"></span>Middleware<a href="#middleware" class="hash-link" title="Direct link to heading">#</a></p>
<p>Enhancers are powerful because they can override or replace any of the store’s methods: <code>dispatch</code>, <code>getState</code>, and <code>subscribe</code>.</p>
<p>But, much of the time, we only need to customize how <code>dispatch</code> behaves. It would be nice if there was a way to add some customized behavior when <code>dispatch</code> runs.</p>
<p>Redux uses a special kind of addon called <strong>middleware</strong> to let us customize the <code>dispatch</code> function.</p>
<p>If you’ve ever used a library like Express or Koa, you might already be familiar with the idea of adding middleware to customize behavior. In these frameworks, middleware is some code you can put between the framework receiving a request, and the framework generating a response. For example, Express or Koa middleware may add CORS headers, logging, compression, and more. The best feature of middleware is that it’s composable in a chain. You can use multiple independent third-party middleware in a single project.</p>
<p>Redux middleware solves different problems than Express or Koa middleware, but in a conceptually similar way. <strong>Redux middleware provides a third-party extension point between dispatching an action, and the moment it reaches the reducer.</strong> People use Redux middleware for logging, crash reporting, talking to an asynchronous API, routing, and more.</p>
<p>First, we’ll look at how to add middleware to the store, then we’ll show how you can write your own.</p>
<h3 id="using-middleware"><span id="using-middleware" class="anchor enhancedAnchor_2LWZ"></span>Using Middleware<a href="#using-middleware" class="hash-link" title="Direct link to heading">#</a></h3>
<p>We already saw that you can customize a Redux store using store enhancers. Redux middleware are actually implemented on top of a very special store enhancer that comes built in with Redux, called <strong><code>applyMiddleware</code></strong>.</p>
<p>Since we already know how to add enhancers to our store, we should be able to do that now. We’ll start with <code>applyMiddleware</code> by itself, and we’ll add three example middleware that have been included in this project.</p>
<p>src/store.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createStore</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> applyMiddleware </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>rootReducer</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./reducer’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> print1</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> print2</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> print3 </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./exampleAddons/middleware’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> middlewareEnhancer </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">applyMiddleware</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">print1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> print2</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> print3</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Pass enhancer as the second arg, since there’s no preloadedState</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> store </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createStore</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">rootReducer</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> middlewareEnhancer</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> store</span>As their names say, each of these middleware will print a number when an action is dispatched.</p>
<p>What happens if we dispatch now?</p>
<p>src/index.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>store</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./store’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Learn about actions’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// log: ‘1’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// log: ‘2’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// log: ‘3’</span>And we can see the output in the console:</p>
<figure>
<img src="data:image/png;base64,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" alt="print middleware logging" /><figcaption>print middleware logging</figcaption>
</figure>
<p>So how does that work?</p>
<p><strong>Middleware form a pipeline around the store’s <code>dispatch</code> method</strong>. When we call <code>store.dispatch(action)</code>, we’re <em>actually</em> calling the first middleware in the pipeline. That middleware can then do anything it wants when it sees the action. Typically, a middleware will check to see if the action is a specific type that it cares about, much like a reducer would. If it’s the right type, the middleware might run some custom logic. Otherwise, it passes the action to the next middleware in the pipeline.</p>
<p><em>Unlike</em> a reducer, <strong>middleware can have side effects inside</strong>, including timeouts and other async logic.</p>
<p>In this case, the action is passed through:</p>
<ol type="1">
<li>The <code>print1</code> middleware (which we see as <code>store.dispatch</code>)</li>
<li>The <code>print2</code> middleware</li>
<li>The <code>print3</code> middleware</li>
<li>The original <code>store.dispatch</code></li>
<li>The root reducer inside <code>store</code></li>
</ol>
<p>And since these are all function calls, they all <em>return</em> from that call stack. So, the <code>print1</code> middleware is the first to run, and the last to finish.</p>
<h3 id="writing-custom-middleware"><span id="writing-custom-middleware" class="anchor enhancedAnchor_2LWZ"></span>Writing Custom Middleware<a href="#writing-custom-middleware" class="hash-link" title="Direct link to heading">#</a></h3>
<p>We can also write our own middleware. You might not need to do this all the time, but custom middleware are a great way to add specific behaviors to a Redux application.</p>
<p><strong>Redux middleware are written as a series of three nested functions</strong>. Let’s see what that pattern looks like. We’ll start by trying to write this middleware using the <code>function</code> keyword, so that it’s more clear what’s happening:</p>
<p><span class="token comment" style="color: #c6cad2">// Middleware written as ES5 functions</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Outer function:</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">exampleMiddleware</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">storeAPI</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">wrapDispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">next</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">handleAction</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Do anything here: pass the action onwards with next(action),</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// or restart the pipeline with storeAPI.dispatch(action)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Can also use storeAPI.getState() here</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">next</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>Let’s break down what these three functions do and what their arguments are.</p>
<ul>
<li><code>exampleMiddleware</code>: The outer function is actually the “middleware” itself. It will be called by <code>applyMiddleware</code>, and receives a <code>storeAPI</code> object containing the store’s <code>{dispatch, getState}</code> functions. These are the same <code>dispatch</code> and <code>getState</code> functions that are actually part of the store. If you call this <code>dispatch</code> function, it will send the action to the <em>start</em> of the middleware pipeline. This is only called once.</li>
<li><code>wrapDispatch</code>: The middle function receives a function called <code>next</code> as its argument. This function is actually the <em>next middleware</em> in the pipeline. If this middleware is the last one in the sequence, then <code>next</code> is actually the original <code>store.dispatch</code> function instead. Calling <code>next(action)</code> passes the middleware to the <em>next</em> middleware in the pipeline. This is also only called once</li>
<li><code>handleAction</code>: Finally, the inner function receives the current <code>action</code> as its argument, and will be called <em>every</em> time an action is dispatched.</li>
</ul>
<h5 id="tip-3"><span class="admonition-icon"> </span>tip</h5>
<p>You can give these middleware functions any names you want, but it can help to use these names to remember what each one does:</p>
<ul>
<li>Outer: <code>someCustomMiddleware</code> (or whatever your middleware is called)</li>
<li>Middle: <code>wrapDispatch</code></li>
<li>Inner: <code>handleAction</code></li>
</ul>
<p>Because these are normal functions, we can also write them using ES6 arrow functions. This lets us write them shorter because arrow functions don’t have to have a <code>return</code> statement, but it can also be a bit harder to read if you’re not yet familiar with arrow functions and implicit returns.</p>
<p>Here’s the same example as above, using arrow functions:</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">anotherExampleMiddleware</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">storeAPI</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token parameter">next</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token parameter">action</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Do something in here, when each action is dispatched</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">next</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>We’re still nesting those three functions together, and returning each function, but the implicit returns make this shorter.</p>
<h3 id="your-first-custom-middleware"><span id="your-first-custom-middleware" class="anchor enhancedAnchor_2LWZ"></span>Your First Custom Middleware<a href="#your-first-custom-middleware" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Let’s say we want to add some logging to our application. We’d like to see the contents of each action in the console when it’s dispatched, and we’d like to see what the state is after the action has been handled by the reducers.</p>
<h5 id="info-1"><span class="admonition-icon"> </span>info</h5>
<p>These example middleware aren’t specifically part of the actual todo app, but you can try adding them to your project to see what happens when you use them.</p>
<p>We can write a small middleware that will log that information to the console for us:</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">loggerMiddleware</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">storeAPI</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token parameter">next</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token parameter">action</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘dispatching’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">let</span><span class="token plain"> result </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">next</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘next state’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> storeAPI</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> result</span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>Whenever an action is dispatched:</p>
<ul>
<li>The first part of the <code>handleAction</code> function runs, and we print <code>'dispatching'</code></li>
<li>We pass the action to the <code>next</code> section, which may be another middleware or the real <code>store.dispatch</code></li>
<li>Eventually the reducers run and the state is updated, and the <code>next</code> function returns</li>
<li>We can now call <code>storeAPI.getState()</code> and see what the new state is</li>
<li>We finish by returning whatever <code>result</code> value came from the <code>next</code> middleware</li>
</ul>
<p>Any middleware can return any value, and the return value from the first middleware in the pipeline is actually returned when you call <code>store.dispatch()</code>. For example:</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">alwaysReturnHelloMiddleware</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">storeAPI</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token parameter">next</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> action </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> originalResult </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">next</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Ignore the original result, return something else</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Hello!’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> middlewareEnhancer </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">applyMiddleware</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">alwaysReturnHelloMiddleware</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> store </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createStore</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">rootReducer</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> middlewareEnhancer</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> dispatchResult </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘some/action’</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">dispatchResult</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// log: ‘Hello!’</span>Let’s try one more example. Middleware often look for a specific action, and then do something when that action is dispatched. Middleware also have the ability to run async logic inside. We can write a middleware that prints something on a delay when it sees a certain action:</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">delayedMessageMiddleware</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">storeAPI</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token parameter">next</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token parameter">action</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">setTimeout</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘Added a new todo:’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1000</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">next</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>This middleware will look for “todo added” actions. Every time it sees one, it sets a 1-second timer, and then prints the action’s payload to the console.</p>
<h3 id="middleware-use-cases"><span id="middleware-use-cases" class="anchor enhancedAnchor_2LWZ"></span>Middleware Use Cases<a href="#middleware-use-cases" class="hash-link" title="Direct link to heading">#</a></h3>
<p>So, what can we do with middleware? Lots of things!</p>
<p>A middleware can do anything it wants when it sees a dispatched action:</p>
<ul>
<li>Log something to the console</li>
<li>Set timeouts</li>
<li>Make asynchronous API calls</li>
<li>Modify the action</li>
<li>Pause the action or even stop it entirely</li>
</ul>
<p>and anything else you can think of.</p>
<p>In particular, <strong>middleware are <em>intended</em> to contain logic with side effects</strong>. In addition, <strong>middleware can modify <code>dispatch</code> to accept things that are <em>not</em> plain action objects</strong>. We’ll talk more about both of these <a href="part-6-async-logic.html">in Part 6: Async Logic</a>.</p>
<h2 id="redux-devtools"><span id="redux-devtools" class="anchor enhancedAnchor_2LWZ"></span>Redux DevTools<a href="#redux-devtools" class="hash-link" title="Direct link to heading">#</a></h2>
<p>Finally, there’s one more very important thing to cover with configuring the store.</p>
<p><strong>Redux was specifically designed to make it easier to understand when, where, why, and how your state has changed over time</strong>. As part of that, Redux was built to enable the use of the <strong>Redux DevTools</strong> - an addon that shows you a history of what actions were dispatched, what those actions contained, and how the state changed after each dispatched action.</p>
<p>The Redux DevTools UI is available as a browser extension for <a href="../../../chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljdfef7.html?hl=en">Chrome</a> and <a href="../../../addons.mozilla.org/en-US/firefox/addon/reduxdevtools/index.html">Firefox</a>. If you haven’t already added that to your browser, go ahead and do that now.</p>
<p>Once that’s installed, open up the browser’s DevTools window. You should now see a new “Redux” tab there. It doesn’t do anything, yet - we’ve got to set it up to talk to a Redux store first.</p>
<h3 id="adding-the-devtools-to-the-store"><span id="adding-the-devtools-to-the-store" class="anchor enhancedAnchor_2LWZ"></span>Adding the DevTools to the Store<a href="#adding-the-devtools-to-the-store" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Once the extension is installed, we need to configure the store so that the DevTools can see what’s happening inside. The DevTools require a specific store enhancer to be added to make that possible.</p>
<p>The <a href="../../../github.com/zalmoxisus/redux-devtools-extension.html">Redux DevTools Extension docs</a> have some instructions on how to set up the store, but the steps listed are a bit complicated. However, there’s an NPM package called <code>redux-devtools-extension</code> that takes care of the complicated part. That package exports a specialized <code>composeWithDevTools</code> function that we can use instead of the original Redux <code>compose</code> function.</p>
<p>Here’s how that looks:</p>
<p>src/store.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createStore</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> applyMiddleware </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> composeWithDevTools </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux-devtools-extension’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>rootReducer</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./reducer’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> print1</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> print2</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> print3 </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./exampleAddons/middleware’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> composedEnhancer </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">composeWithDevTools</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// EXAMPLE: Add whatever middleware you actually want to use here</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">applyMiddleware</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">print1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> print2</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> print3</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// other store enhancers if any</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> store </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createStore</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">rootReducer</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> composedEnhancer</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> store</span>Make sure that <code>index.js</code> is still dispatching an action after importing the store. Now, open up the Redux DevTools tab in the browser’s DevTools window. You should see something that looks like this:</p>
<figure>
<img src="../../../d33wubrfki0l68.cloudfront.net/2cbd2d01597bd210d8ef106cf1a751607856f699/9e971/assets/images/devtools-action-tab-d48da9ccb10f938ecc9d520555dbfe62" alt="Redux DevTools Extension: action tab" /><figcaption>Redux DevTools Extension: action tab</figcaption>
</figure>
<p>There’s a list of dispatched actions on the left. If we click one of them, the right pane shows several tabs:</p>
<ul>
<li>The contents of that action object</li>
<li>The entire Redux state as it looked after the reducer ran</li>
<li>The diff between the previous state and this state</li>
<li>If enabled, the function stack trace leading back to the line of code that called <code>store.dispatch()</code> in the first place</li>
</ul>
<p>Here’s what the “State” and “Diff” tabs look like after we dispatched that “add todo” action:</p>
<figure>
<embed src="../../../d33wubrfki0l68.cloudfront.net/c6c4497cf8e77e8d062b14f7e226f2d26424b18c/52a21/assets/images/devtools-state-tab-7029c0b4cfd3047e4bca2e9684d24555.2" /><figcaption>Redux DevTools Extension: state tab</figcaption>
</figure>
<figure>
<embed src="../../../d33wubrfki0l68.cloudfront.net/f0da02210c932e6dab7e3aa8038766e4227ac850/dc115/assets/images/devtools-diff-tab-e234146194236a6f6a31a0dde5d49836.22" /><figcaption>Redux DevTools Extension: diff tab</figcaption>
</figure>
<p>These are very powerful tools that can help us debug our apps and understand exactly what’s happening inside.</p>
<h2 id="what-youve-learned"><span id="what-youve-learned" class="anchor enhancedAnchor_2LWZ"></span>What You’ve Learned<a href="#what-youve-learned" class="hash-link" title="Direct link to heading">#</a></h2>
<p>As you’ve seen, the store is the central piece of every Redux application. Stores contain state and handle actions by running reducers, and can be customized to add additional behaviors.</p>
<p>Let’s see how our example app looks now:</p>
<p>And as a reminder, here’s what we covered in this section:</p>
<h5 id="summary"><span class="admonition-icon"> </span>Summary</h5>
<ul>
<li><strong>Redux apps always have a single store</strong>
<ul>
<li>Stores are created with the Redux <code>createStore</code> API</li>
<li>Every store has a single root reducer function</li>
</ul></li>
<li><strong>Stores have three main methods</strong>
<ul>
<li><code>getState</code> returns the current state</li>
<li><code>dispatch</code> sends an action to the reducer to update the state</li>
<li><code>subscribe</code> takes a listener callback that runs each time an action is dispatched</li>
</ul></li>
<li><strong>Store enhancers let us customize the store when it’s created</strong>
<ul>
<li>Enhancers wrap the store and can override its methods</li>
<li><code>createStore</code> accepts one enhancer as an argument</li>
<li>Multiple enhancers can be merged together using the <code>compose</code> API</li>
</ul></li>
<li><strong>Middleware are the main way to customize the store</strong>
<ul>
<li>Middleware are added using the <code>applyMiddleware</code> enhancer</li>
<li>Middleware are written as three nested functions inside each other</li>
<li>Middleware run each time an action is dispatched</li>
<li>Middleware can have side effects inside</li>
</ul></li>
<li><strong>The Redux DevTools let you see what’s changed in your app over time</strong>
<ul>
<li>The DevTools Extension can be installed in your browser</li>
<li>The store needs the DevTools enhancer added, using <code>composeWithDevTools</code></li>
<li>The DevTools show dispatched actions and changes in state over time</li>
</ul></li>
</ul>
<h2 id="whats-next"><span id="whats-next" class="anchor enhancedAnchor_2LWZ"></span>What’s Next?<a href="#whats-next" class="hash-link" title="Direct link to heading">#</a></h2>
<p>We now have a working Redux store that can run our reducers and update the state when we dispatch actions.</p>
<p>However, every app needs a user interface to display the data and let the user do something useful. In <a href="part-5-ui-react.html">Part 5: UI and React</a>, we’ll see how the Redux store works with a UI, and specifically see how Redux can work together with React.</p>
<p><a href="part-3-state-actions-reducers.html" class="pagination-nav__link"></a></p>
<p>« Redux Fundamentals, Part 3: State, Actions, and Reducers</p>
<p><a href="part-5-ui-react.html" class="pagination-nav__link"></a></p>
<p>Next</p>
<p>Redux Fundamentals, Part 5: UI and React »</p>
<ul>
<li><a href="#introduction" class="table-of-contents__link">Introduction</a></li>
<li><a href="#redux-store" class="table-of-contents__link">Redux Store</a>
<ul>
<li><a href="#creating-a-store" class="table-of-contents__link">Creating a Store</a></li>
<li><a href="#loading-initial-state" class="table-of-contents__link">Loading Initial State</a></li>
</ul></li>
<li><a href="#dispatching-actions" class="table-of-contents__link">Dispatching Actions</a></li>
<li><a href="#inside-a-redux-store" class="table-of-contents__link">Inside a Redux Store</a></li>
<li><a href="#configuring-the-store" class="table-of-contents__link">Configuring the Store</a>
<ul>
<li><a href="#creating-a-store-with-enhancers" class="table-of-contents__link">Creating a Store with Enhancers</a></li>
</ul></li>
<li><a href="#middleware" class="table-of-contents__link">Middleware</a>
<ul>
<li><a href="#using-middleware" class="table-of-contents__link">Using Middleware</a></li>
<li><a href="#writing-custom-middleware" class="table-of-contents__link">Writing Custom Middleware</a></li>
<li><a href="#your-first-custom-middleware" class="table-of-contents__link">Your First Custom Middleware</a></li>
<li><a href="#middleware-use-cases" class="table-of-contents__link">Middleware Use Cases</a></li>
</ul></li>
<li><a href="#redux-devtools" class="table-of-contents__link">Redux DevTools</a>
<ul>
<li><a href="#adding-the-devtools-to-the-store" class="table-of-contents__link">Adding the DevTools to the Store</a></li>
</ul></li>
<li><a href="#what-youve-learned" class="table-of-contents__link">What You’ve Learned</a></li>
<li><a href="#whats-next" class="table-of-contents__link">What’s Next?</a></li>
</ul>
<h4 id="docs">Docs</h4>
<ul>
<li><a href="../official/introduction/getting-started.html" class="footer__link-item">Getting Started</a></li>
<li><a href="../essentials/part-1-overview-concepts.html" class="footer__link-item">Tutorial</a></li>
<li><a href="../official/faq.html" class="footer__link-item">FAQ</a></li>
<li><a href="../official/api/api-reference.html" class="footer__link-item">API Reference</a></li>
</ul>
<h4 id="community">Community</h4>
<ul>
<li><a href="../official/../discord.com/invite/0ZcbPKXt5bZ6au5t.html" class="footer__link-item">Reactiflux Discord</a></li>
<li><a href="../official/../stackoverflow.com/questions/tagged/redux.html" class="footer__link-item">Stack Overflow</a></li>
<li><a href="../official/introduction/getting-started.html#help-and-discussion" class="footer__link-item">Feedback</a></li>
</ul>
<h4 id="more">More</h4>
<ul>
<li><a href="../official/../github.com/reduxjs/redux.html" class="footer__link-item">GitHub</a></li>
<li><a href="../../../www.netlify.com/index.html"><img src="../../../www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify" /></a></li>
</ul>
<p><a href="../official/index.html" class="footerLogoLink_MyFc"><img src="../official/../d33wubrfki0l68.cloudfront.net/0834d0215db51e91525a25acf97433051f280f2f/c30f5/img/redux.svg" alt="Redux Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo" /></p>
</body>
</html>
