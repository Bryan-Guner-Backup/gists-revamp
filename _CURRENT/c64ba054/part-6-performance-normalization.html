<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>part-6-performance-normalization</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<p><a href="../official/index.html" class="navbar__brand"><strong>Redux</strong></a></p>
<p><a href="../official/introduction/getting-started.html" class="navbar__item navbar__link">Getting Started</a><a href="part-1-overview-concepts.html" class="navbar__item navbar__link">Tutorial</a><a href="../official/api/api-reference.html" class="navbar__item navbar__link">API</a><a href="../official/faq.html" class="navbar__item navbar__link">FAQ</a><a href="../official/style-guide/style-guide.html" class="navbar__item navbar__link">Best Practices</a><a href="../official/../github.com/reduxjs/redux.html" class="navbar__item navbar__link">GitHub</a><a href="../official/introduction/getting-started.html#help-and-discussion" class="navbar__item navbar__link">Need help?</a> <a href="../official/index.html" class="navbar__brand"><strong>Redux</strong></a></p>
<ul>
<li><a href="../official/introduction/getting-started.html" class="menu__link">Getting Started</a></li>
<li><a href="part-1-overview-concepts.html" class="menu__link">Tutorial</a></li>
<li><a href="../official/api/api-reference.html" class="menu__link">API</a></li>
<li><a href="../official/faq.html" class="menu__link">FAQ</a></li>
<li><a href="../official/style-guide/style-guide.html" class="menu__link">Best Practices</a></li>
<li><a href="../official/../github.com/reduxjs/redux.html" class="menu__link">GitHub</a></li>
<li><p><a href="../official/introduction/getting-started.html#help-and-discussion" class="menu__link">Need help?</a></p></li>
<li><a href="#!" class="menu__link menu__link--sublist">Introduction</a>
<ul>
<li><a href="../official/introduction/getting-started.html" class="menu__link">Getting Started with Redux</a></li>
<li><a href="../official/introduction/installation.html" class="menu__link">Installation</a></li>
<li><a href="../official/introduction/core-concepts.html" class="menu__link">Core Concepts</a></li>
<li><a href="../official/introduction/learning-resources.html" class="menu__link">Learning Resources</a></li>
<li><a href="../official/introduction/ecosystem.html" class="menu__link">Ecosystem</a></li>
<li><a href="../official/introduction/examples.html" class="menu__link">Examples</a></li>
</ul></li>
<li><p><a href="#!" class="menu__link menu__link--sublist menu__link--active">Tutorials</a></p>
<ul>
<li><a href="../index.html" class="menu__link">Tutorials Index</a></li>
<li><a href="../quick-start.html" class="menu__link">Quick Start</a></li>
<li><a href="../typescript-quick-start.html" class="menu__link">TypeScript Quick Start</a></li>
<li><p><a href="#!" class="menu__link menu__link--sublist menu__link--active">Redux Essentials</a></p>
<ul>
<li><a href="part-1-overview-concepts.html" class="menu__link">Redux Overview and Concepts</a></li>
<li><a href="part-2-app-structure.html" class="menu__link">Redux App Structure</a></li>
<li><a href="part-3-data-flow.html" class="menu__link">Basic Redux Data Flow</a></li>
<li><a href="part-4-using-data.html" class="menu__link">Using Redux Data</a></li>
<li><a href="part-5-async-logic.html" class="menu__link">Async Logic and Data Fetching</a></li>
<li><p><a href="part-6-performance-normalization.html" class="menu__link menu__link--active active">Performance and Normalizing Data</a></p></li>
<li><a href="../fundamentals/part-1-overview.html" class="menu__link">Redux Overview</a></li>
<li><a href="../fundamentals/part-2-concepts-data-flow.html" class="menu__link">Redux Concepts and Data Flow</a></li>
<li><a href="../fundamentals/part-3-state-actions-reducers.html" class="menu__link">State, Actions, and Reducers</a></li>
<li><a href="../fundamentals/part-4-store.html" class="menu__link">Store</a></li>
<li><a href="../fundamentals/part-5-ui-react.html" class="menu__link">UI and React</a></li>
<li><a href="../fundamentals/part-6-async-logic.html" class="menu__link">Async Logic and Data Fetching</a></li>
<li><a href="../fundamentals/part-7-standard-patterns.html" class="menu__link">Standard Redux Patterns</a></li>
<li><p><a href="../fundamentals/part-8-modern-redux.html" class="menu__link">Modern Redux with Redux Toolkit</a></p></li>
</ul></li>
<li><a href="../official/recipes/recipe-index.html" class="menu__link">Recipes: Index</a></li>
<li><a href="../official/recipes/configuring-your-store.html" class="menu__link">Configuring Your Store</a></li>
<li><a href="../official/recipes/usage-with-typescript.html" class="menu__link">Usage With TypeScript</a></li>
<li><a href="../official/recipes/migrating-to-redux.html" class="menu__link">Migrating to Redux</a></li>
<li><a href="../official/recipes/using-object-spread-operator.html" class="menu__link">Using Object Spread Operator</a></li>
<li><a href="../official/recipes/reducing-boilerplate.html" class="menu__link">Reducing Boilerplate</a></li>
<li><a href="../official/recipes/server-rendering.html" class="menu__link">Server Rendering</a></li>
<li><a href="../official/recipes/writing-tests.html" class="menu__link">Writing Tests</a></li>
<li><a href="../official/recipes/computing-derived-data.html" class="menu__link">Computing Derived Data</a></li>
<li><a href="../official/recipes/implementing-undo-history.html" class="menu__link">Implementing Undo History</a></li>
<li><a href="../official/recipes/isolating-redux-sub-apps.html" class="menu__link">Isolating Redux Sub-Apps</a></li>
<li><a href="../official/recipes/code-splitting.html" class="menu__link">Code Splitting</a></li>
<li><a href="../official/recipes/troubleshooting.html" class="menu__link">Troubleshooting</a></li>
<li><a href="#!" class="menu__link menu__link--sublist">Structuring Reducers</a>
<ul>
<li><a href="../official/recipes/structuring-reducers/structuring-reducers.html" class="menu__link">Structuring Reducers</a></li>
<li><a href="../official/recipes/structuring-reducers/prerequisite-concepts.html" class="menu__link">Prerequisite Concepts</a></li>
<li><a href="../official/recipes/structuring-reducers/basic-reducer-structure.html" class="menu__link">Basic Reducer Structure</a></li>
<li><a href="../official/recipes/structuring-reducers/splitting-reducer-logic.html" class="menu__link">Splitting Reducer Logic</a></li>
<li><a href="../official/recipes/structuring-reducers/refactoring-reducer-example.html" class="menu__link">Refactoring Reducers Example</a></li>
<li><a href="../official/recipes/structuring-reducers/using-combinereducers.html" class="menu__link">Using combineReducers</a></li>
<li><a href="../official/recipes/structuring-reducers/beyond-combinereducers.html" class="menu__link">Beyond combineReducers</a></li>
<li><a href="../official/recipes/structuring-reducers/normalizing-state-shape.html" class="menu__link">Normalizing State Shape</a></li>
<li><a href="../official/recipes/structuring-reducers/updating-normalized-data.html" class="menu__link">Updating Normalized Data</a></li>
<li><a href="../official/recipes/structuring-reducers/reusing-reducer-logic.html" class="menu__link">Reusing Reducer Logic</a></li>
<li><a href="../official/recipes/structuring-reducers/immutable-update-patterns.html" class="menu__link">Immutable Update Patterns</a></li>
<li><a href="../official/recipes/structuring-reducers/initializing-state.html" class="menu__link">Initializing State</a></li>
</ul></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">Understanding Redux</a>
<ul>
<li><a href="#!" class="menu__link menu__link--sublist">Thinking in Redux</a>
<ul>
<li><a href="../official/understanding/thinking-in-redux/motivation.html" class="menu__link">Motivation</a></li>
<li><a href="../official/understanding/thinking-in-redux/three-principles.html" class="menu__link">Three Principles</a></li>
<li><a href="../official/understanding/thinking-in-redux/glossary.html" class="menu__link">Glossary</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">History and Design</a>
<ul>
<li><a href="../official/understanding/history-and-design/prior-art.html" class="menu__link">Prior Art</a></li>
<li><a href="../official/understanding/history-and-design/middleware.html" class="menu__link">Middleware</a></li>
</ul></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">FAQ</a>
<ul>
<li><a href="../official/faq.html" class="menu__link">FAQ Index</a></li>
<li><a href="../official/faq/general.html" class="menu__link">General</a></li>
<li><a href="../official/faq/reducers.html" class="menu__link">Reducers</a></li>
<li><a href="../official/faq/organizing-state.html" class="menu__link">Organizing State</a></li>
<li><a href="../official/faq/store-setup.html" class="menu__link">Store Setup</a></li>
<li><a href="../official/faq/actions.html" class="menu__link">Actions</a></li>
<li><a href="../official/faq/immutable-data.html" class="menu__link">Immutable Data</a></li>
<li><a href="../official/faq/code-structure.html" class="menu__link">Code Structure</a></li>
<li><a href="../official/faq/performance.html" class="menu__link">Performance</a></li>
<li><a href="../official/faq/design-decisions.html" class="menu__link">Design Decisions</a></li>
<li><a href="../official/faq/react-redux.html" class="menu__link">React Redux</a></li>
<li><a href="../official/faq/miscellaneous.html" class="menu__link">Miscellaneous</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">Style Guide</a>
<ul>
<li><a href="../official/style-guide/style-guide.html" class="menu__link">Style Guide: Best Practices</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">API Reference</a>
<ul>
<li><a href="../official/api/api-reference.html" class="menu__link">API Reference</a></li>
<li><a href="../official/api/createstore.html" class="menu__link">createStore</a></li>
<li><a href="../official/api/store.html" class="menu__link">Store</a></li>
<li><a href="../official/api/combinereducers.html" class="menu__link">combineReducers</a></li>
<li><a href="../official/api/applymiddleware.html" class="menu__link">applyMiddleware</a></li>
<li><a href="../official/api/bindactioncreators.html" class="menu__link">bindActionCreators</a></li>
<li><a href="../official/api/compose.html" class="menu__link">compose</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">Redux Toolkit</a>
<ul>
<li><a href="../official/redux-toolkit/overview.html" class="menu__link">Redux Toolkit: Overview</a></li>
</ul></li>
</ul>
<h1 id="redux-essentials-part-6-performance-and-normalizing-data"><span id="redux-essentials-part-6-performance-and-normalizing-data" class="anchor enhancedAnchor_2LWZ"></span>Redux Essentials, Part 6: Performance and Normalizing Data<a href="#redux-essentials-part-6-performance-and-normalizing-data" class="hash-link" title="Direct link to heading">#</a></h1>
<h5 id="what-youll-learn"><span class="admonition-icon"> </span>What You’ll Learn</h5>
<ul>
<li>How to create memoized selector functions with <code>createSelector</code></li>
<li>Patterns for optimizing component rendering performance</li>
<li>How to use <code>createEntityAdapter</code> to store and update normalized data</li>
</ul>
<h5 id="prerequisites"><span class="admonition-icon"> </span>Prerequisites</h5>
<ul>
<li>Completion of the previous sections of this tutorial</li>
</ul>
<h2 id="introduction"><span id="introduction" class="anchor enhancedAnchor_2LWZ"></span>Introduction<a href="#introduction" class="hash-link" title="Direct link to heading">#</a></h2>
<p>In <a href="part-5-async-logic.html">Part 5: Async Logic and Data Fetching</a>, we saw how to write async thunks to fetch data from a server API, patterns for handling async request loading state, and use of selector functions for encapsulating lookups of data from the Redux state.</p>
<p>In this final section, we’ll look at optimized patterns for ensuring good performance in our application, and techniques for automatically handling common updates of data in the store.</p>
<p>So far, most of our functionality has been centered around the <code>posts</code> feature. We’re going to add a couple new sections of the app. After those are added, we’ll look at some specific details of how we’ve built things, and talk about some weaknesses with what we’ve built so far and how we can improve the implementation.</p>
<h2 id="adding-user-pages"><span id="adding-user-pages" class="anchor enhancedAnchor_2LWZ"></span>Adding User Pages<a href="#adding-user-pages" class="hash-link" title="Direct link to heading">#</a></h2>
<p>We’re fetching a list of users from our fake API, and we can choose a user as the author when we add a new post. But, a social media app needs the ability to look at the page for a specific user and see all the posts they’ve made. Let’s add a page to show the list of all users, and another to show all posts by a specific user.</p>
<p>We’ll start by adding a new <code>&lt;UsersList&gt;</code> component. It follows the usual pattern of reading some data from the store with <code>useSelector</code>, and mapping over the array to show a list of users with links to their individual pages:</p>
<p>features/users/UsersList.js</p>
<p><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> React </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> useSelector </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react-redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> Link </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react-router-dom’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> selectAllUsers </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./usersSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">UsersList</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> users </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">selectAllUsers</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> renderedUsers </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> users</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token function" style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">user</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">li</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">key</span><span class="token tag script language-javascript script-punctuation punctuation" style="color: #f8f8f2">=</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">{</span><span class="token tag script language-javascript" style="color: #f92672">user</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">.</span><span class="token tag script language-javascript" style="color: #f92672">id</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">}</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag class-name" style="color: #f92672">Link</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">to</span><span class="token tag script language-javascript script-punctuation punctuation" style="color: #f8f8f2">=</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">{</span><span class="token tag script language-javascript template-string template-punctuation string" style="color: #a6e22e">`</span><span class="token tag script language-javascript template-string string" style="color: #a6e22e">/users/</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">${</span><span class="token tag script language-javascript template-string interpolation" style="color: #f92672">user</span><span class="token tag script language-javascript template-string interpolation punctuation" style="color: #f8f8f2">.</span><span class="token tag script language-javascript template-string interpolation" style="color: #f92672">id</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">}</span><span class="token tag script language-javascript template-string template-punctuation string" style="color: #a6e22e">`</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">}</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">user</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token plain">name</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag class-name" style="color: #f92672">Link</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">li</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">section</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">h2</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain">Users</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">h2</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">ul</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">renderedUsers</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">ul</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">section</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>We don’t yet have a <code>selectAllUsers</code> selector, so we’ll need to add that to <code>usersSlice.js</code> along with a <code>selectUserById</code> selector:</p>
<p>features/users/usersSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> usersSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reducer</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectAllUsers</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">users</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectUserById</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">users</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">find</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">user</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> user</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span>And we’ll add a <code>&lt;UserPage&gt;</code>, which is similar to our <code>&lt;SinglePostPage&gt;</code> in taking a <code>userId</code> parameter from the router:</p>
<p>features/users/UserPage.js</p>
<p><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> React </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> useSelector </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react-redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> Link </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react-router-dom’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> selectUserById </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../users/usersSlice’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> selectAllPosts </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../posts/postsSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">UserPage</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter punctuation" style="color: #f8f8f2">{</span><span class="token parameter"> match </span><span class="token parameter punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> userId </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> match</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token plain">params</span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> user </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">selectUserById</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postsForUser </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> allPosts </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">selectAllPosts</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">return</span><span class="token plain"> allPosts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token function" style="color: #e6d874">filter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">post</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> post</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token plain">user </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postTitles </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> postsForUser</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token function" style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">post</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">li</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">key</span><span class="token tag script language-javascript script-punctuation punctuation" style="color: #f8f8f2">=</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">{</span><span class="token tag script language-javascript" style="color: #f92672">post</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">.</span><span class="token tag script language-javascript" style="color: #f92672">id</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">}</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag class-name" style="color: #f92672">Link</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">to</span><span class="token tag script language-javascript script-punctuation punctuation" style="color: #f8f8f2">=</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">{</span><span class="token tag script language-javascript template-string template-punctuation string" style="color: #a6e22e">`</span><span class="token tag script language-javascript template-string string" style="color: #a6e22e">/posts/</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">${</span><span class="token tag script language-javascript template-string interpolation" style="color: #f92672">post</span><span class="token tag script language-javascript template-string interpolation punctuation" style="color: #f8f8f2">.</span><span class="token tag script language-javascript template-string interpolation" style="color: #f92672">id</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">}</span><span class="token tag script language-javascript template-string template-punctuation string" style="color: #a6e22e">`</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">}</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">post</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token plain">title</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag class-name" style="color: #f92672">Link</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">li</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">section</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">h2</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">user</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token plain">name</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">h2</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">ul</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">postTitles</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">ul</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">section</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>As we’ve seen before, we can take data from one <code>useSelector</code> call, or from props, and use that to help decide what to read from the store in another <code>useSelector</code> call.</p>
<p>Add routes for these components in <code>&lt;App&gt;</code>:</p>
<p>App.js</p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag class-name" style="color: #f92672">Route</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">exact</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">path</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">/posts/:postId</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">component</span><span class="token tag script language-javascript script-punctuation punctuation" style="color: #f8f8f2">=</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">{</span><span class="token tag script language-javascript" style="color: #f92672">SinglePostPage</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">}</span><span class="token tag" style="color: #f92672"> </span><span class="token tag punctuation" style="color: #f8f8f2">/&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag class-name" style="color: #f92672">Route</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">exact</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">path</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">/editPost/:postId</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">component</span><span class="token tag script language-javascript script-punctuation punctuation" style="color: #f8f8f2">=</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">{</span><span class="token tag script language-javascript" style="color: #f92672">EditPostForm</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">}</span><span class="token tag" style="color: #f92672"> </span><span class="token tag punctuation" style="color: #f8f8f2">/&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag class-name" style="color: #f92672">Route</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">exact</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">path</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">/users</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">component</span><span class="token tag script language-javascript script-punctuation punctuation" style="color: #f8f8f2">=</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">{</span><span class="token tag script language-javascript" style="color: #f92672">UsersList</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">}</span><span class="token tag" style="color: #f92672"> </span><span class="token tag punctuation" style="color: #f8f8f2">/&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag class-name" style="color: #f92672">Route</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">exact</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">path</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">/users/:userId</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">component</span><span class="token tag script language-javascript script-punctuation punctuation" style="color: #f8f8f2">=</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">{</span><span class="token tag script language-javascript" style="color: #f92672">UserPage</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">}</span><span class="token tag" style="color: #f92672"> </span><span class="token tag punctuation" style="color: #f8f8f2">/&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag class-name" style="color: #f92672">Redirect</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">to</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">/</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag" style="color: #f92672"> </span><span class="token tag punctuation" style="color: #f8f8f2">/&gt;</span>And add another tab in <code>&lt;Navbar&gt;</code> that links to <code>/users</code> so that we can click and go to <code>&lt;UsersList&gt;</code>.</p>
<h2 id="adding-notifications"><span id="adding-notifications" class="anchor enhancedAnchor_2LWZ"></span>Adding Notifications<a href="#adding-notifications" class="hash-link" title="Direct link to heading">#</a></h2>
<p>No social media app would be complete without some notifications popping up to tell us that someone has sent a message, left a comment, or reacted to one of our posts.</p>
<p>In a real application, our app client would be in constant communication with the backend server, and the server would push an update to the client every time something happens. Since this is a small example app, we’re going to mimic that process by adding a button to actually fetch some notification entries from our fake API. We also don’t have any other <em>real</em> users sending messages or reacting to posts, so the fake API will just create some random notification entries every time we make a request. (Remember, the goal here is to see how to use Redux itself.)</p>
<h3 id="notifications-slice"><span id="notifications-slice" class="anchor enhancedAnchor_2LWZ"></span>Notifications Slice<a href="#notifications-slice" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Since this is a new part of our app, the first step is to create a new slice for our notifications, and an async thunk to fetch some notification entries from the API:</p>
<p>features/notifications/notificationsSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createSlice</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> createAsyncThunk </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘<span class="citation" data-cites="reduxjs/toolkit">@reduxjs/toolkit</span>’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> client </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../../api/client’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> fetchNotifications </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createAsyncThunk</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘notifications/fetchNotifications’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">_</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color: #f8f8f2">{</span><span class="token parameter"> getState </span><span class="token parameter punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> allNotifications </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">selectAllNotifications</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">latestNotification</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> allNotifications</span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> latestTimestamp </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> latestNotification </span><span class="token operator" style="color: #f8f8f2">?</span><span class="token plain"> latestNotification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">date</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">’’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">get</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color: #a6e22e">`</span><span class="token template-string string" style="color: #a6e22e">/fakeApi/notifications?since=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">${</span><span class="token template-string interpolation">latestTimestamp</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: #f8f8f2">}</span><span class="token template-string template-punctuation string" style="color: #a6e22e">`</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">notifications</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> notificationsSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘notifications’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> initialState</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">fetchNotifications</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">push</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Sort with newest first</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">sort</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">a</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> b</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> b</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">date</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">localeCompare</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">date</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> notificationsSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reducer</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectAllNotifications</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">notifications</span>As with the other slices, import <code>notificationsReducer</code> into <code>store.js</code> and add it to the <code>configureStore()</code> call.</p>
<p>We’ve written an async thunk called <code>fetchNotifications</code>, which will retrieve a list of new notifications from the server. As part of that, we want to use the creation timestamp of the most recent notification as part of our request, so that the server knows it should only send back notifications that are actually new.</p>
<p>We know that we will be getting back an array of notifications, so we can pass them as separate arguments to <code>state.push()</code>, and the array will add each item. We also want to make sure that they’re sorted so that the most recent notification is last in the array, just in case the server were to send them out of order. (As a reminder, <code>array.sort()</code> always mutates the existing array - this is only safe because we’re using <code>createSlice</code> and Immer inside.)</p>
<h3 id="thunk-arguments"><span id="thunk-arguments" class="anchor enhancedAnchor_2LWZ"></span>Thunk Arguments<a href="#thunk-arguments" class="hash-link" title="Direct link to heading">#</a></h3>
<p>If you look at our <code>fetchNotifications</code> thunk, it has something new that we haven’t seen before. Let’s talk about thunk arguments for a minute.</p>
<p>We’ve already seen that we can pass an argument into a thunk action creator when we dispatch it, like <code>dispatch(addPost(newPost))</code>. For <code>createAsyncThunk</code> specifically, you can only pass in one argument, and whatever we pass in becomes the first argument of the payload creation callback.</p>
<p>The second argument to our payload creator is a <code>thunkAPI</code> object containing several useful functions and pieces of information:</p>
<ul>
<li><code>dispatch</code> and <code>getState</code>: the actual <code>dispatch</code> and <code>getState</code> methods from our Redux store. You can use these inside the thunk to dispatch more actions, or get the latest Redux store state (such as reading an updated value after another action is dispatched).</li>
<li><code>extra</code>: the “extra argument” that can be passed into the thunk middleware when creating the store. This is typically some kind of API wrapper, such as a set of functions that know how to make API calls to your application’s server and return data, so that your thunks don’t have to have all the URLs and query logic directly inside.</li>
<li><code>requestId</code>: a unique random ID value for this thunk call. Useful for tracking status of an individual request.</li>
<li><code>signal</code>: An <code>AbortController.signal</code> function that can be used to cancel an in-progress request.</li>
<li><code>rejectWithValue</code>: a utility that helps customize the contents of a <code>rejected</code> action if the thunk receives an error.</li>
</ul>
<p>(If you’re writing a thunk by hand instead of using <code>createAsyncThunk</code>, the thunk function will get<code>(dispatch, getState)</code> as separate arguments, instead of putting them together in one object.)</p>
<h5 id="info"><span class="admonition-icon"> </span>info</h5>
<p>For more details on these arguments and how to handle canceling thunks and requests, see <a href="../../../redux-toolkit.js.org/api/createAsyncThunk.html">the <code>createAsyncThunk</code> API reference page</a>.</p>
<p>In this case, we know that the list of notifications is in our Redux store state, and that the latest notification should be first in the array. We can destructure the <code>getState</code> function out of the <code>thunkAPI</code> object, call it to read the state value, and use the <code>selectAllNotifications</code> selector to give us just the array of notifications. Since the array of notifications is sorted newest first, we can grab the latest one using array destructuring.</p>
<h3 id="adding-the-notifications-list"><span id="adding-the-notifications-list" class="anchor enhancedAnchor_2LWZ"></span>Adding the Notifications List<a href="#adding-the-notifications-list" class="hash-link" title="Direct link to heading">#</a></h3>
<p>With that slice created, we can add a <code>&lt;NotificationsList&gt;</code> component:</p>
<p>features/notifications/NotificationsList.js</p>
<p><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> React </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> useSelector </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react-redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> formatDistanceToNow</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> parseISO </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘date-fns’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> selectAllUsers </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../users/usersSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> selectAllNotifications </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./notificationsSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">NotificationsList</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> notifications </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">selectAllNotifications</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> users </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">selectAllUsers</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> renderedNotifications </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> notifications</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token function" style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">notification</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> date </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">parseISO</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token plain">date</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> timeAgo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">formatDistanceToNow</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">date</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> user </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> users</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token function" style="color: #e6d874">find</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">user</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> user</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token plain">id </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token plain">user</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">||</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Unknown User’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">div</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">key</span><span class="token tag script language-javascript script-punctuation punctuation" style="color: #f8f8f2">=</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">{</span><span class="token tag script language-javascript" style="color: #f92672">notification</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">.</span><span class="token tag script language-javascript" style="color: #f92672">id</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">}</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">className</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">notification</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">div</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">b</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">user</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token plain">name</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">b</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token plain">message</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">div</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">div</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">title</span><span class="token tag script language-javascript script-punctuation punctuation" style="color: #f8f8f2">=</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">{</span><span class="token tag script language-javascript" style="color: #f92672">notification</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">.</span><span class="token tag script language-javascript" style="color: #f92672">date</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">}</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">i</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">timeAgo</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> ago</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">i</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">div</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">div</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">section</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">className</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">notificationsList</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">h2</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain">Notifications</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">h2</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">renderedNotifications</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">section</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>Once again, we’re reading a list of items from the Redux state, mapping over them, and rendering content for each item.</p>
<p>We also need to update the <code>&lt;Navbar&gt;</code> to add a “Notifications” tab, and a new button to fetch some notifications:</p>
<p>app/Navbar.js</p>
<p><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> React </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> useDispatch </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react-redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> Link </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react-router-dom’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> fetchNotifications </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../features/notifications/notificationsSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">Navbar</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useDispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">fetchNewNotifications</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">fetchNotifications</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">nav</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">section</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">h1</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain">Redux Essentials Example</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">h1</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">div</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">className</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">navContent</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">div</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">className</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">navLinks</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag class-name" style="color: #f92672">Link</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">to</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">/</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain">Posts</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag class-name" style="color: #f92672">Link</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag class-name" style="color: #f92672">Link</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">to</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">/users</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain">Users</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag class-name" style="color: #f92672">Link</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag class-name" style="color: #f92672">Link</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">to</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">/notifications</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain">Notifications</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag class-name" style="color: #f92672">Link</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">div</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">button</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">className</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">button</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color: #f8f8f2">=</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">{</span><span class="token tag script language-javascript" style="color: #f92672">fetchNewNotifications</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">}</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> Refresh Notifications</span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">button</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">div</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">section</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">nav</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>Lastly, we need to update <code>App.js</code> with the “Notifications” route so we can navigate to it:</p>
<p>App.js</p>
<p><span class="token comment" style="color: #c6cad2">// omit imports</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> </span><span class="token imports maybe-class-name">NotificationsList</span><span> </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./features/notifications/NotificationsList’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color: #e6d874">App</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">Router</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">Navbar</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">div className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“App”</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">Switch</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">Route</span><span class="token plain"> exact path</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“/notifications”</span><span class="token plain"> component</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token maybe-class-name">NotificationsList</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit existing routes</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">Redirect</span><span class="token plain"> to</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“/”</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token maybe-class-name">Switch</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">div</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token maybe-class-name">Router</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>Here’s what the “Notifications” tab looks like so far:</p>
<figure>
<img src="../../../d33wubrfki0l68.cloudfront.net/120f6ecf58b4436202d6881188ee741ec7885fa7/dd938/assets/images/notifications-initial-78eeb6d749f8287ebebe6a8b4e28efa" alt="Initial Notifications tab" /><figcaption>Initial Notifications tab</figcaption>
</figure>
<h3 id="showing-new-notifications"><span id="showing-new-notifications" class="anchor enhancedAnchor_2LWZ"></span>Showing New Notifications<a href="#showing-new-notifications" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Each time we click “Refresh Notifications”, a few more notification entries will be added to our list. In a real app, those could be coming from the server while we’re looking at other parts of the UI. We can do something similar by clicking “Refresh Notifications” while we’re looking at the <code>&lt;PostsList&gt;</code> or <code>&lt;UserPage&gt;</code>. But, right now we have no idea how many notifications just arrived, and if we keep clicking the button, there could be many notifications we haven’t read yet. Let’s add some logic to keep track of which notifications have been read and which of them are “new”. That will let us show the count of “Unread” notifications as a badge on our “Notifications” tab in the navbar, and display new notifications in a different color.</p>
<p>Our fake API is already sending back the notification entries with <code>isNew</code> and <code>read</code> fields, so we can use those in our code.</p>
<p>First, we’ll update <code>notificationsSlice</code> to have a reducer that marks all notifications as read, and some logic to handle marking existing notifications as “not new”:</p>
<p>features/notifications/notificationsSlice.js</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> notificationsSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘notifications’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> initialState</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">allNotificationsRead</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">forEach</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">notification</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">read</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">true</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">fetchNotifications</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">forEach</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">notification</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Any notifications we’ve read are no longer new</span><span class="token plain"></span></p>
<p><span class="token plain"> notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">isNew</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">!</span><span class="token plain">notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">read</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">push</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Sort with newest first</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">sort</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">a</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> b</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> b</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">date</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">localeCompare</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">date</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> allNotificationsRead </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> notificationsSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">actions</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> notificationsSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reducer</span>We want to mark these notifications as read whenever our <code>&lt;NotificationsList&gt;</code> component renders, either because we clicked on the tab to view the notifications, or because we already have it open and we just received some additional notifications. We can do this by dispatching <code>allNotificationsRead</code> in a <code>useEffect</code> hook. We also want to add an additional classname to any notification list entries in the page, to highlight them:</p>
<p>features/notifications/NotificationsList.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> useEffect </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> useSelector</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> useDispatch </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react-redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> formatDistanceToNow</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> parseISO </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘date-fns’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>classnames</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘classnames’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> selectAllUsers </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../users/usersSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span></span></p>
<p><span> selectAllNotifications</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span></span></p>
<p><span> allNotificationsRead</span></p>
<p><span></span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./notificationsSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">NotificationsList</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useDispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> notifications </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">selectAllNotifications</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> users </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">selectAllUsers</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">useEffect</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">allNotificationsRead</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> renderedNotifications </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> notifications</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">notification</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> date </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">parseISO</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">date</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> timeAgo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">formatDistanceToNow</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">date</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> user </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> users</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">find</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">user</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> user</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">user</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">||</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Unknown User’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> notificationClassname </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">classnames</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘notification’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">new</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">isNew</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">div key</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">notificationClassname</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">div</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">b</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">user</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">name</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">b</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">message</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">div</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">div title</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">date</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">i</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">timeAgo</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> ago</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">i</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">div</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">div</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">section className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“notificationsList”</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">h2</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token maybe-class-name">Notifications</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">h2</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">renderedNotifications</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">section</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>This works, but actually has a slightly surprising bit of behavior. Any time there are new notifications (either because we’ve just switched to this tab, or we’ve fetched some new notifications from the API), you’ll actually see <em>two</em> <code>"notifications/allNotificationsRead"</code> actions dispatched. Why is that?</p>
<p>Let’s say we have fetched some notifications while looking at the <code>&lt;PostsList&gt;</code>, and then click the “Notifications” tab. The <code>&lt;NotificationsList&gt;</code> component will mount, and the <code>useEffect</code> callback will run after that first render and dispatch <code>allNotificationsRead</code>. Our <code>notificationsSlice</code> will handle that by updating the notification entries in the store. This creates a new <code>state.notifications</code> array containing the immutably-updated entries, which forces our component to render again because it sees a new array returned from the <code>useSelector</code>, and the <code>useEffect</code> hook runs again and dispatches <code>allNotificationsRead</code> a second time. The reducer runs again, but this time no data changes, so the component doesn’t re-render.</p>
<p>There’s a couple ways we could potentially avoid that second dispatch, like splitting the logic to dispatch once when the component mounts, and only dispatch again if the size of the notifications array changes. But, this isn’t actually hurting anything, so we can leave it alone.</p>
<p>This does actually show that <strong>it’s possible to dispatch an action and not have <em>any</em> state changes happen at all</strong>. Remember, <strong>it’s always up to your reducers to decide <em>if</em> any state actually needs to be updated, and “nothing needs to happen” is a valid decision for a reducer to make</strong>.</p>
<p>Here’s how the notifications tab looks now that we’ve got the “new/read” behavior working:</p>
<figure>
<embed src="../../../d33wubrfki0l68.cloudfront.net/984593d5382b37dbea1f1053a837593a49ba22bd/9ee87/assets/images/notifications-new-47a4cee8ef5292cc65a8b4b89245c112.21" /><figcaption>New notifications</figcaption>
</figure>
<p>The last thing we need to do before we move on is to add the badge on our “Notifications” tab in the navbar. This will show us the count of “Unread” notifications when we are in other tabs:</p>
<p>app/Navbar.js</p>
<p><span class="token comment" style="color: #c6cad2">// omit imports</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> useDispatch</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> useSelector </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react-redux’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span></span></p>
<p><span> fetchNotifications</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span></span></p>
<p><span> selectAllNotifications</span></p>
<p><span></span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../features/notifications/notificationsSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">Navbar</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useDispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> notifications </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">selectAllNotifications</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> numUnreadNotifications </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> notifications</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">filter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">n</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">!</span><span class="token plain">n</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">read</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">length</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit component contents</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">let</span><span class="token plain"> unreadNotificationsBadge</span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">numUnreadNotifications </span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> unreadNotificationsBadge </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">span className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“badge”</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">numUnreadNotifications</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">span</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">nav</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit component contents</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">div className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“navLinks”</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">Link</span><span class="token plain"> to</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“/”</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token maybe-class-name">Posts</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token maybe-class-name">Link</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">Link</span><span class="token plain"> to</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“/users”</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token maybe-class-name">Users</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token maybe-class-name">Link</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">Link</span><span class="token plain"> to</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“/notifications”</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token maybe-class-name">Notifications</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">unreadNotificationsBadge</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token maybe-class-name">Link</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">div</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit component contents</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">nav</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>## <span id="improving-render-performance" class="anchor enhancedAnchor_2LWZ"></span>Improving Render Performance<a href="#improving-render-performance" class="hash-link" title="Direct link to heading">#</a></p>
<p>Our application is looking useful, but we’ve actually got a couple flaws in when and how our components re-render. Let’s look at those problems, and talk about some ways to improve the performance.</p>
<h3 id="investigating-render-behavior"><span id="investigating-render-behavior" class="anchor enhancedAnchor_2LWZ"></span>Investigating Render Behavior<a href="#investigating-render-behavior" class="hash-link" title="Direct link to heading">#</a></h3>
<p>We can use the React DevTools Profiler to view some graphs of what components re-render when state is updated. Try clicking over to the <code>&lt;UserPage&gt;</code> for a single user. Open up your browser’s DevTools, and in the React “Profiler” tab, click the circle “Record” button in the upper-left. Then, click the “Refresh Notifications” button in our app, and stop the recording in the React DevTools Profiler. You should see a chart that looks like this:</p>
<figure>
<embed src="../../../d33wubrfki0l68.cloudfront.net/0cf7b845c03d2f7bef5a077e2dd2e15a2014b3c3/ac98a/assets/images/userpage-rerender-d064bb5a9461960f5949ba996597c3f7.21" /><figcaption>React DevTools Profiler render capture - <UserPage></figcaption>
</figure>
<p>We can see that the <code>&lt;Navbar&gt;</code> re-rendered, which makes sense because it had to show the updated “unread notifications” badge in the tab. But, why did our <code>&lt;UserPage&gt;</code> re-render?</p>
<p>If we inspect the last couple dispatched actions in the Redux DevTools, we can see that only the notifications state updated. Since the <code>&lt;UserPage&gt;</code> doesn’t read any notifications, it shouldn’t have re-rendered. Something must be wrong with the component.</p>
<p>If we look at <code>&lt;UserPage&gt;</code> carefully, there’s a specific problem:</p>
<p>"features/UserPage.js</p>
<p><span class="token keyword" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">UserPage</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter punctuation" style="color: #f8f8f2">{</span><span class="token parameter"> match </span><span class="token parameter punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> userId </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> match</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token plain">params</span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> user </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">selectUserById</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postsForUser </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> allPosts </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">selectAllPosts</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">return</span><span class="token plain"> allPosts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token function" style="color: #e6d874">filter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">post</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> post</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token plain">user </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit rendering logic</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>We know that <code>useSelector</code> will re-run every time an action is dispatched, and that it forces the component to re-render if we return a new reference value.</p>
<p>We’re calling <code>filter()</code> inside of our <code>useSelector</code> hook, so that we only return the list of posts that belong to this user. Unfortunately, <strong>this means that <code>useSelector</code> <em>always</em> returns a new array reference, and so our component will re-render after <em>every</em> action even if the posts data hasn’t changed!</strong>.</p>
<h3 id="memoizing-selector-functions"><span id="memoizing-selector-functions" class="anchor enhancedAnchor_2LWZ"></span>Memoizing Selector Functions<a href="#memoizing-selector-functions" class="hash-link" title="Direct link to heading">#</a></h3>
<p>What we really need is a way to only calculate the new filtered array if either <code>state.posts</code> or <code>userId</code> have changed. If they <em>haven’t</em> changed, we want to return the same filtered array reference as the last time.</p>
<p>This idea is called “memoization”. We want to save a previous set of inputs and the calculated result, and if the inputs are the same, return the previous result instead of recalculating it again.</p>
<p>So far, we’ve been writing selector functions by ourselves, and just so that we don’t have to copy and paste the code for reading data from the store. It would be great if there was a way to make our selector functions memoized.</p>
<p><strong><a href="../../../github.com/reduxjs/reselect.html">Reselect</a> is a library for creating memoized selector functions</strong>, and was specifically designed to be used with Redux. It has a <code>createSelector</code> function that generates memoized selectors that will only recalculate results when the inputs change. Redux Toolkit <a href="../../../redux-toolkit.js.org/api/createSelector.html">exports the <code>createSelector</code> function</a>, so we already have it available.</p>
<p>Let’s make a new <code>selectPostsByUser</code> selector function, using Reselect, and use it here.</p>
<p>features/posts/postsSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createSlice</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> createAsyncThunk</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> createSelector </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘<span class="citation" data-cites="reduxjs/toolkit">@reduxjs/toolkit</span>’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit slice logic</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectAllPosts</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectPostById</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> postId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">find</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">post</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> post</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> postId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> selectPostsByUser </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">selectAllPosts</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> userId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">posts</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">filter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">post</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> post</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">user</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span><code>createSelector</code> takes one or more “input selector” functions as argument, plus an “output selector” function. When we call <code>selectPostsByUser(state, userId)</code>, <code>createSelector</code> will pass all of the arguments into each of our input selectors. Whatever those input selectors return becomes the arguments for the output selector.</p>
<p>In this case, we know that we need the array of all posts and the user ID as the two arguments for our output selector. We can reuse our existing <code>selectAllPosts</code> selector to extract the posts array. Since the user ID is the second argument we’re passing into <code>selectPostsByUser</code>, we can write a small selector that just returns <code>userId</code>.</p>
<p>Our output selector then takes <code>posts</code> and <code>userId</code>, and returns the filtered array of posts for just that user.</p>
<p>If we try calling <code>selectPostsByUser</code> multiple times, it will only re-run the output selector if either <code>posts</code> or <code>userId</code> has changed:</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> state1 </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Output selector runs, because it’s the first call</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token function" style="color: #e6d874">selectPostsByUser</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘user1’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Output selector does _not_ run, because the arguments haven’t changed</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token function" style="color: #e6d874">selectPostsByUser</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘user1’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Output selector runs, because `userId` changed</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token function" style="color: #e6d874">selectPostsByUser</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘user2’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">reactionAdded</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> state2 </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Output selector does not run, because `posts` and `userId` are the same</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token function" style="color: #e6d874">selectPostsByUser</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state2</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘user2’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Add some more posts</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">addNewPost</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> state3 </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Output selector runs, because `posts` has changed</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token function" style="color: #e6d874">selectPostsByUser</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state3</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘user2’</span><span class="token punctuation" style="color: #f8f8f2">)</span>If we call this selector in <code>&lt;UserPage&gt;</code> and re-run the React profiler while fetching notifications, we should see that <code>&lt;UserPage&gt;</code> doesn’t re-render this time:</p>
<p><span class="token keyword" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">UserPage</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter punctuation" style="color: #f8f8f2">{</span><span class="token parameter"> match </span><span class="token parameter punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> userId </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> match</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token plain">params</span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> user </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">selectUserById</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postsForUser </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">selectPostsByUser</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit rendering logic</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>Memoized selectors are a valuable tool for improving performance in a React+Redux application, because they can help us avoid unnecessary re-renders, and also avoid doing potentially complex or expensive calculations if the input data hasn’t changed.</p>
<h3 id="investigating-the-posts-list"><span id="investigating-the-posts-list" class="anchor enhancedAnchor_2LWZ"></span>Investigating the Posts List<a href="#investigating-the-posts-list" class="hash-link" title="Direct link to heading">#</a></h3>
<p>If we go back to our <code>&lt;PostsList&gt;</code> and try clicking a reaction button on one of the posts while capturing a React profiler trace, we’ll see that not only did the <code>&lt;PostsList&gt;</code> and the updated <code>&lt;PostExcerpt&gt;</code> instance render, <em>all</em> of the <code>&lt;PostExcerpt&gt;</code> components rendered:</p>
<figure>
<embed src="../../../d33wubrfki0l68.cloudfront.net/8d04086e52594510bcd63045ef2b0ff81ab0fa06/3fd48/assets/images/postslist-rerender-cf83ea2e96266af8ce3027d614f0c574.2" /><figcaption>React DevTools Profiler render capture - <PostsList></figcaption>
</figure>
<p>Why is that? None of the other posts changed, so why would they need to re-render?</p>
<p><a href="../../../blog.isquaredsoftware.com/2020/05/blogged-answers-a-mostly-complete-guide-to-react-rendering-behavior/index.html"><strong>React’s default behavior is that when a parent component renders, React will recursively render all child components inside of it!</strong></a>. The immutable update of one post object also created a new <code>posts</code> array. Our <code>&lt;PostsList&gt;</code> had to re-render because the <code>posts</code> array was a new reference, so after it rendered, React continued downwards and re-rendered all of the <code>&lt;PostExcerpt&gt;</code> components too.</p>
<p>This isn’t a serious problem for our small example app, but in a larger real-world app, we might have some very long lists or very large component trees, and having all those extra components re-render might slow things down.</p>
<p>There’s a few different ways we could optimize this behavior in <code>&lt;PostsList&gt;</code>.</p>
<p>First, we could wrap the <code>&lt;PostExcerpt&gt;</code> component in <a href="../../../reactjs.org/docs/react-api.html#reactmemo"><code>React.memo()</code></a>, which will ensure that the component inside of it only re-renders if the props have actually changed. This will actually work quite well - try it out and see what happens:</p>
<p>"features/posts/PostsList.js</p>
<p><span class="token keyword" style="color: #f92672">let</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">PostExcerpt</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter punctuation" style="color: #f8f8f2">{</span><span class="token parameter"> post </span><span class="token parameter punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit logic</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain">PostExcerpt </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> React</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token function" style="color: #e6d874">memo</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">PostExcerpt</span><span class="token punctuation" style="color: #f8f8f2">)</span>Another option is to rewrite <code>&lt;PostsList&gt;</code> so that it only selects a list of post IDs from the store instead of the entire <code>posts</code> array, and rewrite <code>&lt;PostExcerpt&gt;</code> so that it receives a <code>postId</code> prop and calls <code>useSelector</code> to read the post object it needs. If <code>&lt;PostsList&gt;</code> gets the same list of IDs as before, it won’t need to re-render, and so only our one changed <code>&lt;PostExcerpt&gt;</code> component should have to render.</p>
<p>Unfortunately, this gets tricky because we also need to have all our posts sorted by date and rendered in the right order. We could update our <code>postsSlice</code> to keep the array sorted at all times, so we don’t have to sort it in the component, and use a memoized selector to extract just the list of post IDs. We could also <a href="../../../react-redux.js.org/api/hooks.html#equality-comparisons-and-updates">customize the comparison function that <code>useSelector</code> runs to check the results</a>, like <code>useSelector(selectPostIds, shallowEqual)</code>, so that will skip re-rendering if the <em>contents</em> of the IDs array haven’t changed.</p>
<p>The last option is to find some way to have our reducer keep a separate array of IDs for all the posts, and only modify that array when posts are added or removed, and do the same rewrite of <code>&lt;PostsList&gt;</code> and <code>&lt;PostExcerpt&gt;</code>. This way, <code>&lt;PostsList&gt;</code> only needs to re-render when that IDs array changes.</p>
<p>Conveniently, Redux Toolkit has a <code>createEntityAdapter</code> function that will help us do just that.</p>
<h2 id="normalizing-data"><span id="normalizing-data" class="anchor enhancedAnchor_2LWZ"></span>Normalizing Data<a href="#normalizing-data" class="hash-link" title="Direct link to heading">#</a></h2>
<p>You’ve seen that a lot of our logic has been looking up items by their ID field. Since we’ve been storing our data in arrays, that means we have to loop over all the items in the array using <code>array.find()</code> until we find the item with the ID we’re looking for.</p>
<p>Realistically, this doesn’t take very long, but if we had arrays with hundreds or thousands of items inside, looking through the entire array to find one item becomes wasted effort. What we need is a way to look up a single item based on its ID, directly, without having to check all the other items. This process is known as “normalization”.</p>
<h3 id="normalized-state-structure"><span id="normalized-state-structure" class="anchor enhancedAnchor_2LWZ"></span>Normalized State Structure<a href="#normalized-state-structure" class="hash-link" title="Direct link to heading">#</a></h3>
<p>“Normalized state” means that:</p>
<ul>
<li>We only have one copy of each particular piece of data in our state, so there’s no duplication</li>
<li>Data that has been normalized is kept in a lookup table, where the item IDs are the keys, and the items themselves are the values.</li>
<li>There may also be an array of all of the IDs for a particular item type</li>
</ul>
<p>JavaScript objects can be used as lookup tables, similar to “maps” or “dictionaries” in other languages. Here’s what the normalized state for a group of <code>user</code> objects might look like:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> users</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> ids</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token string" style="color: #a6e22e">“user1”</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">“user2”</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">“user3”</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token string" style="color: #a6e22e">“user1”</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">id</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">“user1”</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> firstName</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> lastName</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token string" style="color: #a6e22e">“user2”</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">id</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">“user2”</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> firstName</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> lastName</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token string" style="color: #a6e22e">“user3”</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">id</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">“user3”</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> firstName</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> lastName</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>This makes it easy to find a particular <code>user</code> object by its ID, without having to loop through all the other user objects in an array:</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> userId </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘user2’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> userObject </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">users</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">userId</span><span class="token punctuation" style="color: #f8f8f2">]</span>##### <span class="admonition-icon"> </span>info</p>
<p>For more details on why normalizing state is useful, see <a href="../../recipes/structuring-reducers/normalizing-state-shape.html">Normalizing State Shape</a> and the Redux Toolkit Usage Guide section on <a href="../../../redux-toolkit.js.org/usage/usage-guide.html#managing-normalized-data">Managing Normalized Data</a>.</p>
<h3 id="managing-normalized-state-with-createentityadapter"><span id="managing-normalized-state-with-createentityadapter" class="anchor enhancedAnchor_2LWZ"></span>Managing Normalized State with <code>createEntityAdapter</code><a href="#managing-normalized-state-with-createentityadapter" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Redux Toolkit’s <code>createEntityAdapter</code> API provides a standardized way to store your data in a slice by taking a collection of items and putting them into the shape of <code>{ ids: [], entities: {} }</code>. Along with this predefined state shape, it generates a set of reducer functions and selectors that know how to work with that data.</p>
<p>This has several benefits:</p>
<ul>
<li>We don’t have to write the code to manage the normalization ourselves</li>
<li><code>createEntityAdapter</code>’s pre-built reducer functions handle common cases like “add all these items”, “update one item”, or “remove multiple items”</li>
<li><code>createEntityAdapter</code> can keep the ID array in a sorted order based on the contents of the items, and will only update that array if items are added / removed or the sorting order changes.</li>
</ul>
<p><code>createEntityAdapter</code> accepts an options object that may include a <code>sortComparer</code> function, which will be used to keep the item IDs array in sorted order by comparing two items (and works the same way as <code>Array.sort()</code>).</p>
<p>It returns an object that contains <a href="../../../redux-toolkit.js.org/api/createEntityAdapter.html#crud-functions">a set of generated reducer functions for adding, updating, and removing items from an entity state object</a>. These reducer functions can either be used as a case reducer for a specific action type, or as a “mutating” utility function within another reducer in <code>createSlice</code>.</p>
<p>The adapter object also has a <code>getSelectors</code> function. You can pass in a selector that returns this particular slice of state from the Redux root state, and it will generate selectors like <code>selectAll</code> and <code>selectById</code>.</p>
<p>Finally, the adapter object has a <code>getInitialState</code> function that generates an empty <code>{ids: [], entities: {}}</code> object. You can pass in more fields to <code>getInitialState</code>, and those will be merged in.</p>
<h3 id="updating-the-posts-slice"><span id="updating-the-posts-slice" class="anchor enhancedAnchor_2LWZ"></span>Updating the Posts Slice<a href="#updating-the-posts-slice" class="hash-link" title="Direct link to heading">#</a></h3>
<p>With that in mind, let’s update our <code>postsSlice</code> to use <code>createEntityAdapter</code>:</p>
<p>features/posts/postsSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> createEntityAdapter</span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit other imports</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘<span class="citation" data-cites="reduxjs/toolkit">@reduxjs/toolkit</span>’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postsAdapter </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createEntityAdapter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">sortComparer</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">a</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> b</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> b</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">date</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">localeCompare</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">date</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> postsAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getInitialState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> error</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color: #f92672">null</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit thunks</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> postsSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘posts’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">reactionAdded</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> postId</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> reaction </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> existingPost </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">postId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">existingPost</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> existingPost</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reactions</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">reaction</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token operator" style="color: #f8f8f2">++</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">postUpdated</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> id</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> title</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> content </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> existingPost </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">id</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">existingPost</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> existingPost</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">title</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> title</span></p>
<p><span class="token plain"> existingPost</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">content</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> content</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit other reducers</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">fetchPosts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘succeeded’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Add any fetched posts to the array</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Use the `upsertMany` reducer as a mutating update utility</span><span class="token plain"></span></p>
<p><span class="token plain"> postsAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">upsertMany</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Use the `addOne` reducer for the fulfilled case</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">addNewPost</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> postsAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">addOne</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> postAdded</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> postUpdated</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> reactionAdded </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> postsSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">actions</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> postsSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reducer</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Export the customized selectors for this adapter using `getSelectors`</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> selectAll</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> selectAllPosts</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> selectById</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> selectPostById</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> selectIds</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> selectPostIds</span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Pass in a selector that returns the posts slice of state</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> postsAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getSelectors</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> selectPostsByUser </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">selectAllPosts</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> userId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">posts</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> posts</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">filter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">post</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> post</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">user</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> userId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span>There’s a lot going on there! Let’s break it down.</p>
<p>First, we import <code>createEntityAdapter</code>, and call it to create our <code>postsAdapter</code> object. We know that we want to keep an array of all post IDs sorted with the newest post first, so we pass in a <code>sortComparer</code> function that will sort newer items to the front based on the <code>post.date</code> field.</p>
<p><code>getInitialState()</code> returns an empty <code>{ids: [], entities: {}}</code> normalized state object. Our <code>postsSlice</code> needs to keep the <code>status</code> and <code>error</code> fields for loading state too, so we pass those in to <code>getInitialState()</code>.</p>
<p>Now that our posts are being kept as a lookup table in <code>state.entities</code>, we can change our <code>reactionAdded</code> and <code>postUpdated</code> reducers to directly look up the right posts by their IDs, instead of having to loop over the old <code>posts</code> array.</p>
<p>When we receive the <code>fetchPosts.fulfilled</code> action, we can use the <code>postsAdapter.upsertMany</code> function to add all of the incoming posts to the state, by passing in the draft <code>state</code> and the array of posts in <code>action.payload</code>. If there’s any items in <code>action.payload</code> that already existing in our state, the <code>upsertMany</code> function will merge them together based on matching IDs.</p>
<p>When we receive the <code>addNewPost.fulfilled</code> action, we know we need to add that one new post object to our state. We can use the adapter functions as reducers directly, so we’ll pass <code>postsAdapter.addOne</code> as the reducer function to use to handle that action.</p>
<p>Finally, we can replace the old hand-written <code>selectAllPosts</code> and <code>selectPostById</code> selector functions with the ones generated by <code>postsAdapter.getSelectors</code>. Since the selectors are called with the root Redux state object, they need to know where to find our posts data in the Redux state, so we pass in a small selector that returns <code>state.posts</code>. The generated selector functions are always called <code>selectAll</code> and <code>selectById</code>, so we can use ES6 destructuring syntax to rename them as we export them and match the old selector names. We’ll also export <code>selectPostIds</code> the same way, since we want to read the list of sorted post IDs in our <code>&lt;PostsList&gt;</code> component.</p>
<h3 id="optimizing-the-posts-list"><span id="optimizing-the-posts-list" class="anchor enhancedAnchor_2LWZ"></span>Optimizing the Posts List<a href="#optimizing-the-posts-list" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Now that our posts slice is using <code>createEntityAdapter</code>, we can update <code>&lt;PostsList&gt;</code> to optimize its rendering behavior.</p>
<p>We’ll update <code>&lt;PostsList&gt;</code> to read just the sorted array of post IDs, and pass <code>postId</code> to each <code>&lt;PostExcerpt&gt;</code>:</p>
<p>features/posts/PostsList.js</p>
<p><span class="token comment" style="color: #c6cad2">// omit other imports</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> selectAllPosts</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> fetchPosts</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> selectPostIds</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> selectPostById</span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./postsSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">let</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">PostExcerpt</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter punctuation" style="color: #f8f8f2">{</span><span class="token parameter"> postId </span><span class="token parameter punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> post </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">selectPostById</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> postId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit rendering logic</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">PostsList</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useDispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> orderedPostIds </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">selectPostIds</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit other selections and effects</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">postStatus </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘loading’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> content </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">div</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">className</span><span class="token tag attr-value punctuation attr-equals" style="color: #f8f8f2">=</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag attr-value" style="color: #e6d874">loader</span><span class="token tag attr-value punctuation" style="color: #f8f8f2">"</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain">Loading</span><span class="token operator" style="color: #f8f8f2">…</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">div</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">else</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">postStatus </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘succeeded’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> content </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> orderedPostIds</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token function" style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">postId</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag class-name" style="color: #f92672">PostExcerpt</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">key</span><span class="token tag script language-javascript script-punctuation punctuation" style="color: #f8f8f2">=</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">{</span><span class="token tag script language-javascript" style="color: #f92672">postId</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">}</span><span class="token tag" style="color: #f92672"> </span><span class="token tag attr-name" style="color: #a6e22e">postId</span><span class="token tag script language-javascript script-punctuation punctuation" style="color: #f8f8f2">=</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">{</span><span class="token tag script language-javascript" style="color: #f92672">postId</span><span class="token tag script language-javascript punctuation" style="color: #f8f8f2">}</span><span class="token tag" style="color: #f92672"> </span><span class="token tag punctuation" style="color: #f8f8f2">/&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">else</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">postStatus </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘error’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> content </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token tag punctuation" style="color: #f8f8f2">&lt;</span><span class="token tag" style="color: #f92672">div</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">error</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token tag punctuation" style="color: #f8f8f2">&lt;/</span><span class="token tag" style="color: #f92672">div</span><span class="token tag punctuation" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit other rendering</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>Now, if we try clicking a reaction button on one of the posts while capturing a React component performance profile, we should see that <em>only</em> that one component re-rendered:</p>
<figure>
<img src="../../../d33wubrfki0l68.cloudfront.net/fb91b859b4afee5d008830dce454eda1dce33516/9fb6f/assets/images/postslist-optimized-dcf59b403248250ec88d365fe04221ad" alt="React DevTools Profiler render capture - optimized " /><figcaption>React DevTools Profiler render capture - optimized <PostsList></figcaption>
</figure>
<h2 id="converting-other-slices"><span id="converting-other-slices" class="anchor enhancedAnchor_2LWZ"></span>Converting Other Slices<a href="#converting-other-slices" class="hash-link" title="Direct link to heading">#</a></h2>
<p>We’re almost done. As a final cleanup step, we’ll update our other two slices to use <code>createEntityAdapter</code> as well.</p>
<h3 id="converting-the-users-slice"><span id="converting-the-users-slice" class="anchor enhancedAnchor_2LWZ"></span>Converting the Users Slice<a href="#converting-the-users-slice" class="hash-link" title="Direct link to heading">#</a></h3>
<p>The <code>usersSlice</code> is fairly small, so we’ve only got a few things to change:</p>
<p>features/users/usersSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span></span></p>
<p><span> createSlice</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span></span></p>
<p><span> createAsyncThunk</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span></span></p>
<p><span> createEntityAdapter</span></p>
<p><span></span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘<span class="citation" data-cites="reduxjs/toolkit">@reduxjs/toolkit</span>’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> client </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../../api/client’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> usersAdapter </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createEntityAdapter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> usersAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getInitialState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> fetchUsers </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createAsyncThunk</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘users/fetchUsers’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">get</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘/fakeApi/users’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">users</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> usersSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘users’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">fetchUsers</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> usersAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">setAll</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> usersSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reducer</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> selectAll</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> selectAllUsers</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> selectById</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> selectUserById </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"></span></p>
<p><span class="token plain"> usersAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getSelectors</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">users</span><span class="token punctuation" style="color: #f8f8f2">)</span>The only action we’re handling here always replaces the entire list of users with the array we fetched from the server. We can use <code>usersAdapter.setAll</code> to implement that instead.</p>
<p>Our <code>&lt;AddPostForm&gt;</code> is still trying to read <code>state.users</code> as an array, as is <code>&lt;PostAuthor&gt;</code>. Update them to use <code>selectAllUsers</code> and <code>selectUserById</code>, respectively.</p>
<h3 id="converting-the-notifications-slice"><span id="converting-the-notifications-slice" class="anchor enhancedAnchor_2LWZ"></span>Converting the Notifications Slice<a href="#converting-the-notifications-slice" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Last but not least, we’ll update <code>notificationsSlice</code> as well:</p>
<p>features/notifications/notificationsSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span></span></p>
<p><span> createSlice</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span></span></p>
<p><span> createAsyncThunk</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span></span></p>
<p><span> createEntityAdapter</span></p>
<p><span></span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘<span class="citation" data-cites="reduxjs/toolkit">@reduxjs/toolkit</span>’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> client </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../../api/client’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> notificationsAdapter </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createEntityAdapter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">sortComparer</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">a</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> b</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> b</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">date</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">localeCompare</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">date</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit fetchNotifications thunk</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> notificationsSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘notifications’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> initialState</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> notificationsAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getInitialState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">allNotificationsRead</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">values</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">forEach</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">notification</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">read</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">true</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">fetchNotifications</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">values</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">forEach</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">notification</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Any notifications we’ve read are no longer new</span><span class="token plain"></span></p>
<p><span class="token plain"> notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">isNew</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">!</span><span class="token plain">notification</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">read</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> notificationsAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">upsertMany</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> allNotificationsRead </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> notificationsSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">actions</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> notificationsSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reducer</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> selectAll</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> selectAllNotifications </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"></span></p>
<p><span class="token plain"> notificationsAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getSelectors</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">notifications</span><span class="token punctuation" style="color: #f8f8f2">)</span>We again import <code>createEntityAdapter</code>, call it, and call <code>notificationsAdapter.getInitialState()</code> to help set up the slice.</p>
<p>Ironically, we do have a couple places in here where we need to loop over all notification objects and update them. Since those are no longer being kept in an array, we have to use <code>Object.values(state.entities)</code> to get an array of those notifications and loop over that. On the other hand, we can replace the previous fetch update logic with <code>notificationsAdapter.upsertMany</code>.</p>
<p>And with that… we’re done!</p>
<h2 id="what-youve-learned"><span id="what-youve-learned" class="anchor enhancedAnchor_2LWZ"></span>What You’ve Learned<a href="#what-youve-learned" class="hash-link" title="Direct link to heading">#</a></h2>
<p>Congratulations, you’ve completed the Redux Essentials tutorial! Let’s see what the final app looks like in action:</p>
<p>Here’s what we covered in this section:</p>
<h5 id="summary"><span class="admonition-icon"> </span>Summary</h5>
<ul>
<li><strong>Memoized selector functions can be used to optimize performance</strong>
<ul>
<li>Redux Toolkit re-exports the <code>createSelector</code> function from Reselect, which generates memoized selectors</li>
<li>Memoized selectors will only recalculate the results if the input selectors return new values</li>
<li>Memoization can skip expensive calculations, and ensure the same result references are returned</li>
</ul></li>
<li><strong>There are multiple patterns you can use to optimize React component rendering with Redux</strong>
<ul>
<li>Avoid creating new object/array references inside of <code>useSelector</code> - those will cause unnecessary re-renders</li>
<li>Memoized selector functions can be passed to <code>useSelector</code> to optimize rendering</li>
<li><code>useSelector</code> can accept an alternate comparison function like <code>shallowEqual</code> instead of reference equality</li>
<li>Components can be wrapped in <code>React.memo()</code> to only re-render if their props change</li>
<li>List rendering can be optimized by having list parent components read just an array of item IDs, passing the IDs to list item children, and retrieving items by ID in the children</li>
</ul></li>
<li><strong>Normalized state structure is a recommended approach for storing items</strong>
<ul>
<li>“Normalization” means no duplication of data, and keeping items stored in a lookup table by item ID</li>
<li>Normalized state shape usually looks like <code>{ids: [], entities: {}}</code></li>
</ul></li>
<li><strong>Redux Toolkit’s <code>createEntityAdapter</code> API helps manage normalized data in a slice</strong>
<ul>
<li>Item IDs can be kept in sorted order by passing in a <code>sortComparer</code> option</li>
<li>The adapter object includes:
<ul>
<li><code>adapter.getInitialState</code>, which can accept additional state fields like loading state</li>
<li>Prebuilt reducers for common cases, like <code>setAll</code>, <code>addMany</code>, <code>upsertOne</code>, and <code>removeMany</code></li>
<li><code>adapter.getSelectors</code>, which generates selectors like <code>selectAll</code> and <code>selectById</code></li>
</ul></li>
</ul></li>
</ul>
<h2 id="whats-next"><span id="whats-next" class="anchor enhancedAnchor_2LWZ"></span>What’s Next?<a href="#whats-next" class="hash-link" title="Direct link to heading">#</a></h2>
<p>The concepts we’ve covered in this tutorial should be enough to get you started building your own applications using React and Redux. Now’s a great time to try working on a project yourself to solidify these concepts and see how they work in practice. If you’re not sure what kind of a project to build, see <a href="../../../github.com/florinpop17/app-ideas.html">this list of app project ideas</a> for some inspiration.</p>
<p>The Redux Essentials tutorial focused on “how to use Redux correctly”, rather than “how it works” or “why it works this way”. In particular, Redux Toolkit is a higher-level set of abstractions and utilities, and it’s helpful to understand what the abstractions in RTK are actually doing for you. Reading through the <a href="../fundamentals/part-1-overview.html">“Redux Fundamentals” tutorial</a> will help you understand how to write Redux code “by hand”, and why we recommend Redux Toolkit as the default way to write Redux logic.</p>
<p>The <a href="../../recipes/recipe-index.html">Recipes</a> section has information on a number of important concepts, like <a href="../../recipes/structuring-reducers/structuring-reducers.html">how to structure your reducers</a>, and <a href="../../style-guide/style-guide.html">our Style Guide page</a> has important information on our recommended patterns and best practices.</p>
<p>If you’d like to know more about <em>why</em> Redux exists, what problems it tries to solve, and how it’s meant to be used, see Redux maintainer Mark Erikson’s posts on <a href="../../../blog.isquaredsoftware.com/2017/05/idiomatic-redux-tao-of-redux-part-1/index.html">The Tao of Redux, Part 1: Implementation and Intent</a> and <a href="../../../blog.isquaredsoftware.com/2017/05/idiomatic-redux-tao-of-redux-part-2/index.html">The Tao of Redux, Part 2: Practice and Philosophy</a>.</p>
<p>If you’re looking for help with Redux questions, come join <a href="../../../www.reactiflux.com/index.html">the <code>#redux</code> channel in the Reactiflux server on Discord</a>.</p>
<p><strong>Thanks for reading through this tutorial, and we hope you enjoy building applications with Redux!</strong></p>
<p><a href="part-5-async-logic.html" class="pagination-nav__link"></a></p>
<p>« Redux Essentials, Part 5: Async Logic and Data Fetching</p>
<p><a href="../fundamentals/part-1-overview.html" class="pagination-nav__link"></a></p>
<p>Next</p>
<p>Redux Fundamentals, Part 1: Redux Overview »</p>
<ul>
<li><a href="#introduction" class="table-of-contents__link">Introduction</a></li>
<li><a href="#adding-user-pages" class="table-of-contents__link">Adding User Pages</a></li>
<li><a href="#adding-notifications" class="table-of-contents__link">Adding Notifications</a>
<ul>
<li><a href="#notifications-slice" class="table-of-contents__link">Notifications Slice</a></li>
<li><a href="#thunk-arguments" class="table-of-contents__link">Thunk Arguments</a></li>
<li><a href="#adding-the-notifications-list" class="table-of-contents__link">Adding the Notifications List</a></li>
<li><a href="#showing-new-notifications" class="table-of-contents__link">Showing New Notifications</a></li>
</ul></li>
<li><a href="#improving-render-performance" class="table-of-contents__link">Improving Render Performance</a>
<ul>
<li><a href="#investigating-render-behavior" class="table-of-contents__link">Investigating Render Behavior</a></li>
<li><a href="#memoizing-selector-functions" class="table-of-contents__link">Memoizing Selector Functions</a></li>
<li><a href="#investigating-the-posts-list" class="table-of-contents__link">Investigating the Posts List</a></li>
</ul></li>
<li><a href="#normalizing-data" class="table-of-contents__link">Normalizing Data</a>
<ul>
<li><a href="#normalized-state-structure" class="table-of-contents__link">Normalized State Structure</a></li>
<li><a href="#managing-normalized-state-with-createentityadapter" class="table-of-contents__link">Managing Normalized State with &lt;code class="language-js &gt;createEntityAdapter</code></a></li>
<li><a href="#updating-the-posts-slice" class="table-of-contents__link">Updating the Posts Slice</a></li>
<li><a href="#optimizing-the-posts-list" class="table-of-contents__link">Optimizing the Posts List</a></li>
</ul></li>
<li><a href="#converting-other-slices" class="table-of-contents__link">Converting Other Slices</a>
<ul>
<li><a href="#converting-the-users-slice" class="table-of-contents__link">Converting the Users Slice</a></li>
<li><a href="#converting-the-notifications-slice" class="table-of-contents__link">Converting the Notifications Slice</a></li>
</ul></li>
<li><a href="#what-youve-learned" class="table-of-contents__link">What You’ve Learned</a></li>
<li><a href="#whats-next" class="table-of-contents__link">What’s Next?</a></li>
</ul>
<h4 id="docs">Docs</h4>
<ul>
<li><a href="../official/introduction/getting-started.html" class="footer__link-item">Getting Started</a></li>
<li><a href="part-1-overview-concepts.html" class="footer__link-item">Tutorial</a></li>
<li><a href="../official/faq.html" class="footer__link-item">FAQ</a></li>
<li><a href="../official/api/api-reference.html" class="footer__link-item">API Reference</a></li>
</ul>
<h4 id="community">Community</h4>
<ul>
<li><a href="../official/../discord.com/invite/0ZcbPKXt5bZ6au5t.html" class="footer__link-item">Reactiflux Discord</a></li>
<li><a href="../official/../stackoverflow.com/questions/tagged/redux.html" class="footer__link-item">Stack Overflow</a></li>
<li><a href="../official/introduction/getting-started.html#help-and-discussion" class="footer__link-item">Feedback</a></li>
</ul>
<h4 id="more">More</h4>
<ul>
<li><a href="../official/../github.com/reduxjs/redux.html" class="footer__link-item">GitHub</a></li>
<li><a href="../../../www.netlify.com/index.html"><img src="../../../www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify" /></a></li>
</ul>
<p><a href="../official/index.html" class="footerLogoLink_MyFc"><img src="../official/../d33wubrfki0l68.cloudfront.net/0834d0215db51e91525a25acf97433051f280f2f/c30f5/img/redux.svg" alt="Redux Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo" /></p>
</body>
</html>
