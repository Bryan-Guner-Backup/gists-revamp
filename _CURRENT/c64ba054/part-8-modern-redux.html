<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>part-8-modern-redux</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<p><a href="../official/index.html" class="navbar__brand"><strong>Redux</strong></a></p>
<p><a href="../official/introduction/getting-started.html" class="navbar__item navbar__link">Getting Started</a><a href="../essentials/part-1-overview-concepts.html" class="navbar__item navbar__link">Tutorial</a><a href="../official/api/api-reference.html" class="navbar__item navbar__link">API</a><a href="../official/faq.html" class="navbar__item navbar__link">FAQ</a><a href="../official/style-guide/style-guide.html" class="navbar__item navbar__link">Best Practices</a><a href="../official/../github.com/reduxjs/redux.html" class="navbar__item navbar__link">GitHub</a><a href="../official/introduction/getting-started.html#help-and-discussion" class="navbar__item navbar__link">Need help?</a> <a href="../official/index.html" class="navbar__brand"><strong>Redux</strong></a></p>
<ul>
<li><a href="../official/introduction/getting-started.html" class="menu__link">Getting Started</a></li>
<li><a href="../essentials/part-1-overview-concepts.html" class="menu__link">Tutorial</a></li>
<li><a href="../official/api/api-reference.html" class="menu__link">API</a></li>
<li><a href="../official/faq.html" class="menu__link">FAQ</a></li>
<li><a href="../official/style-guide/style-guide.html" class="menu__link">Best Practices</a></li>
<li><a href="../official/../github.com/reduxjs/redux.html" class="menu__link">GitHub</a></li>
<li><p><a href="../official/introduction/getting-started.html#help-and-discussion" class="menu__link">Need help?</a></p></li>
<li><a href="#!" class="menu__link menu__link--sublist">Introduction</a>
<ul>
<li><a href="../official/introduction/getting-started.html" class="menu__link">Getting Started with Redux</a></li>
<li><a href="../official/introduction/installation.html" class="menu__link">Installation</a></li>
<li><a href="../official/introduction/core-concepts.html" class="menu__link">Core Concepts</a></li>
<li><a href="../official/introduction/learning-resources.html" class="menu__link">Learning Resources</a></li>
<li><a href="../official/introduction/ecosystem.html" class="menu__link">Ecosystem</a></li>
<li><a href="../official/introduction/examples.html" class="menu__link">Examples</a></li>
</ul></li>
<li><p><a href="#!" class="menu__link menu__link--sublist menu__link--active">Tutorials</a></p>
<ul>
<li><a href="../index.html" class="menu__link">Tutorials Index</a></li>
<li><a href="../quick-start.html" class="menu__link">Quick Start</a></li>
<li><a href="../typescript-quick-start.html" class="menu__link">TypeScript Quick Start</a></li>
<li><a href="#!" class="menu__link menu__link--sublist">Redux Essentials</a>
<ul>
<li><a href="../essentials/part-1-overview-concepts.html" class="menu__link">Redux Overview and Concepts</a></li>
<li><a href="../essentials/part-2-app-structure.html" class="menu__link">Redux App Structure</a></li>
<li><a href="../essentials/part-3-data-flow.html" class="menu__link">Basic Redux Data Flow</a></li>
<li><a href="../essentials/part-4-using-data.html" class="menu__link">Using Redux Data</a></li>
<li><a href="../essentials/part-5-async-logic.html" class="menu__link">Async Logic and Data Fetching</a></li>
<li><a href="../essentials/part-6-performance-normalization.html" class="menu__link">Performance and Normalizing Data</a></li>
</ul></li>
<li><p><a href="#!" class="menu__link menu__link--sublist menu__link--active">Redux Fundamentals</a></p>
<ul>
<li><a href="part-1-overview.html" class="menu__link">Redux Overview</a></li>
<li><a href="part-2-concepts-data-flow.html" class="menu__link">Redux Concepts and Data Flow</a></li>
<li><a href="part-3-state-actions-reducers.html" class="menu__link">State, Actions, and Reducers</a></li>
<li><a href="part-4-store.html" class="menu__link">Store</a></li>
<li><a href="part-5-ui-react.html" class="menu__link">UI and React</a></li>
<li><a href="part-6-async-logic.html" class="menu__link">Async Logic and Data Fetching</a></li>
<li><a href="part-7-standard-patterns.html" class="menu__link">Standard Redux Patterns</a></li>
<li><a href="part-8-modern-redux.html" class="menu__link menu__link--active active">Modern Redux with Redux Toolkit</a></li>
</ul></li>
<li><a href="../official/recipes/recipe-index.html" class="menu__link">Recipes: Index</a></li>
<li><a href="../official/recipes/configuring-your-store.html" class="menu__link">Configuring Your Store</a></li>
<li><a href="../official/recipes/usage-with-typescript.html" class="menu__link">Usage With TypeScript</a></li>
<li><a href="../official/recipes/migrating-to-redux.html" class="menu__link">Migrating to Redux</a></li>
<li><a href="../official/recipes/using-object-spread-operator.html" class="menu__link">Using Object Spread Operator</a></li>
<li><a href="../official/recipes/reducing-boilerplate.html" class="menu__link">Reducing Boilerplate</a></li>
<li><a href="../official/recipes/server-rendering.html" class="menu__link">Server Rendering</a></li>
<li><a href="../official/recipes/writing-tests.html" class="menu__link">Writing Tests</a></li>
<li><a href="../official/recipes/computing-derived-data.html" class="menu__link">Computing Derived Data</a></li>
<li><a href="../official/recipes/implementing-undo-history.html" class="menu__link">Implementing Undo History</a></li>
<li><a href="../official/recipes/isolating-redux-sub-apps.html" class="menu__link">Isolating Redux Sub-Apps</a></li>
<li><a href="../official/recipes/code-splitting.html" class="menu__link">Code Splitting</a></li>
<li><a href="../official/recipes/troubleshooting.html" class="menu__link">Troubleshooting</a></li>
<li><a href="#!" class="menu__link menu__link--sublist">Structuring Reducers</a>
<ul>
<li><a href="../official/recipes/structuring-reducers/structuring-reducers.html" class="menu__link">Structuring Reducers</a></li>
<li><a href="../official/recipes/structuring-reducers/prerequisite-concepts.html" class="menu__link">Prerequisite Concepts</a></li>
<li><a href="../official/recipes/structuring-reducers/basic-reducer-structure.html" class="menu__link">Basic Reducer Structure</a></li>
<li><a href="../official/recipes/structuring-reducers/splitting-reducer-logic.html" class="menu__link">Splitting Reducer Logic</a></li>
<li><a href="../official/recipes/structuring-reducers/refactoring-reducer-example.html" class="menu__link">Refactoring Reducers Example</a></li>
<li><a href="../official/recipes/structuring-reducers/using-combinereducers.html" class="menu__link">Using combineReducers</a></li>
<li><a href="../official/recipes/structuring-reducers/beyond-combinereducers.html" class="menu__link">Beyond combineReducers</a></li>
<li><a href="../official/recipes/structuring-reducers/normalizing-state-shape.html" class="menu__link">Normalizing State Shape</a></li>
<li><a href="../official/recipes/structuring-reducers/updating-normalized-data.html" class="menu__link">Updating Normalized Data</a></li>
<li><a href="../official/recipes/structuring-reducers/reusing-reducer-logic.html" class="menu__link">Reusing Reducer Logic</a></li>
<li><a href="../official/recipes/structuring-reducers/immutable-update-patterns.html" class="menu__link">Immutable Update Patterns</a></li>
<li><a href="../official/recipes/structuring-reducers/initializing-state.html" class="menu__link">Initializing State</a></li>
</ul></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">Understanding Redux</a>
<ul>
<li><a href="#!" class="menu__link menu__link--sublist">Thinking in Redux</a>
<ul>
<li><a href="../official/understanding/thinking-in-redux/motivation.html" class="menu__link">Motivation</a></li>
<li><a href="../official/understanding/thinking-in-redux/three-principles.html" class="menu__link">Three Principles</a></li>
<li><a href="../official/understanding/thinking-in-redux/glossary.html" class="menu__link">Glossary</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">History and Design</a>
<ul>
<li><a href="../official/understanding/history-and-design/prior-art.html" class="menu__link">Prior Art</a></li>
<li><a href="../official/understanding/history-and-design/middleware.html" class="menu__link">Middleware</a></li>
</ul></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">FAQ</a>
<ul>
<li><a href="../official/faq.html" class="menu__link">FAQ Index</a></li>
<li><a href="../official/faq/general.html" class="menu__link">General</a></li>
<li><a href="../official/faq/reducers.html" class="menu__link">Reducers</a></li>
<li><a href="../official/faq/organizing-state.html" class="menu__link">Organizing State</a></li>
<li><a href="../official/faq/store-setup.html" class="menu__link">Store Setup</a></li>
<li><a href="../official/faq/actions.html" class="menu__link">Actions</a></li>
<li><a href="../official/faq/immutable-data.html" class="menu__link">Immutable Data</a></li>
<li><a href="../official/faq/code-structure.html" class="menu__link">Code Structure</a></li>
<li><a href="../official/faq/performance.html" class="menu__link">Performance</a></li>
<li><a href="../official/faq/design-decisions.html" class="menu__link">Design Decisions</a></li>
<li><a href="../official/faq/react-redux.html" class="menu__link">React Redux</a></li>
<li><a href="../official/faq/miscellaneous.html" class="menu__link">Miscellaneous</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">Style Guide</a>
<ul>
<li><a href="../official/style-guide/style-guide.html" class="menu__link">Style Guide: Best Practices</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">API Reference</a>
<ul>
<li><a href="../official/api/api-reference.html" class="menu__link">API Reference</a></li>
<li><a href="../official/api/createstore.html" class="menu__link">createStore</a></li>
<li><a href="../official/api/store.html" class="menu__link">Store</a></li>
<li><a href="../official/api/combinereducers.html" class="menu__link">combineReducers</a></li>
<li><a href="../official/api/applymiddleware.html" class="menu__link">applyMiddleware</a></li>
<li><a href="../official/api/bindactioncreators.html" class="menu__link">bindActionCreators</a></li>
<li><a href="../official/api/compose.html" class="menu__link">compose</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">Redux Toolkit</a>
<ul>
<li><a href="../official/redux-toolkit/overview.html" class="menu__link">Redux Toolkit: Overview</a></li>
</ul></li>
</ul>
<h1 id="redux-fundamentals-part-8-modern-redux-with-redux-toolkit"><span id="redux-fundamentals-part-8-modern-redux-with-redux-toolkit" class="anchor enhancedAnchor_2LWZ"></span>Redux Fundamentals, Part 8: Modern Redux with Redux Toolkit<a href="#redux-fundamentals-part-8-modern-redux-with-redux-toolkit" class="hash-link" title="Direct link to heading">#</a></h1>
<h5 id="what-youll-learn"><span class="admonition-icon"> </span>What You’ll Learn</h5>
<ul>
<li>How to simplify your Redux logic using Redux Toolkit</li>
<li>Next steps for learning and using Redux</li>
</ul>
<p>Congratulations, you’ve made it to the last section of this tutorial! We’ve got one more topic to cover before we’re done.</p>
<p>If you’d like a reminder of what we’ve covered so far, take a look at this summary:</p>
<h5 id="info"><span class="admonition-icon"> </span>info</h5>
<h4 id="recap-what-youve-learned">Recap: What You’ve Learned</h4>
<ul>
<li><a href="part-1-overview.html">Part 1: Overview</a>:
<ul>
<li>what Redux is, when/why to use it, and the basic pieces of a Redux app</li>
</ul></li>
<li><a href="part-2-concepts-data-flow.html">Part 2: Concepts and Data Flow</a>:
<ul>
<li>How Redux uses a “one-way data flow” pattern</li>
</ul></li>
<li><a href="part-3-state-actions-reducers.html">Part 3: State, Actions, and Reducers</a>:
<ul>
<li>Redux state is made of plain JS data</li>
<li>Actions are objects that describe “what happened” events in an app</li>
<li>Reducers take current state and an action, and calculate a new state</li>
<li>Reducers must follow rules like “immutable updates” and “no side effects”</li>
</ul></li>
<li><a href="part-4-store.html">Part 4: Store</a>:
<ul>
<li>The <code>createStore</code> API creates a Redux store with a root reducer function</li>
<li>Stores can be customized using “enhancers” and “middleware”</li>
<li>The Redux DevTools extension lets you see how your state changes over time</li>
</ul></li>
<li><a href="part-5-ui-react.html">Part 5: UI and React</a>:
<ul>
<li>Redux is separate from any UI, but frequently used with React</li>
<li>React-Redux provides APIs to let React components talk to Redux stores</li>
<li><code>useSelector</code> reads values from Redux state and subscribes to updates</li>
<li><code>useDispatch</code> lets components dispatch actions</li>
<li><code>&lt;Provider&gt;</code> wraps your app and lets components access the store</li>
</ul></li>
<li><a href="part-6-async-logic.html">Part 6: Async Logic and Data Fetching</a>:
<ul>
<li>Redux middleware allow writing logic that has side effects</li>
<li>Middleware add an extra step to the Redux data flow, enabling async logic</li>
<li>Redux “thunk” functions are the standard way to write basic async logic</li>
</ul></li>
<li><a href="part-7-standard-patterns.html">Part 7: Standard Redux Patterns</a>:
<ul>
<li>Action creators encapsulate preparing action objects and thunks</li>
<li>Memoized selectors optimize calculating transformed data</li>
<li>Request status should be tracked with loading state enum values</li>
<li>Normalized state makes it easier to look up items by IDs</li>
</ul></li>
</ul>
<p>As you’ve seen, many aspects of Redux involve writing some code that can be verbose, such as immutable updates, action types and action creators, and normalizing state. There’s good reasons why these patterns exist, but writing that code “by hand” can be difficult. In addition, the process for setting up a Redux store takes several steps, and we’ve had to come up with our own logic for things like dispatching “loading” actions in thunks or processing normalized data. Finally, many times users aren’t sure what “the right way” is to write Redux logic.</p>
<p>That’s why the Redux team created <a href="../../../redux-toolkit.js.org/index.html"><strong>Redux Toolkit</strong>: our official, opinionated, “batteries included” toolset for efficient Redux development</a>.</p>
<p>Redux Toolkit contains packages and functions that we think are essential for building a Redux app. Redux Toolkit builds in our suggested best practices, simplifies most Redux tasks, prevents common mistakes, and makes it easier to write Redux applications.</p>
<p>Because of this, <strong>Redux Toolkit is the standard way to write Redux application logic</strong>. The “hand-written” Redux logic you’ve written so far in this tutorial is actual working code, but <strong>you shouldn’t write Redux logic by hand</strong> - we’ve covered those approaches in this tutorial so that you understand <em>how</em> Redux works. However, <strong>for real applications, you should use Redux Toolkit to write your Redux logic.</strong></p>
<p>When you use Redux Toolkit, all the concepts that we’ve covered so far (actions, reducers, store setup, action creators, thunks, etc) still exist, but <strong>Redux Toolkit provides easier ways to write that code</strong>.</p>
<h5 id="tip"><span class="admonition-icon"> </span>tip</h5>
<p>Redux Toolkit <em>only</em> covers the Redux logic - we still use React-Redux to let our React components talk to the Redux store, including <code>useSelector</code> and <code>useDispatch</code>.</p>
<p>So, let’s see how we can use Redux Toolkit to simplify the code we’ve already written in our example todo application. We’ll primarily be rewriting our “slice” files, but we should be able to keep all the UI code the same.</p>
<p>Before we continue, <strong>add the Redux Toolkit package to your app</strong>:</p>
<p><span class="token function" style="color: #e6d874">npm</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">install</span><span class="token plain"> <span class="citation" data-cites="reduxjs/toolkit">@reduxjs/toolkit</span></span>## <span id="store-setup" class="anchor enhancedAnchor_2LWZ"></span>Store Setup<a href="#store-setup" class="hash-link" title="Direct link to heading">#</a></p>
<p>We’ve gone through a few iterations of setup logic for our Redux store. Currently, it looks like this:</p>
<p>src/rootReducer.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> combineReducers </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>todosReducer</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./features/todos/todosSlice’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>filtersReducer</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./features/filters/filtersSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> rootReducer </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">combineReducers</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Define a top-level state field named `todos`, handled by `todosReducer`</span><span class="token plain"></span></p>
<p><span class="token plain"> todos</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> todosReducer</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> filters</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> filtersReducer</span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> rootReducer</span>src/store.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createStore</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> applyMiddleware </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>thunkMiddleware</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux-thunk’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> composeWithDevTools </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux-devtools-extension’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>rootReducer</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./reducer’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> composedEnhancer </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">composeWithDevTools</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">applyMiddleware</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">thunkMiddleware</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> store </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createStore</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">rootReducer</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> composedEnhancer</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> store</span>Notice that the setup process takes several steps. We have to:</p>
<ul>
<li>Combine the slice reducers together to form the root reducer</li>
<li>Import the root reducer into the store file</li>
<li>Import the thunk middleware, <code>applyMiddleware</code>, and <code>composeWithDevTools</code> APIs</li>
<li>Create a store enhancer with the middleware and devtools</li>
<li>Create the store with the root reducer</li>
</ul>
<p>It would be nice if we could cut down the number of steps here.</p>
<h3 id="using-configurestore"><span id="using-configurestore" class="anchor enhancedAnchor_2LWZ"></span>Using <code>configureStore</code><a href="#using-configurestore" class="hash-link" title="Direct link to heading">#</a></h3>
<p><strong>Redux Toolkit has a <code>configureStore</code> API that simplifies the store setup process</strong>. <code>configureStore</code> wraps around the Redux core <code>createStore</code> API, and handles most of the store setup for us automatically. In fact, we can cut it down to effectively one step:</p>
<p>src/store.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> configureStore </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘<span class="citation" data-cites="reduxjs/toolkit">@reduxjs/toolkit</span>’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>todosReducer</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./features/todos/todosSlice’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>filtersReducer</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./features/filters/filtersSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> store </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">configureStore</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> reducer</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Define a top-level state field named `todos`, handled by `todosReducer`</span><span class="token plain"></span></p>
<p><span class="token plain"> todos</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> todosReducer</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> filters</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> filtersReducer</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> store</span>That one call to <code>configureStore</code> did all the work for us:</p>
<ul>
<li>It combined <code>todosReducer</code> and <code>filtersReducer</code> into the root reducer function, which will handle a root state that looks like <code>{todos, filters}</code></li>
<li>It created a Redux store using that root reducer</li>
<li>It automatically added the <code>thunk</code> middleware</li>
<li>It automatically added more middleware to check for common mistakes like accidentally mutating the state</li>
<li>It automatically set up the Redux DevTools Extension connection</li>
</ul>
<p>We can confirm this works by opening up our example todo application and using it. All of our existing feature code works fine! Since we’re dispatching actions, dispatching thunks, reading state in the UI, and looking at the action history in the DevTools, all those pieces must be working correctly. All we’ve done is switched out the store setup code.</p>
<p>Let’s see what happens now if we accidentally mutate some of the state. What if we change the “todos loading” reducer so that it directly changes the state field, instead of immutably making a copy?</p>
<p>src/features/todos/todosSlice</p>
<p><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">todosReducer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color: #f8f8f2">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">switch</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">type</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit other cases</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todosLoading’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// ❌ WARNING: example only - don’t do this in a normal reducer!</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘loading’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> state</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> state</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>Uh-oh. Our whole app just crashed! What happened?</p>
<figure>
<embed src="../../../d33wubrfki0l68.cloudfront.net/195c3ba85fa715a896d6418da55f8ec369fc4770/4359b/assets/images/immutable-error-b3de8ff3ae0efb873ae791abe0d46769.23c" /><figcaption>Immutability check middleware error</figcaption>
</figure>
<p><strong>This error message is a <em>good</em> thing - we caught a bug in our app!</strong> <code>configureStore</code> specifically added an extra middleware that automatically throws an error whenever it sees an accidental mutation of our state (in development mode only). That helps catch mistakes we might make while writing our code.</p>
<h3 id="package-cleanup"><span id="package-cleanup" class="anchor enhancedAnchor_2LWZ"></span>Package Cleanup<a href="#package-cleanup" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Redux Toolkit already includes several of the packages we’re using, like <code>redux</code>, <code>redux-thunk</code>, and <code>reselect</code>, and re-exports those APIs. So, we can clean up our project a bit.</p>
<p>First, we can switch our <code>createSelector</code> import to be from <code>'@reduxjs/toolkit'</code> instead of <code>'reselect'</code>. Then, we can remove the separate packages we have listed in our <code>package.json</code>:</p>
<p><span class="token plain">npm uninstall redux redux</span><span class="token operator" style="color: #f8f8f2">-</span><span class="token plain">thunk reselect</span>To be clear, <strong>we’re still using these packages and need to have them installed</strong>. However, because Redux Toolkit depends on them, they’ll be installed automatically when we install <code>@reduxjs/toolkit</code>, so we don’t need to have the other packages specifically listed in our <code>package.json</code> file.</p>
<h2 id="writing-slices"><span id="writing-slices" class="anchor enhancedAnchor_2LWZ"></span>Writing Slices<a href="#writing-slices" class="hash-link" title="Direct link to heading">#</a></h2>
<p>As we’ve added new features to our app, the slice files have gotten bigger and more complicated. In particular, the <code>todosReducer</code> has gotten harder to read because of all the nested object spreads for immutable updates, and we’ve written multiple action creator functions.</p>
<p><strong>Redux Toolkit has a <code>createSlice</code> API that will help us simplify our Redux reducer logic and actions</strong>. <code>createSlice</code> does several important things for us:</p>
<ul>
<li>We can write the case reducers as functions inside of an object, instead of having to write a <code>switch/case</code> statement</li>
<li>The reducers will be able to write shorter immutable update logic</li>
<li>All the action creators will be generated automatically based on the reducer functions we’ve provided</li>
</ul>
<h3 id="using-createslice"><span id="using-createslice" class="anchor enhancedAnchor_2LWZ"></span>Using <code>createSlice</code><a href="#using-createslice" class="hash-link" title="Direct link to heading">#</a></h3>
<p><code>createSlice</code> takes an object with three main options fields:</p>
<ul>
<li><code>name</code>: a string that will be used as the prefix for generated action types</li>
<li><code>initialState</code>: the initial state of the reducer</li>
<li><code>reducers</code>: an object where the keys are strings, and the values are “case reducer” functions that will handle specific actions</li>
</ul>
<p>Let’s look at a small standalone example first.</p>
<p>createSlice example</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createSlice </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘<span class="citation" data-cites="reduxjs/toolkit">@reduxjs/toolkit</span>’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todosSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">todoAdded</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// ✅ This “mutating” code is okay inside of createSlice!</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">push</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">todoToggled</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">find</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">!</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">todosLoading</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘loading’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> todoAdded</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> todoToggled</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> todosLoading </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> todosSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">actions</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> todosSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reducer</span>There’s several things to see in this example:</p>
<ul>
<li>We write case reducer functions inside the <code>reducers</code> object, and give them readable names</li>
<li><strong><code>createSlice</code> will automatically generate action creators</strong> that correspond to each case reducer function we provide</li>
<li>createSlice automatically returns the existing state in the default case</li>
<li><strong><code>createSlice</code> allows us to safely “mutate” our state!</strong></li>
<li>But, we can also make immutable copies like before if we want to</li>
</ul>
<p>The generated action creators will be available as <code>slice.actions.todoAdded</code>, and we typically destructure and export those individually like we did with the action creators we wrote earlier. The complete reducer function is available as <code>slice.reducer</code>, and we typically <code>export default slice.reducer</code>, again the same as before.</p>
<p>So what do these auto-generated action objects look like? Let’s try calling one of them and logging the action to see:</p>
<p><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">todoToggled</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token number" style="color: #ae81ff">42</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// {type: ‘todos/todoToggled’, payload: 42}</span><code>createSlice</code> generated the action type string for us, by combining the slice’s <code>name</code> field with the <code>todoToggled</code> name of the reducer function we wrote. By default, the action creator accepts one argument, which it puts into the action object as <code>action.payload</code>.</p>
<p>Inside of the generated reducer function, <code>createSlice</code> will check to see if a dispatched action’s <code>action.type</code> matches one of the names it generated. If so, it will run that case reducer function. This is exactly the same pattern that we wrote ourselves using a <code>switch/case</code> statement, but <code>createSlice</code> does it for us automatically.</p>
<p>It’s also worth talking about the “mutation” aspect in more detail.</p>
<h3 id="immutable-updates-with-immer"><span id="immutable-updates-with-immer" class="anchor enhancedAnchor_2LWZ"></span>Immutable Updates with Immer<a href="#immutable-updates-with-immer" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Earlier, we talked about “mutation” (modifying existing object/array values) and “immutability” (treating values as something that cannot be changed).</p>
<h5 id="warning"><span class="admonition-icon"> </span>warning</h5>
<p>In Redux, <strong>our reducers are <em>never</em> allowed to mutate the original / current state values!</strong></p>
<p><span class="token comment" style="color: #c6cad2">// ❌ Illegal - by default, this will mutate the state!</span><span class="token plain"></span></p>
<p><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">123</span>So if we can’t change the originals, how do we return an updated state?</p>
<h5 id="tip-1"><span class="admonition-icon"> </span>tip</h5>
<p><strong>Reducers can only make <em>copies</em> of the original values, and then they can mutate the copies.</strong></p>
<p><span class="token comment" style="color: #c6cad2">// This is safe, because we made a copy</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> value</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">123</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>As you’ve seen throughout this tutorial, we can write immutable updates by hand by using JavaScript’s array / object spread operators and other functions that return copies of the original values. However, writing immutable update logic by hand <em>is</em> hard, and accidentally mutating state in reducers is the single most common mistake Redux users make.</p>
<p><strong>That’s why Redux Toolkit’s <code>createSlice</code> function lets you write immutable updates an easier way!</strong></p>
<p><code>createSlice</code> uses a library called <a href="../../../immerjs.github.io/immer/index.html">Immer</a> inside. Immer uses a special JS tool called a <code>Proxy</code> to wrap the data you provide, and lets you write code that “mutates” that wrapped data. But, <strong>Immer tracks all the changes you’ve tried to make, and then uses that list of changes to return a safely immutably updated value</strong>, as if you’d written all the immutable update logic by hand.</p>
<p>So, instead of this:</p>
<p><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">handwrittenReducer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> first</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">first</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> second</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">first</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">second</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">someId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">first</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">second</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">someId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> fourth</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">someValue</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>You can write code that looks like this:</p>
<p><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">reducerWithImmer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">first</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">second</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">someId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fourth</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">someValue</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>That’s a lot easier to read!</p>
<p>But, here’s something <em>very</em> important to remember:</p>
<h5 id="warning-1"><span class="admonition-icon"> </span>warning</h5>
<p><strong>You can <em>only</em> write “mutating” logic in Redux Toolkit’s <code>createSlice</code> and <code>createReducer</code> because they use Immer inside! If you write mutating logic in reducers without Immer, it <em>will</em> mutate the state and cause bugs!</strong></p>
<p>Immer still lets us write immutable updates by hand and return the new value ourselves if we want to. You can even mix and match. For example, removing an item from an array is often easier to do with <code>array.filter()</code>, so you could call that and then assign the result to <code>state</code> to “mutate” it:</p>
<p><span class="token comment" style="color: #c6cad2">// can mix “mutating” and “immutable” code inside of Immer:</span><span class="token plain"></span></p>
<p><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">filter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">!==</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span>### <span id="converting-the-todos-reducer" class="anchor enhancedAnchor_2LWZ"></span>Converting the Todos Reducer<a href="#converting-the-todos-reducer" class="hash-link" title="Direct link to heading">#</a></p>
<p>Let’s start converting our todos slice file to use <code>createSlice</code> instead. We’ll pick a couple specific cases from our switch statement first to show how the process works.</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createSlice </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘<span class="citation" data-cites="reduxjs/toolkit">@reduxjs/toolkit</span>’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todosSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">todoAdded</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> todo</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">todoToggled</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todoId </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">!</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> todoAdded</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> todoToggled </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> todosSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">actions</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> todosSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reducer</span>The todos reducer in our example app is still using normalized state that is nested in a parent object, so the code here is a bit different than the miniature <code>createSlice</code> example we just looked at. Remember how we had to <a href="part-7-standard-patterns.html#normalized-state">write a lot of nested spread operators to toggle that todo earlier</a>? Now that same code is a <em>lot</em> shorter and easier to read.</p>
<p>Let’s add a couple more cases to this reducer.</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todosSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">todoAdded</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> todo</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">todoToggled</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todoId </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">!</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> todoColorSelected</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">reducer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> color</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> todoId </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">color</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> color</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">prepare</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todoId</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> color</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> todoId</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> color </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">todoDeleted</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">delete</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> todoAdded</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> todoToggled</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> todoColorSelected</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> todoDeleted </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"></span></p>
<p><span class="token plain"> todosSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">actions</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> todosSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reducer</span>The action creators for <code>todoAdded</code> and <code>todoToggled</code> only need to take a single parameter, like an entire todo object or a todo ID. But, what if we need to pass in multiple parameters, or do some of that “preparation” logic we talked about like generating a unique ID?</p>
<p><code>createSlice</code> lets us handle those situations by adding a “prepare callback” to the reducer. We can pass an object that has functions named <code>reducer</code> and <code>prepare</code>. When we call the generated action creator, the <code>prepare</code> function will be called with whatever parameters were passed in. It should then create and return an object that has a <code>payload</code> field (or, optionally, <code>meta</code> and <code>error</code> fields), matching the <a href="part-7-standard-patterns.html#flux-standard-actions">Flux Standard Action convention</a>.</p>
<p>Here, we’ve used a prepare callback to let our <code>todoColorSelected</code> action creator accept separate <code>todoId</code> and <code>color</code> arguments, and put them together as an object in <code>action.payload</code>.</p>
<p>Meanwhile, in the <code>todoDeleted</code> reducer, we can use the JS <code>delete</code> operator to remove items from our normalized state.</p>
<p>We can use these same patterns to go rewrite the rest of our reducers in <code>todosSlice.js</code> and <code>filtersSlice.js</code>.</p>
<p>Here’s how our code looks with all the slices converted:</p>
<h2 id="writing-thunks"><span id="writing-thunks" class="anchor enhancedAnchor_2LWZ"></span>Writing Thunks<a href="#writing-thunks" class="hash-link" title="Direct link to heading">#</a></h2>
<p>We’ve seen how we can <a href="part-7-standard-patterns.html#loading-state-enum-values">write thunks that dispatch “loading”, “request succeeded”, and “request failed” actions</a>. We had to write action creators, action types, <em>and</em> reducers to handle those cases.</p>
<p>Because this pattern is so common, <strong>Redux Toolkit has a <code>createAsyncThunk</code> API that will generate these thunks for us</strong>. It also generates the action types and action creators for those different request status actions, and dispatches those actions automatically based on the resulting <code>Promise</code>.</p>
<h3 id="using-createasyncthunk"><span id="using-createasyncthunk" class="anchor enhancedAnchor_2LWZ"></span>Using <code>createAsyncThunk</code><a href="#using-createasyncthunk" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Let’s replace our <code>fetchTodos</code> thunk by generating a thunk with <code>createAsyncThunk</code>.</p>
<p><code>createAsyncThunk</code> accepts two arguments:</p>
<ul>
<li>A string that will be used as the prefix for the generated action types</li>
<li>A “payload creator” callback function that should return a <code>Promise</code>. This is often written using the <code>async/await</code> syntax, since <code>async</code> functions automatically return a promise.</li>
</ul>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createSlice</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> createAsyncThunk </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘<span class="citation" data-cites="reduxjs/toolkit">@reduxjs/toolkit</span>’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit imports and state</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> fetchTodos </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createAsyncThunk</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘todos/fetchTodos’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">get</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘/fakeApi/todos’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todosSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit reducer cases</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token parameter">builder</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> builder</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">addCase</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">fetchTodos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">pending</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘loading’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">addCase</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">fetchTodos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> newEntities </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">forEach</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> newEntities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> todo</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> newEntities</span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit exports</span>We pass <code>'todos/fetchTodos'</code> as the string prefix, and a “payload creator” function that calls our API and returns a promise containing the fetched data. Inside, <code>createAsyncThunk</code> will generate three action creators and action types, plus a thunk function that automatically dispatches those actions when called. In this case, the action creators and their types are:</p>
<ul>
<li><code>fetchTodos.pending</code>: <code>todos/fetchTodos/pending</code></li>
<li><code>fetchTodos.fulfilled</code>: <code>todos/fetchTodos/fulfilled</code></li>
<li><code>fetchTodos.rejected</code>: <code>todos/fetchTodos/rejected</code></li>
</ul>
<p>However, these action creators and types are being defined <em>outside</em> of the <code>createSlice</code> call. We can’t handle those inside of the <code>createSlice.reducers</code> field, because those generate new action types too. We need a way for our <code>createSlice</code> call to listen for <em>other</em> action types that were defined elsewhere.</p>
<p><strong><code>createSlice</code> also accepts an <code>extraReducers</code> option, where we can have the same slice reducer listen for other action types</strong>. This field should be a callback function with a <code>builder</code> parameter, and we can call <code>builder.addCase(actionCreator, caseReducer)</code> to listen for other actions.</p>
<p>So, here we’ve called <code>builder.addCase(fetchTodos.pending, caseReducer)</code>. When that action is dispatched, we’ll run the reducer that sets <code>state.status = 'loading'</code>, same as it did earlier when we wrote that logic in a switch statement. We can do the same thing for <code>fetchTodos.fulfilled</code>, and handle the data we received from the API.</p>
<p>As one more example, let’s convert <code>saveNewTodo</code>. This thunk takes the <code>text</code> of the new todo object as its parameter, and saves it to the server. How do we handle that?</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token comment" style="color: #c6cad2">// omit imports</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> fetchTodos </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createAsyncThunk</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘todos/fetchTodos’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">get</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘/fakeApi/todos’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> saveNewTodo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createAsyncThunk</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘todos/saveNewTodo’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token parameter">text</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialTodo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">post</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘/fakeApi/todos’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> todo</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> initialTodo </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todo</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todosSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit case reducers</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token parameter">builder</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> builder</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">addCase</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">fetchTodos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">pending</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘loading’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">addCase</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">fetchTodos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> newEntities </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">forEach</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> newEntities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> todo</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> newEntities</span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">addCase</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">saveNewTodo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> todo</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit exports and selectors</span>The process for <code>saveNewTodo</code> is the same as we saw for <code>fetchTodos</code>. We call <code>createAsyncThunk</code>, and pass in the action prefix and a payload creator. Inside the payload creator, we make an async API call, and return a result value.</p>
<p>In this case, when we call <code>dispatch(saveNewTodo(text))</code>, the <code>text</code> value will be passed in to the payload creator as its first argument.</p>
<p>While we won’t cover <code>createAsyncThunk</code> in more detail here, a few other quick notes for reference:</p>
<ul>
<li>You can only pass one argument to the thunk when you dispatch it. If you need to pass multiple values, pass them in a single object</li>
<li>The payload creator will receive an object as its second argument, which contains <code>{getState, dispatch}</code>, and some other useful values</li>
<li>The thunk dispatches the <code>pending</code> action before running your payload creator, then dispatches either <code>fulfilled</code> or <code>rejected</code> based on whether the <code>Promise</code> you return succeeds or fails</li>
</ul>
<h2 id="normalizing-state"><span id="normalizing-state" class="anchor enhancedAnchor_2LWZ"></span>Normalizing State<a href="#normalizing-state" class="hash-link" title="Direct link to heading">#</a></h2>
<p>We previously saw how to “normalize” state, by keeping items in an object keyed by item IDs. This gives us the ability to look up any item by its ID without having to loop through an entire array. However, writing the logic to update normalized state by hand was long and tedious. Writing “mutating” update code with Immer makes that simpler, but there’s still likely to be a lot of repetition - we might be loading many different types of items in our app, and we’d have to repeat the same reducer logic each time.</p>
<p><strong>Redux Toolkit includes a <code>createEntityAdapter</code> API that has prebuilt reducers for typical data update operations with normalized state</strong>. This includes adding, updating, and removing items from a slice. <strong><code>createEntityAdapter</code> also generates some memoized selectors for reading values from the store</strong>.</p>
<h3 id="using-createentityadapter"><span id="using-createentityadapter" class="anchor enhancedAnchor_2LWZ"></span>Using <code>createEntityAdapter</code><a href="#using-createentityadapter" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Let’s replace our normalized entity reducer logic with <code>createEntityAdapter</code>.</p>
<p>Calling <code>createEntityAdapter</code> gives us an “adapter” object that contains several premade reducer functions, including:</p>
<ul>
<li><code>addOne</code> / <code>addMany</code>: add new items to the state</li>
<li><code>upsertOne</code> / <code>upsertMany</code>: add new items or update existing ones</li>
<li><code>updateOne</code> / <code>updateMany</code>: update existing items by supplying partial values</li>
<li><code>removeOne</code> / <code>removeMany</code>: remove items based on IDs</li>
<li><code>setAll</code>: replace all existing items</li>
</ul>
<p>We can use these functions as case reducers, or as “mutating helpers” inside of <code>createSlice</code>.</p>
<p>The adapter also contains:</p>
<ul>
<li><code>getInitialState</code>: returns an object that looks like <code>{ ids: [], entities: {} }</code>, for storing a normalized state of items along with an array of all item IDs</li>
<li><code>getSelectors</code>: generates a standard set of selector functions</li>
</ul>
<p>Let’s see how we can use these in our todos slice:</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span></span></p>
<p><span> createSlice</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span></span></p>
<p><span> createAsyncThunk</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span></span></p>
<p><span> createEntityAdapter</span></p>
<p><span></span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘<span class="citation" data-cites="reduxjs/toolkit">@reduxjs/toolkit</span>’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit some imports</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todosAdapter </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createEntityAdapter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> todosAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getInitialState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit thunks</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todosSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit some reducers</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Use an adapter reducer function to remove a todo by ID</span><span class="token plain"></span></p>
<p><span class="token plain"> todoDeleted</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> todosAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">removeOne</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">completedTodosCleared</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> completedIds </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">values</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">filter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Use an adapter function as a “mutating” update helper</span><span class="token plain"></span></p>
<p><span class="token plain"> todosAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">removeMany</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> completedIds</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token parameter">builder</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> builder</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">addCase</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">fetchTodos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">pending</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘loading’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">addCase</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">fetchTodos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> todosAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">setAll</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Use another adapter function as a reducer to add a todo</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">addCase</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">saveNewTodo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> todosAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">addOne</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit selectors</span>The different adapter reducer functions take different values depending on the function, all in <code>action.payload</code>. The “add” and “upsert” functions take a single item or an array of items, the “remove” functions take a single ID or array of IDs, and so on.</p>
<p><code>getInitialState</code> allows us to pass in additional state fields that will be included. In this case, we’ve passed in a <code>status</code> field, giving us a final todos slice state of <code>{ids, entities, status}</code>, much like we had before.</p>
<p>We can also replace some of our todos selector functions as well. The <code>getSelectors</code> adapter function will generate selectors like <code>selectAll</code>, which returns an array of all items, and <code>selectById</code>, which returns one item. However, since <code>getSelectors</code> doesn’t know where our data is in the entire Redux state tree, we need to pass in a small selector that returns this slice out of the whole state tree. Let’s switch to using these instead. Since this is the last major change to our code, we’ll include the whole todos slice file this time to see what the final version of the code looks like using Redux Toolkit:</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span></span></p>
<p><span> createSlice</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span></span></p>
<p><span> createSelector</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span></span></p>
<p><span> createAsyncThunk</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span></span></p>
<p><span> createEntityAdapter</span></p>
<p><span></span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘<span class="citation" data-cites="reduxjs/toolkit">@reduxjs/toolkit</span>’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> client </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../../api/client’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> </span><span class="token imports maybe-class-name">StatusFilters</span><span> </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../filters/filtersSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todosAdapter </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createEntityAdapter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> todosAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getInitialState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Thunk functions</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> fetchTodos </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createAsyncThunk</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘todos/fetchTodos’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">get</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘/fakeApi/todos’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> saveNewTodo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createAsyncThunk</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘todos/saveNewTodo’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token parameter">text</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialTodo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">post</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘/fakeApi/todos’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> todo</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> initialTodo </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todo</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todosSlice </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSlice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> name</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> initialState</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> reducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">todoToggled</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todoId </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">!</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> todoColorSelected</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">reducer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> color</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> todoId </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">color</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> color</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">prepare</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todoId</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> color</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> todoId</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> color </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> todoDeleted</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> todosAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">removeOne</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">allTodosCompleted</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">values</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">forEach</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">true</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">completedTodosCleared</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> completedIds </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">values</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">filter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> todosAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">removeMany</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> completedIds</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">extraReducers</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token parameter">builder</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> builder</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">addCase</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">fetchTodos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">pending</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘loading’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">addCase</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">fetchTodos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> todosAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">setAll</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">addCase</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">saveNewTodo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">fulfilled</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> todosAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">addOne</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> allTodosCompleted</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> completedTodosCleared</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> todoAdded</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> todoColorSelected</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> todoDeleted</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> todoToggled</span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> todosSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">actions</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> todosSlice</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">reducer</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> selectAll</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> selectTodos</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> selectById</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> selectTodoById </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"></span></p>
<p><span class="token plain"> todosAdapter</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getSelectors</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> selectTodoIds </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// First, pass one or more “input selector” functions:</span><span class="token plain"></span></p>
<p><span class="token plain"> selectTodos</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Then, an “output selector” that receives all the input results as arguments</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// and returns a final result value</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token parameter">todos</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> selectFilteredTodos </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// First input selector: all todos</span><span class="token plain"></span></p>
<p><span class="token plain"> selectTodos</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Second input selector: all filter values</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">filters</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Output selector: receives both values</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todos</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> filters</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> status</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> colors </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> filters</span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> showAllCompletions </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> status </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token maybe-class-name">StatusFilters</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access maybe-class-name">All</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">showAllCompletions </span><span class="token operator" style="color: #f8f8f2">&amp;&amp;</span><span class="token plain"> colors</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> todos</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> completedStatus </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> status </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token maybe-class-name">StatusFilters</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access maybe-class-name">Completed</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Return either active or completed todos based on filter</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">filter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> statusMatches </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"></span></p>
<p><span class="token plain"> showAllCompletions </span><span class="token operator" style="color: #f8f8f2">||</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> completedStatus</span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> colorMatches </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> colors</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">||</span><span class="token plain"> colors</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">includes</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">color</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> statusMatches </span><span class="token operator" style="color: #f8f8f2">&amp;&amp;</span><span class="token plain"> colorMatches</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> selectFilteredTodoIds </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Pass our other memoized selector as an input</span><span class="token plain"></span></p>
<p><span class="token plain"> selectFilteredTodos</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// And derive data in the output selector</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token parameter">filteredTodos</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> filteredTodos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span>We call <code>todosAdapter.getSelectors</code>, and pass in a <code>state =&gt; state.todos</code> selector that returns this slice of state. From there, the adapter generates a <code>selectAll</code> selector that takes the <em>entire</em> Redux state tree, as usual, and loops over <code>state.todos.entities</code> and <code>state.todos.ids</code> to give us the complete array of todo objects. Since <code>selectAll</code> doesn’t tell us <em>what</em> we’re selecting, we can use ES6 destructuring syntax to rename the function to <code>selectTodos</code>. Similarly, we can rename <code>selectById</code> to <code>selectTodoById</code>.</p>
<p>Notice that our other selectors still use <code>selectTodos</code> as an input. That’s because it’s still returning an array of todo objects this whole time, no matter whether we were keeping the array as the entire <code>state.todos</code>, keeping it as a nested array, or storing it as a normalized object and converting to an array. Even as we’ve made all these changes to how we stored our data, the use of selectors allowed us to keep the rest of our code the same, and the use of memoized selectors has helped the UI perform better by avoiding unnecessary rerenders.</p>
<h2 id="what-youve-learned"><span id="what-youve-learned" class="anchor enhancedAnchor_2LWZ"></span>What You’ve Learned<a href="#what-youve-learned" class="hash-link" title="Direct link to heading">#</a></h2>
<p><strong>Congratulations! You’ve completed the “Redux Fundamentals” tutorial!</strong></p>
<p>You should now have a solid understanding of what Redux is, how it works, and how to use it correctly:</p>
<ul>
<li>Managing global app state</li>
<li>Keeping the state of our app as plain JS data</li>
<li>Writing action objects that describe “what happened” in the app</li>
<li>Using reducer functions that look at the current state and an action, and create a new state immutably in response</li>
<li>Reading the Redux state in our React components with <code>useSelector</code></li>
<li>Dispatching actions from React components with <code>useDispatch</code></li>
</ul>
<p>In addition, you’ve seen how <strong>Redux Toolkit simplifies writing Redux logic</strong>, and why <strong>Redux Toolkit is the standard approach for writing real Redux applications</strong>. By seeing how to write Redux code “by hand” first, it should be clear what the Redux Toolkit APIs like <code>createSlice</code> are doing for you, so that you don’t have to write that code yourself.</p>
<h5 id="info-1"><span class="admonition-icon"> </span>info</h5>
<p>For more info on Redux Toolkit, including usage guides and API references, see:</p>
<ul>
<li>The Redux Toolkit docs at <strong><a href="../../../redux-toolkit.js.org/index.html">https://redux-toolkit.js.org</a></strong></li>
</ul>
<p>Let’s take one final look at the completed todo application, including all the code that’s been converted to use Redux Toolkit:</p>
<p>And we’ll do a final recap of the key points you learned in this section:</p>
<h5 id="summary"><span class="admonition-icon"> </span>Summary</h5>
<ul>
<li><strong>Redux Toolkit (RTK) is the standard way to write Redux logic</strong>
<ul>
<li>RTK includes APIs that simplify most Redux code</li>
<li>RTK wraps around the Redux core, and includes other useful packages</li>
</ul></li>
<li><strong><code>configureStore</code> sets up a Redux store with good defaults</strong>
<ul>
<li>Automatically combines slice reducers to create the root reducer</li>
<li>Automatically sets up the Redux DevTools Extension and debugging middleware</li>
</ul></li>
<li><strong><code>createSlice</code> simplifies writing Redux actions and reducers</strong>
<ul>
<li>Automatically generates action creators based on slice/reducer names</li>
<li>Reducers can “mutate” state inside <code>createSlice</code> using Immer</li>
</ul></li>
<li><strong><code>createAsyncThunk</code> generates thunks for async calls</strong>
<ul>
<li>Automatically generates a thunk + <code>pending/fulfilled/rejected</code> action creators</li>
<li>Dispatching the thunk runs your payload creator and dispatches the actions</li>
<li>Thunk actions can be handled in <code>createSlice.extraReducers</code></li>
</ul></li>
<li><strong><code>createEntityAdapter</code> provides reducers + selectors for normalized state</strong>
<ul>
<li>Includes reducer functions for common tasks like adding/updating/removing items</li>
<li>Generates memoized selectors for <code>selectAll</code> and <code>selectById</code></li>
</ul></li>
</ul>
<h2 id="next-steps-for-learning-and-using-redux"><span id="next-steps-for-learning-and-using-redux" class="anchor enhancedAnchor_2LWZ"></span>Next Steps for Learning and Using Redux<a href="#next-steps-for-learning-and-using-redux" class="hash-link" title="Direct link to heading">#</a></h2>
<p>Now that you’ve completed this tutorial, we have several suggestions for what you should try next to learn more about Redux.</p>
<p>This “Fundamentals” tutorial focused on the low-level aspects of Redux: writing action types and immutable updates by hand, how a Redux store and middleware work, and why we use patterns like action creators and normalized state. In addition, our todo example app is fairly small, and not meant as a realistic example of building a full app.</p>
<p>However, our <a href="../essentials/part-1-overview-concepts.html"><strong>“Redux Essentials” tutorial</strong></a> specifically teaches you <strong>how to build a “real-world” type application</strong>. It focuses on “how to use Redux the right way” using Redux Toolkit, and talks about more realistic patterns that you’ll see in larger apps. It covers many of the same topics as this “Fundamentals” tutorial, such as why reducers need to use immutable updates, but with a focus on building a real working application. <strong>We strongly recommend reading through the “Redux Essentials” tutorial as your next step.</strong></p>
<p>At the same time, the concepts we’ve covered in this tutorial should be enough to get you started building your own applications using React and Redux. Now’s a great time to try working on a project yourself to solidify these concepts and see how they work in practice. If you’re not sure what kind of a project to build, see <a href="../../../github.com/florinpop17/app-ideas.html">this list of app project ideas</a> for some inspiration.</p>
<p>The <a href="../../recipes/recipe-index.html">Recipes</a> section has information on a number of important concepts, like <a href="../../recipes/structuring-reducers/structuring-reducers.html">how to structure your reducers</a>, and <a href="../../style-guide/style-guide.html"><strong>our Style Guide page</strong></a> has important information on our recommended patterns and best practices.</p>
<p>If you’d like to know more about <em>why</em> Redux exists, what problems it tries to solve, and how it’s meant to be used, see Redux maintainer Mark Erikson’s posts on <a href="../../../blog.isquaredsoftware.com/2017/05/idiomatic-redux-tao-of-redux-part-1/index.html">The Tao of Redux, Part 1: Implementation and Intent</a> and <a href="../../../blog.isquaredsoftware.com/2017/05/idiomatic-redux-tao-of-redux-part-2/index.html">The Tao of Redux, Part 2: Practice and Philosophy</a>.</p>
<p>If you’re looking for help with Redux questions, come join <a href="../../../www.reactiflux.com/index.html">the <code>#redux</code> channel in the Reactiflux server on Discord</a>.</p>
<p><strong>Thanks for reading through this tutorial, and we hope you enjoy building applications with Redux!</strong></p>
<p><a href="part-7-standard-patterns.html" class="pagination-nav__link"></a></p>
<p>« Redux Fundamentals, Part 7: Standard Redux Patterns</p>
<p><a href="../official/recipes/recipe-index.html" class="pagination-nav__link"></a></p>
<p>Next</p>
<p>Recipes: Index »</p>
<ul>
<li><a href="#store-setup" class="table-of-contents__link">Store Setup</a>
<ul>
<li><a href="#using-configurestore" class="table-of-contents__link">Using &lt;code class="language-js &gt;configureStore</code></a></li>
<li><a href="#package-cleanup" class="table-of-contents__link">Package Cleanup</a></li>
</ul></li>
<li><a href="#writing-slices" class="table-of-contents__link">Writing Slices</a>
<ul>
<li><a href="#using-createslice" class="table-of-contents__link">Using &lt;code class="language-js &gt;createSlice</code></a></li>
<li><a href="#immutable-updates-with-immer" class="table-of-contents__link">Immutable Updates with Immer</a></li>
<li><a href="#converting-the-todos-reducer" class="table-of-contents__link">Converting the Todos Reducer</a></li>
</ul></li>
<li><a href="#writing-thunks" class="table-of-contents__link">Writing Thunks</a>
<ul>
<li><a href="#using-createasyncthunk" class="table-of-contents__link">Using &lt;code class="language-js &gt;createAsyncThunk</code></a></li>
</ul></li>
<li><a href="#normalizing-state" class="table-of-contents__link">Normalizing State</a>
<ul>
<li><a href="#using-createentityadapter" class="table-of-contents__link">Using &lt;code class="language-js &gt;createEntityAdapter</code></a></li>
</ul></li>
<li><a href="#what-youve-learned" class="table-of-contents__link">What You’ve Learned</a></li>
<li><a href="#next-steps-for-learning-and-using-redux" class="table-of-contents__link">Next Steps for Learning and Using Redux</a></li>
</ul>
<h4 id="docs">Docs</h4>
<ul>
<li><a href="../official/introduction/getting-started.html" class="footer__link-item">Getting Started</a></li>
<li><a href="../essentials/part-1-overview-concepts.html" class="footer__link-item">Tutorial</a></li>
<li><a href="../official/faq.html" class="footer__link-item">FAQ</a></li>
<li><a href="../official/api/api-reference.html" class="footer__link-item">API Reference</a></li>
</ul>
<h4 id="community">Community</h4>
<ul>
<li><a href="../official/../discord.com/invite/0ZcbPKXt5bZ6au5t.html" class="footer__link-item">Reactiflux Discord</a></li>
<li><a href="../official/../stackoverflow.com/questions/tagged/redux.html" class="footer__link-item">Stack Overflow</a></li>
<li><a href="../official/introduction/getting-started.html#help-and-discussion" class="footer__link-item">Feedback</a></li>
</ul>
<h4 id="more">More</h4>
<ul>
<li><a href="../official/../github.com/reduxjs/redux.html" class="footer__link-item">GitHub</a></li>
<li><a href="../../../www.netlify.com/index.html"><img src="../../../www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify" /></a></li>
</ul>
<p><a href="../official/index.html" class="footerLogoLink_MyFc"><img src="../official/../d33wubrfki0l68.cloudfront.net/0834d0215db51e91525a25acf97433051f280f2f/c30f5/img/redux.svg" alt="Redux Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo" /></p>
</body>
</html>
