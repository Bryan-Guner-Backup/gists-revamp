<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>part-7-standard-patterns</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<p><a href="../official/index.html" class="navbar__brand"><strong>Redux</strong></a></p>
<p><a href="../official/introduction/getting-started.html" class="navbar__item navbar__link">Getting Started</a><a href="../essentials/part-1-overview-concepts.html" class="navbar__item navbar__link">Tutorial</a><a href="../official/api/api-reference.html" class="navbar__item navbar__link">API</a><a href="../official/faq.html" class="navbar__item navbar__link">FAQ</a><a href="../official/style-guide/style-guide.html" class="navbar__item navbar__link">Best Practices</a><a href="../official/../github.com/reduxjs/redux.html" class="navbar__item navbar__link">GitHub</a><a href="../official/introduction/getting-started.html#help-and-discussion" class="navbar__item navbar__link">Need help?</a> <a href="../official/index.html" class="navbar__brand"><strong>Redux</strong></a></p>
<ul>
<li><a href="../official/introduction/getting-started.html" class="menu__link">Getting Started</a></li>
<li><a href="../essentials/part-1-overview-concepts.html" class="menu__link">Tutorial</a></li>
<li><a href="../official/api/api-reference.html" class="menu__link">API</a></li>
<li><a href="../official/faq.html" class="menu__link">FAQ</a></li>
<li><a href="../official/style-guide/style-guide.html" class="menu__link">Best Practices</a></li>
<li><a href="../official/../github.com/reduxjs/redux.html" class="menu__link">GitHub</a></li>
<li><p><a href="../official/introduction/getting-started.html#help-and-discussion" class="menu__link">Need help?</a></p></li>
<li><a href="#!" class="menu__link menu__link--sublist">Introduction</a>
<ul>
<li><a href="../official/introduction/getting-started.html" class="menu__link">Getting Started with Redux</a></li>
<li><a href="../official/introduction/installation.html" class="menu__link">Installation</a></li>
<li><a href="../official/introduction/core-concepts.html" class="menu__link">Core Concepts</a></li>
<li><a href="../official/introduction/learning-resources.html" class="menu__link">Learning Resources</a></li>
<li><a href="../official/introduction/ecosystem.html" class="menu__link">Ecosystem</a></li>
<li><a href="../official/introduction/examples.html" class="menu__link">Examples</a></li>
</ul></li>
<li><p><a href="#!" class="menu__link menu__link--sublist menu__link--active">Tutorials</a></p>
<ul>
<li><a href="../index.html" class="menu__link">Tutorials Index</a></li>
<li><a href="../quick-start.html" class="menu__link">Quick Start</a></li>
<li><a href="../typescript-quick-start.html" class="menu__link">TypeScript Quick Start</a></li>
<li><a href="#!" class="menu__link menu__link--sublist">Redux Essentials</a>
<ul>
<li><a href="../essentials/part-1-overview-concepts.html" class="menu__link">Redux Overview and Concepts</a></li>
<li><a href="../essentials/part-2-app-structure.html" class="menu__link">Redux App Structure</a></li>
<li><a href="../essentials/part-3-data-flow.html" class="menu__link">Basic Redux Data Flow</a></li>
<li><a href="../essentials/part-4-using-data.html" class="menu__link">Using Redux Data</a></li>
<li><a href="../essentials/part-5-async-logic.html" class="menu__link">Async Logic and Data Fetching</a></li>
<li><a href="../essentials/part-6-performance-normalization.html" class="menu__link">Performance and Normalizing Data</a></li>
</ul></li>
<li><p><a href="#!" class="menu__link menu__link--sublist menu__link--active">Redux Fundamentals</a></p>
<ul>
<li><a href="part-1-overview.html" class="menu__link">Redux Overview</a></li>
<li><a href="part-2-concepts-data-flow.html" class="menu__link">Redux Concepts and Data Flow</a></li>
<li><a href="part-3-state-actions-reducers.html" class="menu__link">State, Actions, and Reducers</a></li>
<li><a href="part-4-store.html" class="menu__link">Store</a></li>
<li><a href="part-5-ui-react.html" class="menu__link">UI and React</a></li>
<li><a href="part-6-async-logic.html" class="menu__link">Async Logic and Data Fetching</a></li>
<li><a href="part-7-standard-patterns.html" class="menu__link menu__link--active active">Standard Redux Patterns</a></li>
<li><a href="part-8-modern-redux.html" class="menu__link">Modern Redux with Redux Toolkit</a></li>
</ul></li>
<li><a href="../official/recipes/recipe-index.html" class="menu__link">Recipes: Index</a></li>
<li><a href="../official/recipes/configuring-your-store.html" class="menu__link">Configuring Your Store</a></li>
<li><a href="../official/recipes/usage-with-typescript.html" class="menu__link">Usage With TypeScript</a></li>
<li><a href="../official/recipes/migrating-to-redux.html" class="menu__link">Migrating to Redux</a></li>
<li><a href="../official/recipes/using-object-spread-operator.html" class="menu__link">Using Object Spread Operator</a></li>
<li><a href="../official/recipes/reducing-boilerplate.html" class="menu__link">Reducing Boilerplate</a></li>
<li><a href="../official/recipes/server-rendering.html" class="menu__link">Server Rendering</a></li>
<li><a href="../official/recipes/writing-tests.html" class="menu__link">Writing Tests</a></li>
<li><a href="../official/recipes/computing-derived-data.html" class="menu__link">Computing Derived Data</a></li>
<li><a href="../official/recipes/implementing-undo-history.html" class="menu__link">Implementing Undo History</a></li>
<li><a href="../official/recipes/isolating-redux-sub-apps.html" class="menu__link">Isolating Redux Sub-Apps</a></li>
<li><a href="../official/recipes/code-splitting.html" class="menu__link">Code Splitting</a></li>
<li><a href="../official/recipes/troubleshooting.html" class="menu__link">Troubleshooting</a></li>
<li><a href="#!" class="menu__link menu__link--sublist">Structuring Reducers</a>
<ul>
<li><a href="../official/recipes/structuring-reducers/structuring-reducers.html" class="menu__link">Structuring Reducers</a></li>
<li><a href="../official/recipes/structuring-reducers/prerequisite-concepts.html" class="menu__link">Prerequisite Concepts</a></li>
<li><a href="../official/recipes/structuring-reducers/basic-reducer-structure.html" class="menu__link">Basic Reducer Structure</a></li>
<li><a href="../official/recipes/structuring-reducers/splitting-reducer-logic.html" class="menu__link">Splitting Reducer Logic</a></li>
<li><a href="../official/recipes/structuring-reducers/refactoring-reducer-example.html" class="menu__link">Refactoring Reducers Example</a></li>
<li><a href="../official/recipes/structuring-reducers/using-combinereducers.html" class="menu__link">Using combineReducers</a></li>
<li><a href="../official/recipes/structuring-reducers/beyond-combinereducers.html" class="menu__link">Beyond combineReducers</a></li>
<li><a href="../official/recipes/structuring-reducers/normalizing-state-shape.html" class="menu__link">Normalizing State Shape</a></li>
<li><a href="../official/recipes/structuring-reducers/updating-normalized-data.html" class="menu__link">Updating Normalized Data</a></li>
<li><a href="../official/recipes/structuring-reducers/reusing-reducer-logic.html" class="menu__link">Reusing Reducer Logic</a></li>
<li><a href="../official/recipes/structuring-reducers/immutable-update-patterns.html" class="menu__link">Immutable Update Patterns</a></li>
<li><a href="../official/recipes/structuring-reducers/initializing-state.html" class="menu__link">Initializing State</a></li>
</ul></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">Understanding Redux</a>
<ul>
<li><a href="#!" class="menu__link menu__link--sublist">Thinking in Redux</a>
<ul>
<li><a href="../official/understanding/thinking-in-redux/motivation.html" class="menu__link">Motivation</a></li>
<li><a href="../official/understanding/thinking-in-redux/three-principles.html" class="menu__link">Three Principles</a></li>
<li><a href="../official/understanding/thinking-in-redux/glossary.html" class="menu__link">Glossary</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">History and Design</a>
<ul>
<li><a href="../official/understanding/history-and-design/prior-art.html" class="menu__link">Prior Art</a></li>
<li><a href="../official/understanding/history-and-design/middleware.html" class="menu__link">Middleware</a></li>
</ul></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">FAQ</a>
<ul>
<li><a href="../official/faq.html" class="menu__link">FAQ Index</a></li>
<li><a href="../official/faq/general.html" class="menu__link">General</a></li>
<li><a href="../official/faq/reducers.html" class="menu__link">Reducers</a></li>
<li><a href="../official/faq/organizing-state.html" class="menu__link">Organizing State</a></li>
<li><a href="../official/faq/store-setup.html" class="menu__link">Store Setup</a></li>
<li><a href="../official/faq/actions.html" class="menu__link">Actions</a></li>
<li><a href="../official/faq/immutable-data.html" class="menu__link">Immutable Data</a></li>
<li><a href="../official/faq/code-structure.html" class="menu__link">Code Structure</a></li>
<li><a href="../official/faq/performance.html" class="menu__link">Performance</a></li>
<li><a href="../official/faq/design-decisions.html" class="menu__link">Design Decisions</a></li>
<li><a href="../official/faq/react-redux.html" class="menu__link">React Redux</a></li>
<li><a href="../official/faq/miscellaneous.html" class="menu__link">Miscellaneous</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">Style Guide</a>
<ul>
<li><a href="../official/style-guide/style-guide.html" class="menu__link">Style Guide: Best Practices</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">API Reference</a>
<ul>
<li><a href="../official/api/api-reference.html" class="menu__link">API Reference</a></li>
<li><a href="../official/api/createstore.html" class="menu__link">createStore</a></li>
<li><a href="../official/api/store.html" class="menu__link">Store</a></li>
<li><a href="../official/api/combinereducers.html" class="menu__link">combineReducers</a></li>
<li><a href="../official/api/applymiddleware.html" class="menu__link">applyMiddleware</a></li>
<li><a href="../official/api/bindactioncreators.html" class="menu__link">bindActionCreators</a></li>
<li><a href="../official/api/compose.html" class="menu__link">compose</a></li>
</ul></li>
<li><a href="#!" class="menu__link menu__link--sublist">Redux Toolkit</a>
<ul>
<li><a href="../official/redux-toolkit/overview.html" class="menu__link">Redux Toolkit: Overview</a></li>
</ul></li>
</ul>
<h1 id="redux-fundamentals-part-7-standard-redux-patterns"><span id="redux-fundamentals-part-7-standard-redux-patterns" class="anchor enhancedAnchor_2LWZ"></span>Redux Fundamentals, Part 7: Standard Redux Patterns<a href="#redux-fundamentals-part-7-standard-redux-patterns" class="hash-link" title="Direct link to heading">#</a></h1>
<h5 id="what-youll-learn"><span class="admonition-icon"> </span>What You’ll Learn</h5>
<ul>
<li>Standard patterns used in real-world Redux apps, and why those patterns exist:
<ul>
<li>Action creators for encapsulating action objects</li>
<li>Memoized selectors for improving performance</li>
<li>Tracking request status via loading enums</li>
<li>Normalizing state for managing collections of items</li>
<li>Working with promises and thunks</li>
</ul></li>
</ul>
<h5 id="prerequisites"><span class="admonition-icon"> </span>Prerequisites</h5>
<ul>
<li>Understanding the topics in all previous sections</li>
</ul>
<p>In <a href="part-6-async-logic.html">Part 6: Async Logic and Data Fetching</a>, we saw how to use Redux middleware to write async logic that can talk to the store. In particular, we used the Redux “thunk” middleware to write functions that can contain reusable async logic, without knowing what Redux store they’ll be talking to ahead of time.</p>
<p>So far, we’ve covered the basics of how Redux actually works. However, real world Redux applications use some additional patterns on top of those basics.</p>
<p>It’s important to note that <strong>none of these patterns are <em>required</em> to use Redux!</strong> But, there are very good reasons why each of these patterns exists, and you’ll see some or all of them in almost every Redux codebase.</p>
<p>In this section, we’ll rework our existing todo app code to use some of these patterns, and talk about why they’re commonly used in Redux apps. Then, in <a href="part-8-modern-redux.html"><strong>Part 8</strong></a>, we’ll talk about “modern Redux”, including <strong>how to use our official <a href="../../../redux-toolkit.js.org/index.html">Redux Toolkit</a> package to simplify all the Redux logic we’ve written “by hand”</strong> in our app, and why <strong>we recommend using Redux Toolkit as the standard approach for writing Redux apps</strong>.</p>
<h2 id="action-creators"><span id="action-creators" class="anchor enhancedAnchor_2LWZ"></span>Action Creators<a href="#action-creators" class="hash-link" title="Direct link to heading">#</a></h2>
<p>In our app, we’ve been writing action objects directly in the code, where they’re being dispatched:</p>
<p><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> trimmedText </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span>However, in practice, well-written Redux apps don’t actually write those action objects inline when we dispatch them. Instead, we use “action creator” functions.</p>
<p>An <strong>action creator</strong> is a function that creates and returns an action object. We typically use these so we don’t have to write the action object by hand every time:</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">todoAdded</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">text</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> text</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>We then use them by <strong>calling the action creator</strong>, and then <strong>passing the resulting action object directly to <code>dispatch</code></strong>:</p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">todoAdded</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘Buy milk’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">log</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">getState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// [ {id: 0, text: ‘Buy milk’, completed: false}]</span>#### Detailed Explanation: Why use Action Creators?</p>
<p>In our small example todo app, writing action objects by hand every time isn’t too difficult. In fact, by switching to using action creators, we’ve added <em>more</em> work - now we have to write a function <em>and</em> the action object.</p>
<p>But, what if we needed to dispatch the same action from many parts of the application? Or what if there’s some additional logic that we have to do every time we dispatch an action, like creating a unique ID? We’d end up having to copy-paste the additional setup logic every time we need to dispatch that action.</p>
<p>Action creators have two primary purposes:</p>
<ul>
<li>They prepare and format the contents of action objects</li>
<li>They encapsulate any additional work needed whenever we create those actions</li>
</ul>
<p>That way, we have a consistent approach for creating actions, whether or not there’s any extra work that needs to be done. The same goes for thunks as well.</p>
<h3 id="using-action-creators"><span id="using-action-creators" class="anchor enhancedAnchor_2LWZ"></span>Using Action Creators<a href="#using-action-creators" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Let’s update our todos slice file to use action creators for a couple of our action types.</p>
<p>We’ll start with the two main actions we’ve been using so far: loading the list of todos from the server, and adding a new todo after saving it to the server.</p>
<p>Right now, <code>todosSlice.js</code> is dispatching an action object directly, like this:</p>
<p><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todosLoaded’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span>We’ll create a function that creates and returns that same kind of action object, but accepts the array of todos as its argument and puts it into the action as <code>action.payload</code>. Then, we can dispatch the action using that new action creator inside of our <code>fetchTodos</code> thunk:</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">todosLoaded</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">todos</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todosLoaded’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> todos</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">fetchTodos</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">get</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘/fakeApi/todos’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">todosLoaded</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>We can also do the same thing for the “todo added” action:</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">todoAdded</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> todo</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">saveNewTodo</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">text</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">saveNewTodoThunk</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialTodo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">post</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘/fakeApi/todos’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> todo</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> initialTodo </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">todoAdded</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todo</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>While we’re at it, let’s do the same thing for the “color filter changed” action:</p>
<p>src/features/filters/filtersSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">colorFilterChanged</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">color</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> changeType</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘filters/colorFilterChanged’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> color</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> changeType </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>And since this action was being dispatched from the <code>&lt;Footer&gt;</code> component, we’ll need to import the <code>colorFilterChanged</code> action creator over there and use it:</p>
<p>src/features/footer/Footer.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> useSelector</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> useDispatch </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react-redux’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> availableColors</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> capitalize </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../filters/colors’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> </span><span class="token imports maybe-class-name">StatusFilters</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> colorFilterChanged </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../filters/filtersSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit child components</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">Footer</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useDispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todosRemaining </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> uncompletedTodos </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">filter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">!</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> uncompletedTodos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">length</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> status</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> colors </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">filters</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">onMarkCompletedClicked</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/allCompleted’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">onClearCompletedClicked</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/completedCleared’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">onColorChange</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">color</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> changeType</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">colorFilterChanged</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">color</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> changeType</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">onStatusChange</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">status</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘filters/statusFilterChanged’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> status </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit rendering output</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> </span><span class="token maybe-class-name">Footer</span>Notice that the <code>colorFilterChanged</code> action creator actually accepts two different arguments, and then combines them together to form the right <code>action.payload</code> field.</p>
<p>This doesn’t change anything about how the application works, or how the Redux data flow behaves - we’re still creating action objects, and dispatching them. But, instead of writing action objects directly in our code all the time, we’re now using action creators to prepare those action objects before they’re dispatched.</p>
<p>We can also use action creators with thunk functions, and in fact <a href="part-6-async-logic.html#saving-todo-items">we wrapped a thunk in an action creator in the previous section</a> . We specifically wrapped <code>saveNewTodo</code> in a “thunk action creator” function so that we could pass in a <code>text</code> parameter. While <code>fetchTodos</code> doesn’t take any parameters, we could still wrap it in an action creator as well:</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">fetchTodos</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">fetchTodosThunk</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">get</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘/fakeApi/todos’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">todosLoaded</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>And that means we have to change the place it’s dispatched in <code>index.js</code> to call the outer thunk action creator function, and pass the returned inner thunk function to <code>dispatch</code>:</p>
<p>src/index.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span>store</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./store’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> fetchTodos </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./features/todos/todosSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">fetchTodos</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span>We’ve written thunks using the <code>function</code> keyword so far to make it clear what they’re doing. However, we can also write them using arrow function syntax instead. Using implicit returns can shorten the code, although it may make it a bit harder to read as well if you’re not familiar with arrow functions:</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token comment" style="color: #c6cad2">// Same thing as the above example!</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">fetchTodos</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token parameter">dispatch</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">get</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘/fakeApi/todos’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">todosLoaded</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>Similarly, we <em>could</em> shorten the plain action creators if we wanted to:</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">todoAdded</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> payload</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> todo </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span>It’s up to you to decide whether using arrow functions this way is better or not.</p>
<h5 id="info"><span class="admonition-icon"> </span>info</h5>
<p>For more details on why action creators are useful, see:</p>
<ul>
<li><a href="../../../blog.isquaredsoftware.com/2016/10/idiomatic-redux-why-use-action-creators/index.html">Idiomatic Redux: Why Use Action Creators?</a></li>
</ul>
<h2 id="memoized-selectors"><span id="memoized-selectors" class="anchor enhancedAnchor_2LWZ"></span>Memoized Selectors<a href="#memoized-selectors" class="hash-link" title="Direct link to heading">#</a></h2>
<p>We’ve already seen that we can write “selector” functions, which accept the Redux <code>state</code> object as an argument, and return a value:</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectTodos</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span>What if we need to <em>derive</em> some data? For example, maybe we want to have an array of only the todo IDs:</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectTodoIds</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">)</span>However, <code>array.map()</code> always returns a new array reference. We know that the React-Redux <code>useSelector</code> hook will re-run its selector function after <em>every</em> dispatched action, and if the selector result changes, it will force the component to re-render.</p>
<p>In this example, <strong>calling <code>useSelector(selectTodoIds)</code> will <em>always</em> cause the component to re-render after <em>every</em> action, because it’s returning a new array reference!</strong></p>
<p>In Part 5, we saw that <a href="part-5-ui-react.html#selecting-data-in-list-items-by-id">we can pass <code>shallowEqual</code> as an argument to <code>useSelector</code></a>. There’s another option here, though: we could use “memoized” selectors.</p>
<p><strong>Memoization</strong> is a kind of caching - specifically, saving the results of an expensive calculation, and reusing those results if we see the same inputs later.</p>
<p><strong>Memoized selector functions</strong> are selectors that save the most recent result value, and if you call them multiple times with the same inputs, will return the same result value. If you call them with <em>different</em> inputs than last time, they will recalculate a new result value, cache it, and return the new result.</p>
<h3 id="memoizing-selectors-with-createselector"><span id="memoizing-selectors-with-createselector" class="anchor enhancedAnchor_2LWZ"></span>Memoizing Selectors with <code>createSelector</code><a href="#memoizing-selectors-with-createselector" class="hash-link" title="Direct link to heading">#</a></h3>
<p>The <strong><a href="../../../github.com/reduxjs/reselect.html">Reselect library</a> provides a <code>createSelector</code> API that will generate memoized selector functions</strong>. <code>createSelector</code> accepts one or more “input selector” functions as arguments, plus an “output selector”, and returns the new selector function. Every time you call the selector:</p>
<ul>
<li>All “input selectors” are called with all of the arguments</li>
<li>If any of the input selector return values have changed, the “output selector” will re-run</li>
<li>All of the input selector results become arguments to the output selector</li>
<li>The final result of the output selector is cached for next time</li>
</ul>
<p>Let’s create a memoized version of <code>selectTodoIds</code> and use that with our <code>&lt;TodoList&gt;</code>.</p>
<p>First, we need to install Reselect:</p>
<p><span class="token function" style="color: #e6d874">npm</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">install</span><span class="token plain"> reselect</span>Then, we can import and call <code>createSelector</code>. Our original <code>selectTodoIds</code> function was defined over in <code>TodoList.js</code>, but it’s more common for selector functions to be written in the relevant slice file. So, let’s add this to the todos slice:</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createSelector </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘reselect’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit reducer</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit action creators</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> selectTodoIds </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// First, pass one or more “input selector” functions:</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Then, an “output selector” that receives all the input results as arguments</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// and returns a final result value</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token parameter">todos</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span>Then, let’s use it in <code>&lt;TodoList&gt;</code>:</p>
<p>src/features/todos/TodoList.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> useSelector</span><span class="token imports punctuation" style="color: #f8f8f2">,</span><span> shallowEqual </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react-redux’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> selectTodoIds </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./todosSlice’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">TodoListItem</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./TodoListItem’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">TodoList</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todoIds </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">selectTodoIds</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> renderedListItems </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> todoIds</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todoId</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">TodoListItem</span><span class="token plain"> key</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> id</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">ul className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“todo-list”</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">renderedListItems</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">ul</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>This actually behaves a bit differently than the <code>shallowEqual</code> comparison function does. Any time the <code>state.todos</code> array changes, we’re going to create a new todo IDs array as a result. That includes any immutable updates to todo items like toggling their <code>completed</code> field, since we have to create a new array for the immutable update.</p>
<h5 id="tip"><span class="admonition-icon"> </span>tip</h5>
<p>Memoized selectors are only helpful when you actually derive additional values from the original data. If you are only looking up and returning an existing value, you can keep the selector as a plain function.</p>
<h3 id="selectors-with-multiple-arguments"><span id="selectors-with-multiple-arguments" class="anchor enhancedAnchor_2LWZ"></span>Selectors with Multiple Arguments<a href="#selectors-with-multiple-arguments" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Our todo app is supposed to have the ability to filter the visible todos based on their completed status. Let’s write a memoized selector that returns that filtered list of todos.</p>
<p>We know we need the entire <code>todos</code> array as one argument to our output selector. We also need to pass in the current completion status filter value as well. We’ll add a separate “input selector” to extract each value, and pass the results to the “output selector”.</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> createSelector </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘reselect’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span> </span><span class="token imports maybe-class-name">StatusFilters</span><span> </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../filters/filtersSlice’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit other code</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> selectFilteredTodos </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// First input selector: all todos</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Second input selector: current status filter</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">filters</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Output selector: receives both values</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todos</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> status</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">status </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token maybe-class-name">StatusFilters</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access maybe-class-name">All</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> todos</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> completedStatus </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> status </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token maybe-class-name">StatusFilters</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access maybe-class-name">Completed</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Return either active or completed todos based on filter</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">filter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> completedStatus</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span>##### <span class="admonition-icon"> </span>caution</p>
<p>Note that we’ve now added an import dependency between two slices - the <code>todosSlice</code> is importing a value from the <code>filtersSlice</code>. This is legal, but be careful. <strong>If two slices <em>both</em> try to import something from each other, you can end up with a “cyclic import dependency” problem that can cause your code to crash</strong>. If that happens, try moving some common code to its own file and import from that file instead.</p>
<p>Now we can use this new “filtered todos” selector as an input to another selector that returns the IDs of those todos:</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> selectFilteredTodoIds </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Pass our other memoized selector as an input</span><span class="token plain"></span></p>
<p><span class="token plain"> selectFilteredTodos</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// And derive data in the output selector</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token parameter">filteredTodos</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> filteredTodos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span>If we switch <code>&lt;TodoList&gt;</code> to use <code>selectFilteredTodoIds</code>, we should then be able to mark a couple todo items as completed:</p>
<figure>
<img src="../../../d33wubrfki0l68.cloudfront.net/b6b70a0a0446ad205a9bbda9a54db0c6e48fa5c5/68bf1/assets/images/todos-app-markedcompleted-fe1ddaba1c85e3f9841728d3945" alt="Todo app - todos marked completed" /><figcaption>Todo app - todos marked completed</figcaption>
</figure>
<p>and then filter the list to <em>only</em> show completed todos:</p>
<figure>
<img src="../../../d33wubrfki0l68.cloudfront.net/4216f70d03b91fe46af6ad3721d06629448746cd/0d52e/assets/images/todos-app-showcompleted-6eeff512e106457fd4fb469d2f663" alt="Todo app - todos marked completed" /><figcaption>Todo app - todos marked completed</figcaption>
</figure>
<p>We can then expand our <code>selectFilteredTodos</code> to also include color filtering in the selection as well:</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> selectFilteredTodos </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// First input selector: all todos</span><span class="token plain"></span></p>
<p><span class="token plain"> selectTodos</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Second input selector: all filter values</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">filters</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Output selector: receives both values</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todos</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> filters</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> status</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> colors </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> filters</span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> showAllCompletions </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> status </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token maybe-class-name">StatusFilters</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access maybe-class-name">All</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">showAllCompletions </span><span class="token operator" style="color: #f8f8f2">&amp;&amp;</span><span class="token plain"> colors</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> todos</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> completedStatus </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> status </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token maybe-class-name">StatusFilters</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access maybe-class-name">Completed</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Return either active or completed todos based on filter</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">filter</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> statusMatches </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"></span></p>
<p><span class="token plain"> showAllCompletions </span><span class="token operator" style="color: #f8f8f2">||</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> completedStatus</span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> colorMatches </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> colors</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">||</span><span class="token plain"> colors</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">includes</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">color</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> statusMatches </span><span class="token operator" style="color: #f8f8f2">&amp;&amp;</span><span class="token plain"> colorMatches</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span>Notice that by encapsulating the logic in this selector, our component never needed to change, even as we changed the filtering behavior. Now we can filter by both status and color at once:</p>
<figure>
<img src="../../../d33wubrfki0l68.cloudfront.net/7b590e843bf533d3b0919fc0997985057b38f7bd/8d501/assets/images/todos-app-selectorfilters-9ebfc37b389c997e011aff74d52" alt="Todo app - status and color filters" /><figcaption>Todo app - status and color filters</figcaption>
</figure>
<p>Finally, we’ve got several places where our code is looking up <code>state.todos</code>. We’re going to be making some changes to how that state is designed as we go through the rest of this section, so we’ll extract a single <code>selectTodos</code> selector and use that everywhere. We can also move <code>selectTodoById</code> over into the <code>todosSlice</code>:</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectTodos</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectTodoById</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> todoId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">selectTodos</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">find</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> todoId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>##### <span class="admonition-icon"> </span>info</p>
<p>To learn more about how to use Reselect and memoized selectors, see:</p>
<ul>
<li>The <a href="../../../github.com/reduxjs/reselect.html">Reselect docs</a></li>
<li><a href="../../../blog.isquaredsoftware.com/2017/12/idiomatic-redux-using-reselect-selectors/index.html">Idiomatic Redux: Using Reselect Selectors for Encapsulation and Performance</a></li>
</ul>
<h2 id="async-request-status"><span id="async-request-status" class="anchor enhancedAnchor_2LWZ"></span>Async Request Status<a href="#async-request-status" class="hash-link" title="Direct link to heading">#</a></h2>
<p>We’re using an async thunk to fetch the initial list of todos from the server. Since we’re using a fake server API, that response comes back immediately. In a real app, the API call might take a while to resolve. In that case, it’s common to show some kind of a loading spinner while we wait for the response to complete.</p>
<p>This is usually handled in Redux apps by:</p>
<ul>
<li>Having some kind of “loading state” value to indicate the current status of a request</li>
<li>Dispatching a “request started” action <em>before</em> making the API call, which is handled by changing the loading state value</li>
<li>Updating the loading state value again when the request completes to indicate that the call is done</li>
</ul>
<p>The UI layer then shows a loading spinner while the request is in progress, and switches to showing the actual data when the request is complete.</p>
<p>We’re going to update our todos slice to track a loading state value, and dispatch an additional <code>'todos/todosLoading'</code> action as part of the <code>fetchTodos</code> thunk.</p>
<p>Right now, the <code>state</code> of our todos reducer is only the array of todos itself. If we want to track the loading state inside the todos slice, we’ll need to reorganize the todos state to be an object that has the todos array <em>and</em> the loading state value. That also means rewriting the reducer logic to handle the additional nesting:</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">todosReducer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color: #f8f8f2">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">switch</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">type</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoToggled’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">!==</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> todo</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> completed</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">!</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit other cases</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> state</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit action creators</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectTodos</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span>There’s a few important things to note here:</p>
<ul>
<li>The todos array is now nested as <code>state.entities</code> in the <code>todosReducer</code> state object. The word “entities” is a term that means “unique items with an ID”, which does describe our todo objects.</li>
<li>That also means the array is nested in the <em>entire</em> Redux state object as <code>state.todos.entities</code></li>
<li>We now have to do extra steps in the reducer to copy the additional level of nesting for correct immutable updates, such as <code>state</code> object -&gt; <code>entities</code> array -&gt; <code>todo</code> object</li>
<li>Because the rest of our code is <em>only</em> accessing the todos state via selectors, <strong>we only need to update the <code>selectTodos</code> selector</strong> - the rest of the UI will continue to work as expected even though we reshaped our state considerably.</li>
</ul>
<h3 id="loading-state-enum-values"><span id="loading-state-enum-values" class="anchor enhancedAnchor_2LWZ"></span>Loading State Enum Values<a href="#loading-state-enum-values" class="hash-link" title="Direct link to heading">#</a></h3>
<p>You’ll also notice that we’ve defined the loading state field as a string enum:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// or: ‘loading’, ‘succeeded’, ‘failed’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>instead of an <code>isLoading</code> boolean.</p>
<p>A boolean limits us to two possibilities: “loading” or “not loading”. In reality, <strong>it’s possible for a request to actually be in <em>many</em> different states</strong>, such as:</p>
<ul>
<li>Hasn’t started at all</li>
<li>In progress</li>
<li>Succeeded</li>
<li>Failed</li>
<li>Succeeded, but now back in a situation where we might want to refetch</li>
</ul>
<p>It’s also possible that the app logic should only transition between specific states based on certain actions, and this is harder to implement using booleans.</p>
<p>Because of this, we recommend <strong>storing loading state as a string enum value instead of boolean flags</strong>.</p>
<h5 id="info-1"><span class="admonition-icon"> </span>info</h5>
<p>For a detailed explanation of why loading states should be enums, see:</p>
<ul>
<li><a href="../../style-guide/style-guide.html#treat-reducers-as-state-machines">Redux Style Guide: treat reducers as state machines</a></li>
</ul>
<p>Based on that, we’ll add a new “loading” action that will set our status to <code>'loading'</code>, and update the “loaded” action to reset the state flag to <code>'idle'</code>:</p>
<p>src/features/todos/todosSlice.js</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">todosReducer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color: #f8f8f2">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">switch</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">type</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit other cases</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todosLoading’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘loading’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todosLoaded’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> state</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit action creators</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// Thunk function</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">fetchTodos</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token parameter">dispatch</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">todosLoading</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> response </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">get</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘/fakeApi/todos’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">todosLoaded</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">response</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>However, before we try to show this in the UI, we need to modify the fake server API to add an artificial delay to our API calls. Open up <code>src/api/server.js</code>, and look for this commented-out line around line 63:</p>
<p>src/api/server.js</p>
<p><span class="token keyword" style="color: #f92672">new</span><span class="token plain"> </span><span class="token class-name">Server</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">routes</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">this</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">namespace</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘fakeApi’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// this.timing = 2000</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// omit other code</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span>If you uncomment that line, the fake server will add a 2-second delay to every API call our app makes, which gives us enough time to actually see a loading spinner being displayed.</p>
<p>Now, we can read the loading state value in our <code>&lt;TodoList&gt;</code> component, and show a loading spinner instead based on that value.</p>
<p>src/features/todos/TodoList.js</p>
<p><span class="token comment" style="color: #c6cad2">// omit imports</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">TodoList</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todoIds </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">selectFilteredTodoIds</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> loadingStatus </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">status</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">loadingStatus </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘loading’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">div className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“todo-list”</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">div className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“loader”</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">div</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> renderedListItems </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> todoIds</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">map</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todoId</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">TodoListItem</span><span class="token plain"> key</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> id</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">ul className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“todo-list”</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">renderedListItems</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">ul</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>In a real app, we’d also want to handle API failure errors and other potential cases.</p>
<p>Here’s what the app looks like with that loading status enabled (to see the spinner again, reload the app preview or open it in a new tab):</p>
<h2 id="flux-standard-actions"><span id="flux-standard-actions" class="anchor enhancedAnchor_2LWZ"></span>Flux Standard Actions<a href="#flux-standard-actions" class="hash-link" title="Direct link to heading">#</a></h2>
<p>The Redux store itself does not actually care what fields you put into your action object. It only cares that <code>action.type</code> exists and has a value, and normal Redux actions always use a string for <code>action.type</code>. That means that you <em>could</em> put any other fields into the action that you want. Maybe we could have <code>action.todo</code> for a “todo added” action, or <code>action.color</code>, and so on.</p>
<p>However, if every action uses different field names for its data fields, it can be hard to know ahead of time what fields you need to handle in each reducer.</p>
<p>That’s why the Redux community came up with <a href="../../../github.com/redux-utilities/flux-standard-action.html#motivation">the “Flux Standard Actions” convention</a>, or “FSA”. This is a suggested approach for how to organize fields inside of action objects, so that developers always know what fields contain what kind of data. The FSA pattern is widely used in the Redux community, and in fact you’ve already been using it throughout this whole tutorial.</p>
<p>The FSA convention says that:</p>
<ul>
<li>If your action object has any actual data, that “data” value of your action should always go in <code>action.payload</code></li>
<li>An action may also have an <code>action.meta</code> field with extra descriptive data</li>
<li>An action may have an <code>action.error</code> field with error information</li>
</ul>
<p>So, <em>all</em> Redux actions MUST:</p>
<ul>
<li>be a plain JavaScript object</li>
<li>have a <code>type</code> field</li>
</ul>
<p>And if you write your actions using the FSA pattern, an action MAY</p>
<ul>
<li>have a <code>payload</code> field</li>
<li>have an <code>error</code> field</li>
<li>have a <code>meta</code> field</li>
</ul>
<h4 id="detailed-explanation-fsas-and-errors">Detailed Explanation: FSAs and Errors</h4>
<p>The FSA specification says that:</p>
<blockquote>
<p>The optional <code>error</code> property MAY be set to <code>true</code> if the action represents an error. An action whose <code>error</code> is true is analogous to a rejected Promise. By convention, the <code>payload</code> SHOULD be an error object. If <code>error</code> has any other value besides <code>true</code>, including <code>undefined</code> and <code>null</code>, the action MUST NOT be interpreted as an error.</p>
</blockquote>
<p>The FSA specs also argue against having specific action types for things like “loading succeeded” and “loading failed”.</p>
<p>However, in practice, the Redux community has ignored the idea of using <code>action.error</code> as a boolean flag, and instead settled on separate action types, like <code>'todos/todosLoadingSucceeded'</code> and <code>'todos/todosLoadingFailed'</code>. This is because it’s much easier to check for those action types than it is to first handle <code>'todos/todosLoaded'</code> and <em>then</em> check <code>if (action.error)</code>.</p>
<p>You can do whichever approach works better for you, but most apps use separate action types for success and failure.</p>
<h2 id="normalized-state"><span id="normalized-state" class="anchor enhancedAnchor_2LWZ"></span>Normalized State<a href="#normalized-state" class="hash-link" title="Direct link to heading">#</a></h2>
<p>So far, we’ve kept our todos in an array. This is reasonable, because we received the data from the server as an array, and we also need to loop over the todos to show them as a list in the UI.</p>
<p>However, in larger Redux apps, it is common to store data in a <strong>normalized state structure</strong>. “Normalization” means:</p>
<ul>
<li>Making sure there is only one copy of each piece of data</li>
<li>Storing items in a way that allows directly finding items by ID</li>
<li>Referring to other items based on IDs, instead of copying the entire item</li>
</ul>
<p>For example, in a blogging application, you might have <code>Post</code> objects that point to <code>User</code> and <code>Comment</code> objects. There might be many posts by the same person, so if every <code>Post</code> object includes an entire <code>User</code>, we would have many copies of the same <code>User</code> object. Instead, a <code>Post</code> object would have a user ID value as <code>post.user</code>, and then we could look up <code>User</code> objects by ID as <code>state.users[post.user]</code>.</p>
<p>This means we typically organize our data as objects instead of arrays, where the item IDs are the keys and the items themselves are the values, like this:</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> rootState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> todos</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token number" style="color: #ae81ff">2</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> id</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">2</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Buy milk’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> completed</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">false</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token number" style="color: #ae81ff">7</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> id</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">7</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Clean room’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> completed</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">true</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>Let’s convert our todos slice to store the todos in a normalized form. This will require some significant changes to our reducer logic, as well as updating the selectors:</p>
<p>src/features/todos/todosSlice</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">todosReducer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color: #f8f8f2">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">switch</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">type</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoAdded’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> todo</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoToggled’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todoId </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> completed</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">!</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/colorSelected’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> color</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> todoId </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> color</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todoDeleted’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> newEntities </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">delete</span><span class="token plain"> newEntities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> newEntities</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/allCompleted’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> newEntities </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">values</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">newEntities</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">forEach</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> newEntities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> completed</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">true</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> newEntities</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/completedCleared’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> newEntities </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">values</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">newEntities</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">forEach</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">completed</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">delete</span><span class="token plain"> newEntities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> newEntities</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todosLoading’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘loading’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘todos/todosLoaded’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> newEntities </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">forEach</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> newEntities</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todo</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> todo</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> status</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> entities</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> newEntities</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> state</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// omit action creators</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectTodoEntities</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">entities</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> selectTodos </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createSelector</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">selectTodoEntities</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token parameter">entities</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">values</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">entities</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">selectTodoById</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> todoId</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">selectTodoEntities</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">todoId</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>Because our <code>state.entities</code> field is now an object instead of an array, we have to use nested object spread operators to update the data instead of array operations. Also, we can’t loop over objects the way we loop over arrays, so there’s several places where we have to use <code>Object.values(entities)</code> to get an array of the todo items so that we can loop over them.</p>
<p>The good news is that because we’re using selectors to encapsulate the state lookups, our UI still doesn’t have to change. The bad news is that the reducer code is actually longer and more complicated.</p>
<p>Part of the issue here is that <strong>this todo app example is not a large real-world application</strong>. So, normalizing state is not as useful in this particular app, and it’s harder to see the potential benefits.</p>
<p>Fortunately, in <a href="part-8-modern-redux.html">Part 8: Modern Redux with Redux Toolkit</a> we’ll see some ways to drastically shorten the reducer logic for managing our normalized state.</p>
<p>For now, the important things to understand are:</p>
<ul>
<li>Normalization <em>is</em> commonly used in Redux apps</li>
<li>The primary benefits are being able to look up individual items by ID and ensure that only one copy of an item exists in the state</li>
</ul>
<h5 id="info-2"><span class="admonition-icon"> </span>info</h5>
<p>For more details on why normalization is useful with Redux, see:</p>
<ul>
<li><a href="../../recipes/structuring-reducers/normalizing-state-shape.html">Structuring Reducers: Normalizing State Shape</a></li>
</ul>
<h2 id="thunks-and-promises"><span id="thunks-and-promises" class="anchor enhancedAnchor_2LWZ"></span>Thunks and Promises<a href="#thunks-and-promises" class="hash-link" title="Direct link to heading">#</a></h2>
<p>We have one last pattern to look at for this section. We’ve already seen how to handle loading state in the Redux store based on dispatched actions. What if we need to look at the results of a thunk in our components?</p>
<p>Whenever you call <code>store.dispatch(action)</code>, <code>dispatch</code> will actually return the <code>action</code> as its result. Middleware can then modify that behavior and return some other value instead.</p>
<p>We’ve already seen that the Redux Thunk middleware lets us pass a function to <code>dispatch</code>, calls the function, and then returns the result:</p>
<p>reduxThunkMiddleware.js</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">reduxThunkMiddleware</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">storeAPI</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token parameter">next</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token parameter">action</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// If the “action” is actually a function instead…</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token keyword" style="color: #f92672">typeof</span><span class="token plain"> action </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘function’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// then call the function and pass `dispatch` and `getState` as arguments</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Also, return whatever the thunk function returns</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">action</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">storeAPI</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">dispatch</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> storeAPI</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">getState</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Otherwise, it’s a normal action - send it onwards</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">next</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span>This means that <strong>we can write thunk functions that return a promise, and wait on that promise in our components</strong>.</p>
<p>We already have our <code>&lt;Header&gt;</code> component dispatching a thunk to save new todo entries to the server. Let’s add some loading state inside the <code>&lt;Header&gt;</code> component, then disable the text input and show another loading spinner while we’re waiting for the server:</p>
<p>src/features/header/Header.js</p>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">Header</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">text</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> setText</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">’’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">status</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> setStatus</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useState</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">useDispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">handleChange</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">setText</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">e</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">target</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">value</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">handleKeyDown</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">async</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// If the user pressed the Enter key:</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> trimmedText </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> text</span><span class="token punctuation" style="color: #f8f8f2">.</span><span style="color: #e6d874">trim</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">e</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">which</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">13</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&amp;&amp;</span><span class="token plain"> trimmedText</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Create and dispatch the thunk function itself</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">setStatus</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘loading’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Wait for the promise returned by saveNewTodo</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">await</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token function" style="color: #e6d874">saveNewTodo</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">trimmedText</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// And clear out the text input</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">setText</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">’’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function" style="color: #e6d874">setStatus</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token string" style="color: #a6e22e">‘idle’</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">let</span><span class="token plain"> isLoading </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> status </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘loading’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">let</span><span class="token plain"> placeholder </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> isLoading </span><span class="token operator" style="color: #f8f8f2">?</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">’’</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘What needs to be done?’</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">let</span><span class="token plain"> loader </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> isLoading </span><span class="token operator" style="color: #f8f8f2">?</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">div className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“loader”</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color: #f92672">null</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">header className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“header”</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">input</span></p>
<p><span class="token plain"> className</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token string" style="color: #a6e22e">“new-todo”</span><span class="token plain"></span></p>
<p><span class="token plain"> placeholder</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">placeholder</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> autoFocus</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token boolean" style="color: #ae81ff">true</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> value</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">text</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> onChange</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">handleChange</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> onKeyDown</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">handleKeyDown</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> disabled</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">isLoading</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">loader</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">header</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> </span><span class="token maybe-class-name">Header</span>Now, if we add a todo, we’ll see a spinner in the header:</p>
<figure>
<img src="../../../d33wubrfki0l68.cloudfront.net/5dc92c9d4782e4ac28c96afd10c19179a424c826/073f5/assets/images/todos-app-headerloading-9b4bca9cb4675bf35df09a2e709ec" alt="Todo app - component loading spinner" /><figcaption>Todo app - component loading spinner</figcaption>
</figure>
<h2 id="what-youve-learned"><span id="what-youve-learned" class="anchor enhancedAnchor_2LWZ"></span>What You’ve Learned<a href="#what-youve-learned" class="hash-link" title="Direct link to heading">#</a></h2>
<p>As you’ve seen, there’s several additional patterns that are widely used in Redux apps. These patterns are not required, and may involve writing more code initially, but they provide benefits like making logic reusable, encapsulating implementation details, improving app performance, and making it easier to look up data.</p>
<h5 id="info-3"><span class="admonition-icon"> </span>info</h5>
<p>For more details on why these patterns exist and how Redux is meant to be used, see:</p>
<ul>
<li><a href="../../../blog.isquaredsoftware.com/2017/05/idiomatic-redux-tao-of-redux-part-1/index.html">Idiomatic Redux: The Tao of Redux, Part 1 - Implementation and Intent</a></li>
<li><a href="../../../blog.isquaredsoftware.com/2017/05/idiomatic-redux-tao-of-redux-part-2/index.html">Idiomatic Redux: The Tao of Redux, Part 2 - Practice and Philosophy</a></li>
</ul>
<p>Here’s how our app looks after it’s been fully converted to use these patterns:</p>
<h5 id="summary"><span class="admonition-icon"> </span>Summary</h5>
<ul>
<li><strong>Action creator functions encapsulate preparing action objects and thunks</strong>
<ul>
<li>Action creators can accept arguments and contain setup logic, and return the final action object or thunk function</li>
</ul></li>
<li><strong>Memoized selectors help improve Redux app performance</strong>
<ul>
<li>Reselect has a <code>createSelector</code> API that generates memoized selectors</li>
<li>Memoized selectors return the same result reference if given the same inputs</li>
</ul></li>
<li><strong>Request status should be stored as an enum, not booleans</strong>
<ul>
<li>Using enums like <code>'idle'</code> and <code>'loading'</code> helps track status consistently</li>
</ul></li>
<li><strong>“Flux Standard Actions” are the common convention for organizing action objects</strong>
<ul>
<li>Actions use <code>payload</code> for data, <code>meta</code> for extra descriptions, and <code>error</code> for errors</li>
</ul></li>
<li><strong>Normalized state makes it easier to find items by ID</strong>
<ul>
<li>Normalized data is stored in objects instead of arrays, with item IDs as keys</li>
</ul></li>
<li><strong>Thunks can return promises from <code>dispatch</code></strong>
<ul>
<li>Components can wait for async thunks to complete, then do more work</li>
</ul></li>
</ul>
<h2 id="whats-next"><span id="whats-next" class="anchor enhancedAnchor_2LWZ"></span>What’s Next?<a href="#whats-next" class="hash-link" title="Direct link to heading">#</a></h2>
<p>Writing all this code “by hand” can be time-consuming and difficult. <strong>That’s why we recommend that you use our official <a href="../../../redux-toolkit.js.org/index.html">Redux Toolkit</a> package to write your Redux logic instead</strong>.</p>
<p>Redux Toolkit includes APIs that <strong>help you write all the typical Redux usage patterns, but with less code</strong>. It also helps <strong>prevent common mistakes</strong> like accidentally mutating state.</p>
<p>In <a href="part-8-modern-redux.html">Part 8: Modern Redux</a>, we’ll cover how to use Redux Toolkit to simplify all the code we’ve written so far.</p>
<p><a href="part-6-async-logic.html" class="pagination-nav__link"></a></p>
<p>« Redux Fundamentals, Part 6: Async Logic and Data Fetching</p>
<p><a href="part-8-modern-redux.html" class="pagination-nav__link"></a></p>
<p>Next</p>
<p>Redux Fundamentals, Part 8: Modern Redux with Redux Toolkit »</p>
<ul>
<li><a href="#action-creators" class="table-of-contents__link">Action Creators</a>
<ul>
<li><a href="#using-action-creators" class="table-of-contents__link">Using Action Creators</a></li>
</ul></li>
<li><a href="#memoized-selectors" class="table-of-contents__link">Memoized Selectors</a>
<ul>
<li><a href="#memoizing-selectors-with-createselector" class="table-of-contents__link">Memoizing Selectors with &lt;code class="language-js &gt;createSelector</code></a></li>
<li><a href="#selectors-with-multiple-arguments" class="table-of-contents__link">Selectors with Multiple Arguments</a></li>
</ul></li>
<li><a href="#async-request-status" class="table-of-contents__link">Async Request Status</a>
<ul>
<li><a href="#loading-state-enum-values" class="table-of-contents__link">Loading State Enum Values</a></li>
</ul></li>
<li><a href="#flux-standard-actions" class="table-of-contents__link">Flux Standard Actions</a></li>
<li><a href="#normalized-state" class="table-of-contents__link">Normalized State</a></li>
<li><a href="#thunks-and-promises" class="table-of-contents__link">Thunks and Promises</a></li>
<li><a href="#what-youve-learned" class="table-of-contents__link">What You’ve Learned</a></li>
<li><a href="#whats-next" class="table-of-contents__link">What’s Next?</a></li>
</ul>
<h4 id="docs">Docs</h4>
<ul>
<li><a href="../official/introduction/getting-started.html" class="footer__link-item">Getting Started</a></li>
<li><a href="../essentials/part-1-overview-concepts.html" class="footer__link-item">Tutorial</a></li>
<li><a href="../official/faq.html" class="footer__link-item">FAQ</a></li>
<li><a href="../official/api/api-reference.html" class="footer__link-item">API Reference</a></li>
</ul>
<h4 id="community">Community</h4>
<ul>
<li><a href="../official/../discord.com/invite/0ZcbPKXt5bZ6au5t.html" class="footer__link-item">Reactiflux Discord</a></li>
<li><a href="../official/../stackoverflow.com/questions/tagged/redux.html" class="footer__link-item">Stack Overflow</a></li>
<li><a href="../official/introduction/getting-started.html#help-and-discussion" class="footer__link-item">Feedback</a></li>
</ul>
<h4 id="more">More</h4>
<ul>
<li><a href="../official/../github.com/reduxjs/redux.html" class="footer__link-item">GitHub</a></li>
<li><a href="../../../www.netlify.com/index.html"><img src="../../../www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify" /></a></li>
</ul>
<p><a href="../official/index.html" class="footerLogoLink_MyFc"><img src="../official/../d33wubrfki0l68.cloudfront.net/0834d0215db51e91525a25acf97433051f280f2f/c30f5/img/redux.svg" alt="Redux Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo" /></p>
</body>
</html>
