<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Albert Krewinkel" />
  <meta name="author" content="John MacFarlane" />
  <meta name="dcterms.date" content="2020-01-10" />
  <title>Pandoc Lua Filters</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Pandoc Lua Filters</h1>
<p class="author">Albert Krewinkel</p>
<p class="author">John MacFarlane</p>
<p class="date">January 10, 2020</p>
</header>
<h1 id="introduction">Introduction</h1>
<p>Pandoc has long supported filters, which allow the pandoc abstract syntax tree (AST) to be manipulated between the parsing and the writing phase. <a href="https://pandoc.org/filters.html">Traditional pandoc filters</a> accept a JSON representation of the pandoc AST and produce an altered JSON representation of the AST. They may be written in any programming language, and invoked from pandoc using the <code>--filter</code> option.</p>
<p>Although traditional filters are very flexible, they have a couple of disadvantages. First, there is some overhead in writing JSON to stdout and reading it from stdin (twice, once on each side of the filter). Second, whether a filter will work will depend on details of the user’s environment. A filter may require an interpreter for a certain programming language to be available, as well as a library for manipulating the pandoc AST in JSON form. One cannot simply provide a filter that can be used by anyone who has a certain version of the pandoc executable.</p>
<p>Starting with version 2.0, pandoc makes it possible to write filters in Lua without any external dependencies at all. A Lua interpreter (version 5.3) and a Lua library for creating pandoc filters is built into the pandoc executable. Pandoc data types are marshaled to Lua directly, avoiding the overhead of writing JSON to stdout and reading it from stdin.</p>
<p>Here is an example of a Lua filter that converts strong emphasis to small caps:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb1-1" title="1"><span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="op">{</span></a>
<a class="sourceLine" id="cb1-3" title="3">    Strong <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span>elem<span class="op">)</span></a>
<a class="sourceLine" id="cb1-4" title="4">      <span class="cf">return</span> pandoc<span class="op">.</span>SmallCaps<span class="op">(</span>elem<span class="op">.</span>c<span class="op">)</span></a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="cf">end</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="op">}</span></a></code></pre></div>
<p>or equivalently,</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">function</span> Strong<span class="op">(</span>elem<span class="op">)</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="cf">return</span> pandoc<span class="op">.</span>SmallCaps<span class="op">(</span>elem<span class="op">.</span>c<span class="op">)</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="cf">end</span></a></code></pre></div>
<p>This says: walk the AST, and when you find a Strong element, replace it with a SmallCaps element with the same content.</p>
<p>To run it, save it in a file, say <code>smallcaps.lua</code>, and invoke pandoc with <code>--lua-filter=smallcaps.lua</code>.</p>
<p>Here’s a quick performance comparison, converting the pandoc manual (MANUAL.txt) to HTML, with versions of the same JSON filter written in compiled Haskell (<code>smallcaps</code>) and interpreted Python (<code>smallcaps.py</code>):</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Command</th>
<th style="text-align: left;">Time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>pandoc</code></td>
<td style="text-align: left;">1.01s</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>pandoc --filter ./smallcaps</code></td>
<td style="text-align: left;">1.36s</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>pandoc --filter ./smallcaps.py</code></td>
<td style="text-align: left;">1.40s</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>pandoc --lua-filter ./smallcaps.lua</code></td>
<td style="text-align: left;">1.03s</td>
</tr>
</tbody>
</table>
<p>As you can see, the Lua filter avoids the substantial overhead associated with marshaling to and from JSON over a pipe.</p>
<h1 id="lua-filter-structure">Lua filter structure</h1>
<p>Lua filters are tables with element names as keys and values consisting of functions acting on those elements.</p>
<p>Filters are expected to be put into separate files and are passed via the <code>--lua-filter</code> command-line argument. For example, if a filter is defined in a file <code>current-date.lua</code>, then it would be applied like this:</p>
<pre><code>pandoc --lua-filter=current-date.lua -f markdown MANUAL.txt</code></pre>
<p>The <code>--lua-filter</code> option may be supplied multiple times. Pandoc applies all filters (including JSON filters specified via <code>--filter</code> and Lua filters specified via <code>--lua-filter</code>) in the order they appear on the command line.</p>
<p>Pandoc expects each Lua file to return a list of filters. The filters in that list are called sequentially, each on the result of the previous filter. If there is no value returned by the filter script, then pandoc will try to generate a single filter by collecting all top-level functions whose names correspond to those of pandoc elements (e.g., <code>Str</code>, <code>Para</code>, <code>Meta</code>, or <code>Pandoc</code>). (That is why the two examples above are equivalent.)</p>
<p>For each filter, the document is traversed and each element subjected to the filter. Elements for which the filter contains an entry (i.e. a function of the same name) are passed to Lua element filtering function. In other words, filter entries will be called for each corresponding element in the document, getting the respective element as input.</p>
<p>The return of a filter function must be one of the following:</p>
<ul>
<li>nil: this means that the object should remain unchanged.</li>
<li>a pandoc object: this must be of the same type as the input and will replace the original object.</li>
<li>a list of pandoc objects: these will replace the original object; the list is merged with the neighbors of the original objects (spliced into the list the original object belongs to); returning an empty list deletes the object.</li>
</ul>
<p>The function’s output must result in an element of the same type as the input. This means a filter function acting on an inline element must return either nil, an inline, or a list of inlines, and a function filtering a block element must return one of nil, a block, or a list of block elements. Pandoc will throw an error if this condition is violated.</p>
<p>If there is no function matching the element’s node type, then the filtering system will look for a more general fallback function. Two fallback functions are supported, <code>Inline</code> and <code>Block</code>. Each matches elements of the respective type.</p>
<p>Elements without matching functions are left untouched.</p>
<p>See <a href="#module-pandoc">module documentation</a> for a list of pandoc elements.</p>
<h2 id="filters-on-element-sequences">Filters on element sequences</h2>
<p>For some filtering tasks, it is necessary to know the order in which elements occur in the document. It is not enough then to inspect a single element at a time.</p>
<p>There are two special function names, which can be used to define filters on lists of blocks or lists of inlines.</p>
<dl>
<dt><span id="inlines-filter"><code>Inlines (inlines)</code></span></dt>
<dd>If present in a filter, this function will be called on all lists of inline elements, like the content of a <a href="#type-para">Para</a> (paragraph) block, or the description of an <a href="#type-image">Image</a>. The <code>inlines</code> argument passed to the function will be a <a href="#type-list">List</a> of <a href="#type-inline">Inlines</a> for each call.
</dd>
<dt><span id="blocks-filter"><code>Blocks (blocks)</code></span></dt>
<dd>If present in a filter, this function will be called on all lists of block elements, like the content of a <a href="#type-metablocks">MetaBlocks</a> meta element block, on each item of a list, and the main content of the <a href="#type-pandoc">Pandoc</a> document. The <code>blocks</code> argument passed to the function will be a <a href="#type-list">List</a> of <a href="#type-block">Blocks</a> for each call.
</dd>
</dl>
<p>These filter functions are special in that the result must either be nil, in which case the list is left unchanged, or must be a list of the correct type, i.e., the same type as the input argument. Single elements are <strong>not</strong> allowed as return values, as a single element in this context usually hints at a bug.</p>
<p>See <a href="#remove-spaces-before-citations">“Remove spaces before normal citations”</a> for an example.</p>
<p>This functionality has been added in pandoc 2.9.2.</p>
<h2 id="execution-order">Execution Order</h2>
<p>Element filter functions within a filter set are called in a fixed order, skipping any which are not present:</p>
<ol type="1">
<li>functions for <a href="#type-inline"><em>Inline</em> elements</a>,</li>
<li>the <a href="#inlines-filter"><code>Inlines</code></a> filter function,</li>
<li>functions for <a href="#type-block"><em>Block</em> elements</a> ,</li>
<li>the <a href="#inlines-filter"><code>Blocks</code></a> filter function,</li>
<li>the <a href="#type-meta"><code>Meta</code></a> filter function, and last</li>
<li>the <a href="#type-pandoc"><code>Pandoc</code></a> filter function.</li>
</ol>
<p>It is still possible to force a different order by explicitly returning multiple filter sets. For example, if the filter for <em>Meta</em> is to be run before that for <em>Str</em>, one can write</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb4-1" title="1"><span class="co">-- ... filter definitions ...</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="op">{</span> Meta <span class="op">=</span> Meta <span class="op">},</span>  <span class="co">-- (1)</span></a>
<a class="sourceLine" id="cb4-5" title="5">  <span class="op">{</span> Str <span class="op">=</span> Str <span class="op">}</span>     <span class="co">-- (2)</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="op">}</span></a></code></pre></div>
<p>Filter sets are applied in the order in which they are returned. All functions in set (1) are thus run before those in (2), causing the filter function for <em>Meta</em> to be run before the filtering of <em>Str</em> elements is started.</p>
<h2 id="global-variables">Global variables</h2>
<p>Pandoc passes additional data to Lua filters by setting global variables.</p>
<dl>
<dt><code>FORMAT</code></dt>
<dd>The global <code>FORMAT</code> is set to the format of the pandoc writer being used (<code>html5</code>, <code>latex</code>, etc.), so the behavior of a filter can be made conditional on the eventual output format.
</dd>
<dt><code>PANDOC_READER_OPTIONS</code></dt>
<dd>Table of the options which were provided to the parser.
</dd>
<dt><code>PANDOC_VERSION</code></dt>
<dd>Contains the pandoc version as a <a href="#type-version">Version</a> object which behaves like a numerically indexed table, most significant number first. E.g., for pandoc 2.7.3, the value of the variable is equivalent to a table <code>{2, 7, 3}</code>. Use <code>tostring(PANDOC_VERSION)</code> to produce a version string. This variable is also set in custom writers.
</dd>
<dt><code>PANDOC_API_VERSION</code></dt>
<dd>Contains the version of the pandoc-types API against which pandoc was compiled. It is given as a numerically indexed table, most significant number first. E.g., if pandoc was compiled against pandoc-types 1.17.3, then the value of the variable will behave like the table <code>{1, 17, 3}</code>. Use <code>tostring(PANDOC_API_VERSION)</code> to produce a version string. This variable is also set in custom writers.
</dd>
<dt><code>PANDOC_SCRIPT_FILE</code></dt>
<dd>The name used to involve the filter. This value can be used to find files relative to the script file. This variable is also set in custom writers.
</dd>
<dt><code>PANDOC_STATE</code></dt>
<dd>The state shared by all readers and writers. It is used by pandoc to collect and pass information. The value of this variable is of type <a href="#type-commonstate">CommonState</a> and is read-only.
</dd>
</dl>
<h1 id="pandoc-module">Pandoc Module</h1>
<p>The <code>pandoc</code> Lua module is loaded into the filter’s Lua environment and provides a set of functions and constants to make creation and manipulation of elements easier. The global variable <code>pandoc</code> is bound to the module and should generally not be overwritten for this reason.</p>
<p>Two major functionalities are provided by the module: element creator functions and access to some of pandoc’s main functionalities.</p>
<h2 id="element-creation">Element creation</h2>
<p>Element creator functions like <code>Str</code>, <code>Para</code>, and <code>Pandoc</code> are designed to allow easy creation of new elements that are simple to use and can be read back from the Lua environment. Internally, pandoc uses these functions to create the Lua objects which are passed to element filter functions. This means that elements created via this module will behave exactly as those elements accessible through the filter function parameter.</p>
<h2 id="exposed-pandoc-functionality">Exposed pandoc functionality</h2>
<p>Some pandoc functions have been made available in Lua:</p>
<ul>
<li><a href="#pandoc.walk_block"><code>walk_block</code></a> and <a href="#pandoc.walk_inline"><code>walk_inline</code></a> allow filters to be applied inside specific block or inline elements;</li>
<li><a href="#pandoc.read"><code>read</code></a> allows filters to parse strings into pandoc documents;</li>
<li><a href="#pandoc.pipe"><code>pipe</code></a> runs an external command with input from and output to strings;</li>
<li>the <a href="#module-pandoc.mediabag"><code>pandoc.mediabag</code></a> module allows access to the “mediabag,” which stores binary content such as images that may be included in the final document;</li>
<li>the <a href="#module-pandoc.utils"><code>pandoc.utils</code></a> module contains various utility functions.</li>
</ul>
<h1 id="lua-interpreter-initialization">Lua interpreter initialization</h1>
<p>Initialization of pandoc’s Lua interpreter can be controlled by placing a file <code>init.lua</code> in pandoc’s data directory. A common use-case would be to load additional modules, or even to alter default modules.</p>
<p>The following snippet is an example of code that might be useful when added to <code>init.lua</code>. The snippet adds all Unicode-aware functions defined in the <a href="#module-text"><code>text</code> module</a> to the default <code>string</code> module, prefixed with the string <code>uc_</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb5-1" title="1"><span class="cf">for</span> name<span class="op">,</span> fn <span class="kw">in</span> <span class="fu">pairs</span><span class="op">(</span><span class="fu">require</span> <span class="st">&#39;text&#39;</span><span class="op">)</span> <span class="cf">do</span></a>
<a class="sourceLine" id="cb5-2" title="2">  string<span class="op">[</span><span class="st">&#39;uc_&#39;</span> <span class="op">..</span> name<span class="op">]</span> <span class="op">=</span> fn</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="cf">end</span></a></code></pre></div>
<p>This makes it possible to apply these functions on strings using colon syntax (<code>mystring:uc_upper()</code>).</p>
<h1 id="debugging-lua-filters">Debugging Lua filters</h1>
<p>It is possible to use a debugging interface to halt execution and step through a Lua filter line by line as it is run inside Pandoc. This is accomplished using the remote-debugging interface of the package <a href="https://github.com/pkulchenko/MobDebug"><code>mobdebug</code></a>. Although mobdebug can be run from the terminal, it is more useful run within the donation-ware Lua editor and IDE, <a href="https://studio.zerobrane.com/">ZeroBrane</a>. ZeroBrane offers a REPL console and UI to step-through and view all variables and state.</p>
<p>If you already have Lua 5.3 installed, you can add <a href="https://luarocks.org/modules/paulclinger/mobdebug"><code>mobdebug</code></a> and its dependency <a href="https://luarocks.org/modules/luasocket/luasocket"><code>luasocket</code></a> using <a href="https://luarocks.org"><code>luarocks</code></a>, which should then be available on the path. ZeroBrane also includes both of these in its package, so if you don’t want to install Lua separately, you should add/modify your <code>LUA_PATH</code> and <code>LUA_CPATH</code> to include the correct locations; <a href="https://studio.zerobrane.com/doc-remote-debugging">see detailed instructions here</a>.</p>
<h1 id="examples">Examples</h1>
<p>The following filters are presented as examples. A repository of useful Lua filters (which may also serve as good examples) is available at <a href="https://github.com/pandoc/lua-filters" class="uri">https://github.com/pandoc/lua-filters</a>.</p>
<h2 id="macro-substitution">Macro substitution</h2>
<p>The following filter converts the string <code>{{helloworld}}</code> into emphasized text “Hello, World”.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb6-1" title="1"><span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">    Str <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span>elem<span class="op">)</span></a>
<a class="sourceLine" id="cb6-4" title="4">      <span class="cf">if</span> elem<span class="op">.</span>text <span class="op">==</span> <span class="st">&quot;{{helloworld}}&quot;</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb6-5" title="5">        <span class="cf">return</span> pandoc<span class="op">.</span>Emph <span class="op">{</span>pandoc<span class="op">.</span>Str <span class="st">&quot;Hello, World&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb6-6" title="6">      <span class="cf">else</span></a>
<a class="sourceLine" id="cb6-7" title="7">        <span class="cf">return</span> elem</a>
<a class="sourceLine" id="cb6-8" title="8">      <span class="cf">end</span></a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="cf">end</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="op">}</span></a></code></pre></div>
<h2 id="center-images-in-latex-and-html-output">Center images in LaTeX and HTML output</h2>
<p>For LaTeX, wrap an image in LaTeX snippets which cause the image to be centered horizontally. In HTML, the image element’s style attribute is used to achieve centering.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb7-1" title="1"><span class="co">-- Filter images with this function if the target format is LaTeX.</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="cf">if</span> <span class="cn">FORMAT</span><span class="op">:</span><span class="fu">match</span> <span class="st">&#39;latex&#39;</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="kw">function</span> Image <span class="op">(</span>elem<span class="op">)</span></a>
<a class="sourceLine" id="cb7-4" title="4">    <span class="co">-- Surround all images with image-centering raw LaTeX.</span></a>
<a class="sourceLine" id="cb7-5" title="5">    <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-6" title="6">      pandoc<span class="op">.</span>RawInline<span class="op">(</span><span class="st">&#39;latex&#39;</span><span class="op">,</span> <span class="st">&#39;</span><span class="sc">\\</span><span class="st">hfill</span><span class="sc">\\</span><span class="st">break{</span><span class="sc">\\</span><span class="st">centering&#39;</span><span class="op">),</span></a>
<a class="sourceLine" id="cb7-7" title="7">      elem<span class="op">,</span></a>
<a class="sourceLine" id="cb7-8" title="8">      pandoc<span class="op">.</span>RawInline<span class="op">(</span><span class="st">&#39;latex&#39;</span><span class="op">,</span> <span class="st">&#39;</span><span class="sc">\\</span><span class="st">par}&#39;</span><span class="op">)</span></a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="op">}</span></a>
<a class="sourceLine" id="cb7-10" title="10">  <span class="cf">end</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="cf">end</span></a>
<a class="sourceLine" id="cb7-12" title="12"></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">-- Filter images with this function if the target format is HTML</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="cf">if</span> <span class="cn">FORMAT</span><span class="op">:</span><span class="fu">match</span> <span class="st">&#39;html&#39;</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb7-15" title="15">  <span class="kw">function</span> Image <span class="op">(</span>elem<span class="op">)</span></a>
<a class="sourceLine" id="cb7-16" title="16">    <span class="co">-- Use CSS style to center image</span></a>
<a class="sourceLine" id="cb7-17" title="17">    elem<span class="op">.</span>attributes<span class="op">.</span>style <span class="op">=</span> <span class="st">&#39;margin:auto; display: block;&#39;</span></a>
<a class="sourceLine" id="cb7-18" title="18">    <span class="cf">return</span> elem</a>
<a class="sourceLine" id="cb7-19" title="19">  <span class="cf">end</span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="cf">end</span></a></code></pre></div>
<h2 id="setting-the-date-in-the-metadata">Setting the date in the metadata</h2>
<p>This filter sets the date in the document’s metadata to the current date, if a date isn’t already set:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">function</span> Meta<span class="op">(</span>m<span class="op">)</span></a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="cf">if</span> m<span class="op">.</span>date <span class="op">==</span> <span class="kw">nil</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb8-3" title="3">    m<span class="op">.</span>date <span class="op">=</span> <span class="fu">os.date</span><span class="op">(</span><span class="st">&quot;%B %e, %Y&quot;</span><span class="op">)</span></a>
<a class="sourceLine" id="cb8-4" title="4">    <span class="cf">return</span> m</a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="cf">end</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="cf">end</span></a></code></pre></div>
<h2 id="remove-spaces-before-citations">Remove spaces before citations</h2>
<p>This filter removes all spaces preceding an “author-in-text” citation. In Markdown, author-in-text citations (e.g., <code>@citekey</code>), must be preceded by a space. If these spaces are undesired, they must be removed with a filter.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">local</span> <span class="kw">function</span> is_space_before_author_in_text<span class="op">(</span>spc<span class="op">,</span> cite<span class="op">)</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="cf">return</span> spc <span class="kw">and</span> spc<span class="op">.</span>t <span class="op">==</span> <span class="st">&#39;Space&#39;</span></a>
<a class="sourceLine" id="cb9-3" title="3">    <span class="kw">and</span> cite <span class="kw">and</span> cite<span class="op">.</span>t <span class="op">==</span> <span class="st">&#39;Cite&#39;</span></a>
<a class="sourceLine" id="cb9-4" title="4">    <span class="co">-- there must be only a single citation, and it must have</span></a>
<a class="sourceLine" id="cb9-5" title="5">    <span class="co">-- mode &#39;AuthorInText&#39;</span></a>
<a class="sourceLine" id="cb9-6" title="6">    <span class="kw">and</span> <span class="op">#</span>cite<span class="op">.</span>citations <span class="op">==</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb9-7" title="7">    <span class="kw">and</span> cite<span class="op">.</span>citations<span class="op">[</span><span class="dv">1</span><span class="op">].</span>mode <span class="op">==</span> <span class="st">&#39;AuthorInText&#39;</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="cf">end</span></a>
<a class="sourceLine" id="cb9-9" title="9"></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="kw">function</span> Inlines <span class="op">(</span>inlines<span class="op">)</span></a>
<a class="sourceLine" id="cb9-11" title="11">  <span class="co">-- Go from end to start to avoid problems with shifting indices.</span></a>
<a class="sourceLine" id="cb9-12" title="12">  <span class="cf">for</span> i <span class="op">=</span> <span class="op">#</span>inlines<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span> <span class="cf">do</span></a>
<a class="sourceLine" id="cb9-13" title="13">    <span class="cf">if</span> is_space_before_author_in_text<span class="op">(</span>inlines<span class="op">[</span>i<span class="op">],</span> inlines<span class="op">[</span>i<span class="op">+</span><span class="dv">1</span><span class="op">])</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb9-14" title="14">      inlines<span class="op">:</span><span class="fu">remove</span><span class="op">(</span>i<span class="op">)</span></a>
<a class="sourceLine" id="cb9-15" title="15">    <span class="cf">end</span></a>
<a class="sourceLine" id="cb9-16" title="16">  <span class="cf">end</span></a>
<a class="sourceLine" id="cb9-17" title="17">  <span class="cf">return</span> inlines</a>
<a class="sourceLine" id="cb9-18" title="18"><span class="cf">end</span></a></code></pre></div>
<h2 id="replacing-placeholders-with-their-metadata-value">Replacing placeholders with their metadata value</h2>
<p>Lua filter functions are run in the order</p>
<blockquote>
<p><em>Inlines → Blocks → Meta → Pandoc</em>.</p>
</blockquote>
<p>Passing information from a higher level (e.g., metadata) to a lower level (e.g., inlines) is still possible by using two filters living in the same file:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">local</span> vars <span class="op">=</span> <span class="op">{}</span></a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="kw">function</span> get_vars <span class="op">(</span>meta<span class="op">)</span></a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="cf">for</span> k<span class="op">,</span> v <span class="kw">in</span> <span class="fu">pairs</span><span class="op">(</span>meta<span class="op">)</span> <span class="cf">do</span></a>
<a class="sourceLine" id="cb10-5" title="5">    <span class="cf">if</span> <span class="fu">type</span><span class="op">(</span>v<span class="op">)</span> <span class="op">==</span> <span class="st">&#39;table&#39;</span> <span class="kw">and</span> v<span class="op">.</span>t <span class="op">==</span> <span class="st">&#39;MetaInlines&#39;</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb10-6" title="6">      vars<span class="op">[</span><span class="st">&quot;%&quot;</span> <span class="op">..</span> k <span class="op">..</span> <span class="st">&quot;%&quot;</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="fu">table.unpack</span><span class="op">(</span>v<span class="op">)}</span></a>
<a class="sourceLine" id="cb10-7" title="7">    <span class="cf">end</span></a>
<a class="sourceLine" id="cb10-8" title="8">  <span class="cf">end</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="cf">end</span></a>
<a class="sourceLine" id="cb10-10" title="10"></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="kw">function</span> replace <span class="op">(</span>el<span class="op">)</span></a>
<a class="sourceLine" id="cb10-12" title="12">  <span class="cf">if</span> vars<span class="op">[</span>el<span class="op">.</span>text<span class="op">]</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb10-13" title="13">    <span class="cf">return</span> pandoc<span class="op">.</span>Span<span class="op">(</span>vars<span class="op">[</span>el<span class="op">.</span>text<span class="op">])</span></a>
<a class="sourceLine" id="cb10-14" title="14">  <span class="cf">else</span></a>
<a class="sourceLine" id="cb10-15" title="15">    <span class="cf">return</span> el</a>
<a class="sourceLine" id="cb10-16" title="16">  <span class="cf">end</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="cf">end</span></a>
<a class="sourceLine" id="cb10-18" title="18"></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="cf">return</span> <span class="op">{{</span>Meta <span class="op">=</span> get_vars<span class="op">},</span> <span class="op">{</span>Str <span class="op">=</span> replace<span class="op">}}</span></a></code></pre></div>
<p>If the contents of file <code>occupations.md</code> is</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb11-1" title="1">---</a>
<a class="sourceLine" id="cb11-2" title="2">name: Samuel Q. Smith</a>
<a class="sourceLine" id="cb11-3" title="3">occupation: Professor of Phrenology</a>
<a class="sourceLine" id="cb11-4" title="4">---</a>
<a class="sourceLine" id="cb11-5" title="5"></a>
<a class="sourceLine" id="cb11-6" title="6">Name</a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8">:   %name%</a>
<a class="sourceLine" id="cb11-9" title="9"></a>
<a class="sourceLine" id="cb11-10" title="10">Occupation</a>
<a class="sourceLine" id="cb11-11" title="11"></a>
<a class="sourceLine" id="cb11-12" title="12">:   %occupation%</a></code></pre></div>
<p>then running <code>pandoc --lua-filter=meta-vars.lua occupations.md</code> will output:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">&lt;dl&gt;</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw">&lt;dt&gt;</span>Name<span class="kw">&lt;/dt&gt;</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="kw">&lt;dd&gt;&lt;p&gt;&lt;span&gt;</span>Samuel Q. Smith<span class="kw">&lt;/span&gt;&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="kw">&lt;/dd&gt;</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="kw">&lt;dt&gt;</span>Occupation<span class="kw">&lt;/dt&gt;</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="kw">&lt;dd&gt;&lt;p&gt;&lt;span&gt;</span>Professor of Phrenology<span class="kw">&lt;/span&gt;&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="kw">&lt;/dd&gt;</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="kw">&lt;/dl&gt;</span></a></code></pre></div>
<h2 id="modifying-pandocs-manual.txt-for-man-pages">Modifying pandoc’s <code>MANUAL.txt</code> for man pages</h2>
<p>This is the filter we use when converting <code>MANUAL.txt</code> to man pages. It converts level-1 headers to uppercase (using <code>walk_block</code> to transform inline elements inside headers), removes footnotes, and replaces links with regular text.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb13-1" title="1"><span class="co">-- we use preloaded text to get a UTF-8 aware &#39;upper&#39; function</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">local</span> text <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="st">&#39;text&#39;</span><span class="op">)</span></a>
<a class="sourceLine" id="cb13-3" title="3"></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="kw">function</span> Header<span class="op">(</span>el<span class="op">)</span></a>
<a class="sourceLine" id="cb13-5" title="5">    <span class="cf">if</span> el<span class="op">.</span>level <span class="op">==</span> <span class="dv">1</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb13-6" title="6">      <span class="cf">return</span> pandoc<span class="op">.</span>walk_block<span class="op">(</span>el<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-7" title="7">        Str <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>el<span class="op">)</span></a>
<a class="sourceLine" id="cb13-8" title="8">            <span class="cf">return</span> pandoc<span class="op">.</span>Str<span class="op">(</span>text<span class="op">.</span>upper<span class="op">(</span>el<span class="op">.</span>text<span class="op">))</span></a>
<a class="sourceLine" id="cb13-9" title="9">        <span class="cf">end</span> <span class="op">})</span></a>
<a class="sourceLine" id="cb13-10" title="10">    <span class="cf">end</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="cf">end</span></a>
<a class="sourceLine" id="cb13-12" title="12"></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="kw">function</span> Link<span class="op">(</span>el<span class="op">)</span></a>
<a class="sourceLine" id="cb13-14" title="14">    <span class="cf">return</span> el<span class="op">.</span>content</a>
<a class="sourceLine" id="cb13-15" title="15"><span class="cf">end</span></a>
<a class="sourceLine" id="cb13-16" title="16"></a>
<a class="sourceLine" id="cb13-17" title="17"><span class="kw">function</span> Note<span class="op">(</span>el<span class="op">)</span></a>
<a class="sourceLine" id="cb13-18" title="18">    <span class="cf">return</span> <span class="op">{}</span></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="cf">end</span></a></code></pre></div>
<h2 id="creating-a-handout-from-a-paper">Creating a handout from a paper</h2>
<p>This filter extracts all the numbered examples, section headers, block quotes, and figures from a document, in addition to any divs with class <code>handout</code>. (Note that only blocks at the “outer level” are included; this ignores blocks inside nested constructs, like list items.)</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb14-1" title="1"><span class="co">-- creates a handout from an article, using its headings,</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="co">-- blockquotes, numbered examples, figures, and any</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="co">-- Divs with class &quot;handout&quot;</span></a>
<a class="sourceLine" id="cb14-4" title="4"></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="kw">function</span> Pandoc<span class="op">(</span>doc<span class="op">)</span></a>
<a class="sourceLine" id="cb14-6" title="6">    <span class="kw">local</span> hblocks <span class="op">=</span> <span class="op">{}</span></a>
<a class="sourceLine" id="cb14-7" title="7">    <span class="cf">for</span> i<span class="op">,</span>el <span class="kw">in</span> <span class="fu">pairs</span><span class="op">(</span>doc<span class="op">.</span>blocks<span class="op">)</span> <span class="cf">do</span></a>
<a class="sourceLine" id="cb14-8" title="8">        <span class="cf">if</span> <span class="op">(</span>el<span class="op">.</span>t <span class="op">==</span> <span class="st">&quot;Div&quot;</span> <span class="kw">and</span> el<span class="op">.</span>classes<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">==</span> <span class="st">&quot;handout&quot;</span><span class="op">)</span> <span class="kw">or</span></a>
<a class="sourceLine" id="cb14-9" title="9">           <span class="op">(</span>el<span class="op">.</span>t <span class="op">==</span> <span class="st">&quot;BlockQuote&quot;</span><span class="op">)</span> <span class="kw">or</span></a>
<a class="sourceLine" id="cb14-10" title="10">           <span class="op">(</span>el<span class="op">.</span>t <span class="op">==</span> <span class="st">&quot;OrderedList&quot;</span> <span class="kw">and</span> el<span class="op">.</span>style <span class="op">==</span> <span class="st">&quot;Example&quot;</span><span class="op">)</span> <span class="kw">or</span></a>
<a class="sourceLine" id="cb14-11" title="11">           <span class="op">(</span>el<span class="op">.</span>t <span class="op">==</span> <span class="st">&quot;Para&quot;</span> <span class="kw">and</span> <span class="op">#</span>el<span class="op">.</span>c <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> el<span class="op">.</span>c<span class="op">[</span><span class="dv">1</span><span class="op">].</span>t <span class="op">==</span> <span class="st">&quot;Image&quot;</span><span class="op">)</span> <span class="kw">or</span></a>
<a class="sourceLine" id="cb14-12" title="12">           <span class="op">(</span>el<span class="op">.</span>t <span class="op">==</span> <span class="st">&quot;Header&quot;</span><span class="op">)</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb14-13" title="13">           <span class="fu">table.insert</span><span class="op">(</span>hblocks<span class="op">,</span> el<span class="op">)</span></a>
<a class="sourceLine" id="cb14-14" title="14">        <span class="cf">end</span></a>
<a class="sourceLine" id="cb14-15" title="15">    <span class="cf">end</span></a>
<a class="sourceLine" id="cb14-16" title="16">    <span class="cf">return</span> pandoc<span class="op">.</span>Pandoc<span class="op">(</span>hblocks<span class="op">,</span> doc<span class="op">.</span>meta<span class="op">)</span></a>
<a class="sourceLine" id="cb14-17" title="17"><span class="cf">end</span></a></code></pre></div>
<h2 id="counting-words-in-a-document">Counting words in a document</h2>
<p>This filter counts the words in the body of a document (omitting metadata like titles and abstracts), including words in code. It should be more accurate than <code>wc -w</code> run directly on a Markdown document, since the latter will count markup characters, like the <code>#</code> in front of an ATX header, or tags in HTML documents, as words. To run it, <code>pandoc --lua-filter wordcount.lua myfile.md</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb15-1" title="1"><span class="co">-- counts words in a document</span></a>
<a class="sourceLine" id="cb15-2" title="2"></a>
<a class="sourceLine" id="cb15-3" title="3">words <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb15-4" title="4"></a>
<a class="sourceLine" id="cb15-5" title="5">wordcount <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb15-6" title="6">  Str <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>el<span class="op">)</span></a>
<a class="sourceLine" id="cb15-7" title="7">    <span class="co">-- we don&#39;t count a word if it&#39;s entirely punctuation:</span></a>
<a class="sourceLine" id="cb15-8" title="8">    <span class="cf">if</span> el<span class="op">.</span>text<span class="op">:</span><span class="fu">match</span><span class="op">(</span><span class="st">&quot;%P&quot;</span><span class="op">)</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb15-9" title="9">        words <span class="op">=</span> words <span class="op">+</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb15-10" title="10">    <span class="cf">end</span></a>
<a class="sourceLine" id="cb15-11" title="11">  <span class="cf">end</span><span class="op">,</span></a>
<a class="sourceLine" id="cb15-12" title="12"></a>
<a class="sourceLine" id="cb15-13" title="13">  Code <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>el<span class="op">)</span></a>
<a class="sourceLine" id="cb15-14" title="14">    <span class="cn">_</span><span class="op">,</span>n <span class="op">=</span> el<span class="op">.</span>text<span class="op">:</span><span class="fu">gsub</span><span class="op">(</span><span class="st">&quot;%S+&quot;</span><span class="op">,</span><span class="st">&quot;&quot;</span><span class="op">)</span></a>
<a class="sourceLine" id="cb15-15" title="15">    words <span class="op">=</span> words <span class="op">+</span> n</a>
<a class="sourceLine" id="cb15-16" title="16">  <span class="cf">end</span><span class="op">,</span></a>
<a class="sourceLine" id="cb15-17" title="17"></a>
<a class="sourceLine" id="cb15-18" title="18">  CodeBlock <span class="op">=</span> <span class="kw">function</span><span class="op">(</span>el<span class="op">)</span></a>
<a class="sourceLine" id="cb15-19" title="19">    <span class="cn">_</span><span class="op">,</span>n <span class="op">=</span> el<span class="op">.</span>text<span class="op">:</span><span class="fu">gsub</span><span class="op">(</span><span class="st">&quot;%S+&quot;</span><span class="op">,</span><span class="st">&quot;&quot;</span><span class="op">)</span></a>
<a class="sourceLine" id="cb15-20" title="20">    words <span class="op">=</span> words <span class="op">+</span> n</a>
<a class="sourceLine" id="cb15-21" title="21">  <span class="cf">end</span></a>
<a class="sourceLine" id="cb15-22" title="22"><span class="op">}</span></a>
<a class="sourceLine" id="cb15-23" title="23"></a>
<a class="sourceLine" id="cb15-24" title="24"><span class="kw">function</span> Pandoc<span class="op">(</span>el<span class="op">)</span></a>
<a class="sourceLine" id="cb15-25" title="25">    <span class="co">-- skip metadata, just count body:</span></a>
<a class="sourceLine" id="cb15-26" title="26">    pandoc<span class="op">.</span>walk_block<span class="op">(</span>pandoc<span class="op">.</span>Div<span class="op">(</span>el<span class="op">.</span>blocks<span class="op">),</span> wordcount<span class="op">)</span></a>
<a class="sourceLine" id="cb15-27" title="27">    <span class="fu">print</span><span class="op">(</span>words <span class="op">..</span> <span class="st">&quot; words in body&quot;</span><span class="op">)</span></a>
<a class="sourceLine" id="cb15-28" title="28">    <span class="fu">os.exit</span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></a>
<a class="sourceLine" id="cb15-29" title="29"><span class="cf">end</span></a></code></pre></div>
<h2 id="converting-abc-code-to-music-notation">Converting ABC code to music notation</h2>
<p>This filter replaces code blocks with class <code>abc</code> with images created by running their contents through <code>abcm2ps</code> and ImageMagick’s <code>convert</code>. (For more on ABC notation, see <a href="https://abcnotation.com" class="uri">https://abcnotation.com</a>.)</p>
<p>Images are added to the mediabag. For output to binary formats, pandoc will use images in the mediabag. For textual formats, use <code>--extract-media</code> to specify a directory where the files in the mediabag will be written, or (for HTML only) use <code>--self-contained</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb16-1" title="1"><span class="co">-- Pandoc filter to process code blocks with class &quot;abc&quot; containing</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="co">-- ABC notation into images.</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="co">--</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="co">-- * Assumes that abcm2ps and ImageMagick&#39;s convert are in the path.</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="co">-- * For textual output formats, use --extract-media=abc-images</span></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="co">-- * For HTML formats, you may alternatively use --self-contained</span></a>
<a class="sourceLine" id="cb16-7" title="7"></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="kw">local</span> filetypes <span class="op">=</span> <span class="op">{</span> html <span class="op">=</span> <span class="op">{</span><span class="st">&quot;png&quot;</span><span class="op">,</span> <span class="st">&quot;image/png&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb16-9" title="9">                  <span class="op">,</span> latex <span class="op">=</span> <span class="op">{</span><span class="st">&quot;pdf&quot;</span><span class="op">,</span> <span class="st">&quot;application/pdf&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb16-10" title="10">                  <span class="op">}</span></a>
<a class="sourceLine" id="cb16-11" title="11"><span class="kw">local</span> filetype <span class="op">=</span> filetypes<span class="op">[</span><span class="cn">FORMAT</span><span class="op">][</span><span class="dv">1</span><span class="op">]</span> <span class="kw">or</span> <span class="st">&quot;png&quot;</span></a>
<a class="sourceLine" id="cb16-12" title="12"><span class="kw">local</span> mimetype <span class="op">=</span> filetypes<span class="op">[</span><span class="cn">FORMAT</span><span class="op">][</span><span class="dv">2</span><span class="op">]</span> <span class="kw">or</span> <span class="st">&quot;image/png&quot;</span></a>
<a class="sourceLine" id="cb16-13" title="13"></a>
<a class="sourceLine" id="cb16-14" title="14"><span class="kw">local</span> <span class="kw">function</span> abc2eps<span class="op">(</span>abc<span class="op">,</span> filetype<span class="op">)</span></a>
<a class="sourceLine" id="cb16-15" title="15">    <span class="kw">local</span> eps <span class="op">=</span> pandoc<span class="op">.</span>pipe<span class="op">(</span><span class="st">&quot;abcm2ps&quot;</span><span class="op">,</span> <span class="op">{</span><span class="st">&quot;-q&quot;</span><span class="op">,</span> <span class="st">&quot;-O&quot;</span><span class="op">,</span> <span class="st">&quot;-&quot;</span><span class="op">,</span> <span class="st">&quot;-&quot;</span><span class="op">},</span> abc<span class="op">)</span></a>
<a class="sourceLine" id="cb16-16" title="16">    <span class="kw">local</span> final <span class="op">=</span> pandoc<span class="op">.</span>pipe<span class="op">(</span><span class="st">&quot;convert&quot;</span><span class="op">,</span> <span class="op">{</span><span class="st">&quot;-&quot;</span><span class="op">,</span> filetype <span class="op">..</span> <span class="st">&quot;:-&quot;</span><span class="op">},</span> eps<span class="op">)</span></a>
<a class="sourceLine" id="cb16-17" title="17">    <span class="cf">return</span> final</a>
<a class="sourceLine" id="cb16-18" title="18"><span class="cf">end</span></a>
<a class="sourceLine" id="cb16-19" title="19"></a>
<a class="sourceLine" id="cb16-20" title="20"><span class="kw">function</span> CodeBlock<span class="op">(</span>block<span class="op">)</span></a>
<a class="sourceLine" id="cb16-21" title="21">    <span class="cf">if</span> block<span class="op">.</span>classes<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">==</span> <span class="st">&quot;abc&quot;</span> <span class="cf">then</span></a>
<a class="sourceLine" id="cb16-22" title="22">        <span class="kw">local</span> img <span class="op">=</span> abc2eps<span class="op">(</span>block<span class="op">.</span>text<span class="op">,</span> filetype<span class="op">)</span></a>
<a class="sourceLine" id="cb16-23" title="23">        <span class="kw">local</span> fname <span class="op">=</span> pandoc<span class="op">.</span>sha1<span class="op">(</span>img<span class="op">)</span> <span class="op">..</span> <span class="st">&quot;.&quot;</span> <span class="op">..</span> filetype</a>
<a class="sourceLine" id="cb16-24" title="24">        pandoc<span class="op">.</span>mediabag<span class="op">.</span>insert<span class="op">(</span>fname<span class="op">,</span> mimetype<span class="op">,</span> img<span class="op">)</span></a>
<a class="sourceLine" id="cb16-25" title="25">        <span class="cf">return</span> pandoc<span class="op">.</span>Para<span class="op">{</span> pandoc<span class="op">.</span>Image<span class="op">({</span>pandoc<span class="op">.</span>Str<span class="op">(</span><span class="st">&quot;abc tune&quot;</span><span class="op">)},</span> fname<span class="op">)</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb16-26" title="26">    <span class="cf">end</span></a>
<a class="sourceLine" id="cb16-27" title="27"><span class="cf">end</span></a></code></pre></div>
<h2 id="building-images-with-tikz">Building images with Ti<em>k</em>Z</h2>
<p>This filter converts raw LaTeX Ti<em>k</em>Z environments into images. It works with both PDF and HTML output. The Ti<em>k</em>Z code is compiled to an image using <code>pdflatex</code>, and the image is converted from pdf to svg format using <a href="https://github.com/dawbarton/pdf2svg"><code>pdf2svg</code></a>, so both of these must be in the system path. Converted images are cached in the working directory and given filenames based on a hash of the source, so that they need not be regenerated each time the document is built. (A more sophisticated version of this might put these in a special cache directory.)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">local</span> system <span class="op">=</span> <span class="fu">require</span> <span class="st">&#39;pandoc.system&#39;</span></a>
<a class="sourceLine" id="cb17-2" title="2"></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="kw">local</span> tikz_doc_template <span class="op">=</span> <span class="vs">[[</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="vs">\documentclass{standalone}</span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="vs">\usepackage{xcolor}</span></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="vs">\usepackage{tikz}</span></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="vs">\begin{document}</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="vs">\nopagecolor</span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="vs">%s</span></a>
<a class="sourceLine" id="cb17-10" title="10"><span class="vs">\end{document}</span></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="vs">]]</span></a>
<a class="sourceLine" id="cb17-12" title="12"></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="vs">local function tikz2image(src, filetype, outfile)</span></a>
<a class="sourceLine" id="cb17-14" title="14"><span class="vs">  system.with_temporary_directory(&#39;tikz2image&#39;, function (tmpdir)</span></a>
<a class="sourceLine" id="cb17-15" title="15"><span class="vs">    system.with_working_directory(tmpdir, function()</span></a>
<a class="sourceLine" id="cb17-16" title="16"><span class="vs">      local f = io.open(&#39;tikz.tex&#39;, &#39;w&#39;)</span></a>
<a class="sourceLine" id="cb17-17" title="17"><span class="vs">      f:write(tikz_doc_template:format(src))</span></a>
<a class="sourceLine" id="cb17-18" title="18"><span class="vs">      f:close()</span></a>
<a class="sourceLine" id="cb17-19" title="19"><span class="vs">      os.execute(&#39;pdflatex tikz.tex&#39;)</span></a>
<a class="sourceLine" id="cb17-20" title="20"><span class="vs">      if filetype == &#39;pdf&#39; then</span></a>
<a class="sourceLine" id="cb17-21" title="21"><span class="vs">        os.rename(&#39;tikz.pdf&#39;, outfile)</span></a>
<a class="sourceLine" id="cb17-22" title="22"><span class="vs">      else</span></a>
<a class="sourceLine" id="cb17-23" title="23"><span class="vs">        os.execute(&#39;pdf2svg tikz.pdf &#39; .. outfile)</span></a>
<a class="sourceLine" id="cb17-24" title="24"><span class="vs">      end</span></a>
<a class="sourceLine" id="cb17-25" title="25"><span class="vs">    end)</span></a>
<a class="sourceLine" id="cb17-26" title="26"><span class="vs">  end)</span></a>
<a class="sourceLine" id="cb17-27" title="27"><span class="vs">end</span></a>
<a class="sourceLine" id="cb17-28" title="28"></a>
<a class="sourceLine" id="cb17-29" title="29"><span class="vs">extension_for = {</span></a>
<a class="sourceLine" id="cb17-30" title="30"><span class="vs">  html = &#39;svg&#39;,</span></a>
<a class="sourceLine" id="cb17-31" title="31"><span class="vs">  html4 = &#39;svg&#39;,</span></a>
<a class="sourceLine" id="cb17-32" title="32"><span class="vs">  html5 = &#39;svg&#39;,</span></a>
<a class="sourceLine" id="cb17-33" title="33"><span class="vs">  latex = &#39;pdf&#39;,</span></a>
<a class="sourceLine" id="cb17-34" title="34"><span class="vs">  beamer = &#39;pdf&#39; }</span></a>
<a class="sourceLine" id="cb17-35" title="35"></a>
<a class="sourceLine" id="cb17-36" title="36"><span class="vs">local function file_exists(name)</span></a>
<a class="sourceLine" id="cb17-37" title="37"><span class="vs">  local f = io.open(name, &#39;r&#39;)</span></a>
<a class="sourceLine" id="cb17-38" title="38"><span class="vs">  if f ~= nil then</span></a>
<a class="sourceLine" id="cb17-39" title="39"><span class="vs">    io.close(f)</span></a>
<a class="sourceLine" id="cb17-40" title="40"><span class="vs">    return true</span></a>
<a class="sourceLine" id="cb17-41" title="41"><span class="vs">  else</span></a>
<a class="sourceLine" id="cb17-42" title="42"><span class="vs">    return false</span></a>
<a class="sourceLine" id="cb17-43" title="43"><span class="vs">  end</span></a>
<a class="sourceLine" id="cb17-44" title="44"><span class="vs">end</span></a>
<a class="sourceLine" id="cb17-45" title="45"></a>
<a class="sourceLine" id="cb17-46" title="46"><span class="vs">local function starts_with(start, str)</span></a>
<a class="sourceLine" id="cb17-47" title="47"><span class="vs">  return str:sub(1, #start) == start</span></a>
<a class="sourceLine" id="cb17-48" title="48"><span class="vs">end</span></a>
<a class="sourceLine" id="cb17-49" title="49"></a>
<a class="sourceLine" id="cb17-50" title="50"></a>
<a class="sourceLine" id="cb17-51" title="51"><span class="vs">function RawBlock(el)</span></a>
<a class="sourceLine" id="cb17-52" title="52"><span class="vs">  if starts_with(&#39;\\begin{tikzpicture}&#39;, el.text) then</span></a>
<a class="sourceLine" id="cb17-53" title="53"><span class="vs">    local filetype = extension_for[FORMAT] or &#39;svg&#39;</span></a>
<a class="sourceLine" id="cb17-54" title="54"><span class="vs">    local fbasename = pandoc.sha1(el.text) .. &#39;.&#39; .. filetype</span></a>
<a class="sourceLine" id="cb17-55" title="55"><span class="vs">    local fname = system.get_working_directory() .. &#39;/&#39; .. fbasename</span></a>
<a class="sourceLine" id="cb17-56" title="56"><span class="vs">    if not file_exists(fname) then</span></a>
<a class="sourceLine" id="cb17-57" title="57"><span class="vs">      tikz2image(el.text, filetype, fname)</span></a>
<a class="sourceLine" id="cb17-58" title="58"><span class="vs">    end</span></a>
<a class="sourceLine" id="cb17-59" title="59"><span class="vs">    return pandoc.Para({pandoc.Image({}, fbasename)})</span></a>
<a class="sourceLine" id="cb17-60" title="60"><span class="vs">  else</span></a>
<a class="sourceLine" id="cb17-61" title="61"><span class="vs">   return el</span></a>
<a class="sourceLine" id="cb17-62" title="62"><span class="vs">  end</span></a>
<a class="sourceLine" id="cb17-63" title="63"><span class="vs">end</span></a></code></pre></div>
<p>Example of use:</p>
<pre><code>pandoc --lua-filter tikz.lua -s -o cycle.html &lt;&lt;EOF
Here is a diagram of the cycle:

\begin{tikzpicture}

\def \n {5}
\def \radius {3cm}
\def \margin {8} % margin in angles, depends on the radius

\foreach \s in {1,...,\n}
{
  \node[draw, circle] at ({360/\n * (\s - 1)}:\radius) {$\s$};
  \draw[-&gt;, &gt;=latex] ({360/\n * (\s - 1)+\margin}:\radius)
    arc ({360/\n * (\s - 1)+\margin}:{360/\n * (\s)-\margin}:\radius);
}
\end{tikzpicture}
EOF</code></pre>
<h1 id="lua-type-reference">Lua type reference</h1>
<p>This section describes the types of objects available to Lua filters. See the <a href="#module-pandoc">pandoc module</a> for functions to create these objects.</p>
<h2 id="shared-properties">Shared Properties</h2>
<h3 id="clone"><code>clone</code></h3>
<p><code>clone ()</code></p>
<p>All instances of the types listed here, with the exception of read-only objects, can be cloned via the <code>clone()</code> method.</p>
<p>Usage:</p>
<pre><code>local emph = pandoc.Emph {pandoc.Str &#39;important&#39;}
local cloned_emph = emph:clone()  -- note the colon</code></pre>
<h2 id="type-pandoc">Pandoc</h2>
<p>Pandoc document</p>
<p>Values of this type can be created with the <a href="#pandoc.pandoc"><code>pandoc.Pandoc</code></a> constructor. Object equality is determined via <a href="#pandoc.utils.equals"><code>pandoc.utils.equals</code></a>.</p>
<dl>
<dt><code>blocks</code></dt>
<dd>document content (<a href="#type-list">List</a> of <a href="#type-block">Blocks</a>)
</dd>
<dt><code>meta</code></dt>
<dd>document meta information (<a href="#type-meta">Meta</a> object)
</dd>
</dl>
<h2 id="type-meta">Meta</h2>
<p>Meta information on a document; string-indexed collection of <a href="#type-metavalue">MetaValues</a>.</p>
<p>Values of this type can be created with the <a href="#pandoc.meta"><code>pandoc.Meta</code></a> constructor. Object equality is determined via <a href="#pandoc.utils.equals"><code>pandoc.utils.equals</code></a>.</p>
<h2 id="type-metavalue">MetaValue</h2>
<p>Document meta information items.</p>
<p>Object equality is determined via <a href="#pandoc.utils.equals"><code>pandoc.utils.equals</code></a>.</p>
<h3 id="type-metablocks">MetaBlocks</h3>
<p>A list of blocks usable as meta value (<a href="#type-list">List</a> of <a href="#type-block">Blocks</a>).</p>
<p>Fields:</p>
<dl>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>MetaBlocks</code> (string)
</dd>
</dl>
<h3 id="type-metabool">MetaBool</h3>
<p>Alias for Lua boolean, i.e. the values <code>true</code> and <code>false</code>.</p>
<h3 id="type-metainlines">MetaInlines</h3>
<p>List of inlines used in metadata (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)</p>
<p>Values of this type can be created with the <a href="#pandoc.metainlines"><code>pandoc.MetaInlines</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>MetaInlines</code> (string)
</dd>
</dl>
<h3 id="type-metalist">MetaList</h3>
<p>A list of other metadata values (<a href="#type-list">List</a> of <a href="#type-metavalue">MetaValues</a>).</p>
<p>Values of this type can be created with the <a href="#pandoc.metalist"><code>pandoc.MetaList</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>MetaList</code> (string)
</dd>
</dl>
<p>All methods available for <a href="#type-list">List</a>s can be used on this type as well.</p>
<h3 id="type-metamap">MetaMap</h3>
<p>A string-indexed map of meta-values. (table).</p>
<p>Values of this type can be created with the <a href="#pandoc.metamap"><code>pandoc.MetaMap</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>MetaMap</code> (string)
</dd>
</dl>
<p><em>Note</em>: The fields will be shadowed if the map contains a field with the same name as those listed.</p>
<h3 id="type-metastring">MetaString</h3>
<p>Plain Lua string value (string).</p>
<h2 id="type-block">Block</h2>
<p>Object equality is determined via <a href="#pandoc.utils.equals"><code>pandoc.utils.equals</code></a>.</p>
<h3 id="type-blockquote">BlockQuote</h3>
<p>A block quote element.</p>
<p>Values of this type can be created with the <a href="#pandoc.blockquote"><code>pandoc.BlockQuote</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>block content (<a href="#type-list">List</a> of <a href="#type-block">Blocks</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>BlockQuote</code> (string)
</dd>
</dl>
<h3 id="type-bulletlist">BulletList</h3>
<p>A bullet list.</p>
<p>Values of this type can be created with the <a href="#pandoc.bulletlist"><code>pandoc.BulletList</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>list items (<a href="#type-list">List</a> of <a href="#type-list">List</a> of <a href="#type-block">Blocks</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>BulletList</code> (string)
</dd>
</dl>
<h3 id="type-codeblock">CodeBlock</h3>
<p>Block of code.</p>
<p>Values of this type can be created with the <a href="#pandoc.codeblock"><code>pandoc.CodeBlock</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>text</code></dt>
<dd>code string (string)
</dd>
<dt><code>attr</code></dt>
<dd>element attributes (<a href="#type-attr">Attr</a>)
</dd>
<dt><code>identifier</code></dt>
<dd>alias for <code>attr.identifier</code> (string)
</dd>
<dt><code>classes</code></dt>
<dd>alias for <code>attr.classes</code> (<a href="#type-list">List</a> of strings)
</dd>
<dt><code>attributes</code></dt>
<dd>alias for <code>attr.attributes</code> (<a href="#type-attributes">Attributes</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>CodeBlock</code> (string)
</dd>
</dl>
<h3 id="type-definitionlist">DefinitionList</h3>
<p>Definition list, containing terms and their explanation.</p>
<p>Values of this type can be created with the <a href="#pandoc.definitionlist"><code>pandoc.DefinitionList</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>list of items
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>DefinitionList</code> (string)
</dd>
</dl>
<h3 id="type-div">Div</h3>
<p>Generic block container with attributes.</p>
<p>Values of this type can be created with the <a href="#pandoc.div"><code>pandoc.Div</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>block content (<a href="#type-list">List</a> of <a href="#type-block">Blocks</a>)
</dd>
<dt><code>attr</code></dt>
<dd>element attributes (<a href="#type-attr">Attr</a>)
</dd>
<dt><code>identifier</code></dt>
<dd>alias for <code>attr.identifier</code> (string)
</dd>
<dt><code>classes</code></dt>
<dd>alias for <code>attr.classes</code> (<a href="#type-list">List</a> of strings)
</dd>
<dt><code>attributes</code></dt>
<dd>alias for <code>attr.attributes</code> (<a href="#type-attributes">Attributes</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Div</code> (string)
</dd>
</dl>
<h3 id="type-header">Header</h3>
<p>Creates a header element.</p>
<p>Values of this type can be created with the <a href="#pandoc.header"><code>pandoc.Header</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>level</code></dt>
<dd>header level (integer)
</dd>
<dt><code>content</code></dt>
<dd>inline content (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>attr</code></dt>
<dd>element attributes (<a href="#type-attr">Attr</a>)
</dd>
<dt><code>identifier</code></dt>
<dd>alias for <code>attr.identifier</code> (string)
</dd>
<dt><code>classes</code></dt>
<dd>alias for <code>attr.classes</code> (<a href="#type-list">List</a> of strings)
</dd>
<dt><code>attributes</code></dt>
<dd>alias for <code>attr.attributes</code> (<a href="#type-attributes">Attributes</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Header</code> (string)
</dd>
</dl>
<h3 id="type-horizontalrule">HorizontalRule</h3>
<p>A horizontal rule.</p>
<p>Values of this type can be created with the <a href="#pandoc.horizontalrule"><code>pandoc.HorizontalRule</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>HorizontalRule</code> (string)
</dd>
</dl>
<h3 id="type-lineblock">LineBlock</h3>
<p>A line block, i.e. a list of lines, each separated from the next by a newline.</p>
<p>Values of this type can be created with the <a href="#pandoc.lineblock"><code>pandoc.LineBlock</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>inline content
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>LineBlock</code> (string)
</dd>
</dl>
<h3 id="type-null">Null</h3>
<p>A null element; this element never produces any output in the target format.</p>
<p>Values of this type can be created with the <a href="#pandoc.null"><code>pandoc.Null</code></a> constructor.</p>
<dl>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Null</code> (string)
</dd>
</dl>
<h3 id="type-orderedlist">OrderedList</h3>
<p>An ordered list.</p>
<p>Values of this type can be created with the <a href="#pandoc.orderedlist"><code>pandoc.OrderedList</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>list items (<a href="#type-list">List</a> of <a href="#type-list">List</a> of <a href="#type-block">Blocks</a>)
</dd>
<dt><code>listAttributes</code></dt>
<dd>list parameters (<a href="#type-listattributes">ListAttributes</a>)
</dd>
<dt><code>start</code></dt>
<dd>alias for <code>listAttributes.start</code> (integer)
</dd>
<dt><code>style</code></dt>
<dd>alias for <code>listAttributes.style</code> (string)
</dd>
<dt><code>delimiter</code></dt>
<dd>alias for <code>listAttributes.delimiter</code> (string)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>OrderedList</code> (string)
</dd>
</dl>
<h3 id="type-para">Para</h3>
<p>A paragraph.</p>
<p>Values of this type can be created with the <a href="#pandoc.para"><code>pandoc.Para</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>inline content (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Para</code> (string)
</dd>
</dl>
<h3 id="type-plain">Plain</h3>
<p>Plain text, not a paragraph.</p>
<p>Values of this type can be created with the <a href="#pandoc.plain"><code>pandoc.Plain</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>inline content (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Plain</code> (string)
</dd>
</dl>
<h3 id="type-rawblock">RawBlock</h3>
<p>Raw content of a specified format.</p>
<p>Values of this type can be created with the <a href="#pandoc.rawblock"><code>pandoc.RawBlock</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>format</code></dt>
<dd>format of content (string)
</dd>
<dt><code>text</code></dt>
<dd>raw content (string)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>RawBlock</code> (string)
</dd>
</dl>
<h3 id="type-table">Table</h3>
<p>A table.</p>
<p>Values of this type can be created with the <a href="#pandoc.table"><code>pandoc.Table</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>attr</code></dt>
<dd>table attributes (<a href="#type-attr">Attr</a>)
</dd>
<dt><code>caption</code></dt>
<dd>table caption (<a href="#type-caption">Caption</a>)
</dd>
<dt><code>colspecs</code></dt>
<dd>column specifications, i.e., alignments and widths (<a href="#type-list">List</a> of <a href="#type-colspec">ColSpec</a>s)
</dd>
<dt><code>head</code></dt>
<dd>table head (<a href="#type-tablehead">TableHead</a>)
</dd>
<dt><code>bodies</code></dt>
<dd>table bodies (<a href="#type-list">List</a> of <a href="#type-tablebody">TableBody</a>s)
</dd>
<dt><code>foot</code></dt>
<dd>table foot (<a href="#type-tablefoot">TableFoot</a>)
</dd>
<dt><code>identifier</code></dt>
<dd>alias for <code>attr.identifier</code> (string)
</dd>
<dt><code>classes</code></dt>
<dd>alias for <code>attr.classes</code> (<a href="#type-list">List</a> of strings)
</dd>
<dt><code>attributes</code></dt>
<dd>alias for <code>attr.attributes</code> (<a href="#type-attributes">Attributes</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Table</code> (string)
</dd>
</dl>
<p>A <span id="type-table-cell">table cell</span> is a list of blocks.</p>
<p><em><span id="type-alignment">Alignment</span></em> is a string value indicating the horizontal alignment of a table column. <code>AlignLeft</code>, <code>AlignRight</code>, and <code>AlignCenter</code> leads cell content to be left-aligned, right-aligned, and centered, respectively. The default alignment is <code>AlignDefault</code> (often equivalent to centered).</p>
<h2 id="type-inline">Inline</h2>
<p>Object equality is determined via <a href="#pandoc.utils.equals"><code>pandoc.utils.equals</code></a>.</p>
<h3 id="type-cite">Cite</h3>
<p>Citation.</p>
<p>Values of this type can be created with the <a href="#pandoc.cite"><code>pandoc.Cite</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>(<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>citations</code></dt>
<dd>citation entries (<a href="#type-list">List</a> of <a href="#type-citation">Citations</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Cite</code> (string)
</dd>
</dl>
<h3 id="type-code">Code</h3>
<p>Inline code</p>
<p>Values of this type can be created with the <a href="#pandoc.code"><code>pandoc.Code</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>text</code></dt>
<dd>code string (string)
</dd>
<dt><code>attr</code></dt>
<dd>attributes (<a href="#type-attr">Attr</a>)
</dd>
<dt><code>identifier</code></dt>
<dd>alias for <code>attr.identifier</code> (string)
</dd>
<dt><code>classes</code></dt>
<dd>alias for <code>attr.classes</code> (<a href="#type-list">List</a> of strings)
</dd>
<dt><code>attributes</code></dt>
<dd>alias for <code>attr.attributes</code> (<a href="#type-attributes">Attributes</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Code</code> (string)
</dd>
</dl>
<h3 id="type-emph">Emph</h3>
<p>Emphasized text</p>
<p>Values of this type can be created with the <a href="#pandoc.emph"><code>pandoc.Emph</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>inline content (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Emph</code> (string)
</dd>
</dl>
<h3 id="type-image">Image</h3>
<p>Image: alt text (list of inlines), target</p>
<p>Values of this type can be created with the <a href="#pandoc.image"><code>pandoc.Image</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>caption</code></dt>
<dd>text used to describe the image (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>src</code></dt>
<dd>path to the image file (string)
</dd>
<dt><code>title</code></dt>
<dd>brief image description (string)
</dd>
<dt><code>attr</code></dt>
<dd>attributes (<a href="#type-attr">Attr</a>)
</dd>
<dt><code>identifier</code></dt>
<dd>alias for <code>attr.identifier</code> (string)
</dd>
<dt><code>classes</code></dt>
<dd>alias for <code>attr.classes</code> (<a href="#type-list">List</a> of strings)
</dd>
<dt><code>attributes</code></dt>
<dd>alias for <code>attr.attributes</code> (<a href="#type-attributes">Attributes</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Image</code> (string)
</dd>
</dl>
<h3 id="type-linebreak">LineBreak</h3>
<p>Hard line break</p>
<p>Values of this type can be created with the <a href="#pandoc.linebreak"><code>pandoc.LineBreak</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>LineBreak</code> (string)
</dd>
</dl>
<h3 id="type-link">Link</h3>
<p>Hyperlink: alt text (list of inlines), target</p>
<p>Values of this type can be created with the <a href="#pandoc.link"><code>pandoc.Link</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>attr</code></dt>
<dd>attributes (<a href="#type-attr">Attr</a>)
</dd>
<dt><code>content</code></dt>
<dd>text for this link (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>target</code></dt>
<dd>the link target (string)
</dd>
<dt><code>title</code></dt>
<dd>brief link description
</dd>
<dt><code>identifier</code></dt>
<dd>alias for <code>attr.identifier</code> (string)
</dd>
<dt><code>classes</code></dt>
<dd>alias for <code>attr.classes</code> (<a href="#type-list">List</a> of strings)
</dd>
<dt><code>attributes</code></dt>
<dd>alias for <code>attr.attributes</code> (<a href="#type-attributes">Attributes</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Link</code> (string)
</dd>
</dl>
<h3 id="type-math">Math</h3>
<p>TeX math (literal)</p>
<p>Values of this type can be created with the <a href="#pandoc.math"><code>pandoc.Math</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>mathtype</code></dt>
<dd>specifier determining whether the math content should be shown inline (<code>InlineMath</code>) or on a separate line (<code>DisplayMath</code>) (string)
</dd>
<dt><code>text</code></dt>
<dd>math content (string)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Math</code> (string)
</dd>
</dl>
<h3 id="type-note">Note</h3>
<p>Footnote or endnote</p>
<p>Values of this type can be created with the <a href="#pandoc.note"><code>pandoc.Note</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>(<a href="#type-list">List</a> of <a href="#type-block">Blocks</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Note</code> (string)
</dd>
</dl>
<h3 id="type-quoted">Quoted</h3>
<p>Quoted text</p>
<p>Values of this type can be created with the <a href="#pandoc.quoted"><code>pandoc.Quoted</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>quotetype</code></dt>
<dd>type of quotes to be used; one of <code>SingleQuote</code> or <code>DoubleQuote</code> (string)
</dd>
<dt><code>content</code></dt>
<dd>quoted text (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Quoted</code> (string)
</dd>
</dl>
<h3 id="type-rawinline">RawInline</h3>
<p>Raw inline</p>
<p>Values of this type can be created with the <a href="#pandoc.rawinline"><code>pandoc.RawInline</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>format</code></dt>
<dd>the format of the content (string)
</dd>
<dt><code>text</code></dt>
<dd>raw content (string)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>RawInline</code> (string)
</dd>
</dl>
<h3 id="type-smallcaps">SmallCaps</h3>
<p>Small caps text</p>
<p>Values of this type can be created with the <a href="#pandoc.smallcaps"><code>pandoc.SmallCaps</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>(<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>SmallCaps</code> (string)
</dd>
</dl>
<h3 id="type-softbreak">SoftBreak</h3>
<p>Soft line break</p>
<p>Values of this type can be created with the <a href="#pandoc.softbreak"><code>pandoc.SoftBreak</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>SoftBreak</code> (string)
</dd>
</dl>
<h3 id="type-space">Space</h3>
<p>Inter-word space</p>
<p>Values of this type can be created with the <a href="#pandoc.space"><code>pandoc.Space</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Space</code> (string)
</dd>
</dl>
<h3 id="type-span">Span</h3>
<p>Generic inline container with attributes</p>
<p>Values of this type can be created with the <a href="#pandoc.span"><code>pandoc.Span</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>attr</code></dt>
<dd>attributes (<a href="#type-attr">Attr</a>)
</dd>
<dt><code>content</code></dt>
<dd>wrapped content (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>identifier</code></dt>
<dd>alias for <code>attr.identifier</code> (string)
</dd>
<dt><code>classes</code></dt>
<dd>alias for <code>attr.classes</code> (<a href="#type-list">List</a> of strings)
</dd>
<dt><code>attributes</code></dt>
<dd>alias for <code>attr.attributes</code> (<a href="#type-attributes">Attributes</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Span</code> (string)
</dd>
</dl>
<h3 id="type-str">Str</h3>
<p>Text</p>
<p>Values of this type can be created with the <a href="#pandoc.str"><code>pandoc.Str</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>text</code></dt>
<dd>content (string)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Str</code> (string)
</dd>
</dl>
<h3 id="type-strikeout">Strikeout</h3>
<p>Strikeout text</p>
<p>Values of this type can be created with the <a href="#pandoc.strikeout"><code>pandoc.Strikeout</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>inline content (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Strikeout</code> (string)
</dd>
</dl>
<h3 id="type-strong">Strong</h3>
<p>Strongly emphasized text</p>
<p>Values of this type can be created with the <a href="#pandoc.strong"><code>pandoc.Strong</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>inline content (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Strong</code> (string)
</dd>
</dl>
<h3 id="type-subscript">Subscript</h3>
<p>Subscripted text</p>
<p>Values of this type can be created with the <a href="#pandoc.subscript"><code>pandoc.Subscript</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>inline content (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Subscript</code> (string)
</dd>
</dl>
<h3 id="type-superscript">Superscript</h3>
<p>Superscripted text</p>
<p>Values of this type can be created with the <a href="#pandoc.superscript"><code>pandoc.Superscript</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>inline content (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Superscript</code> (string)
</dd>
</dl>
<h3 id="type-underline">Underline</h3>
<p>Underlined text</p>
<p>Values of this type can be created with the <a href="#pandoc.underline"><code>pandoc.Underline</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>content</code></dt>
<dd>inline content (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>tag</code>, <code>t</code></dt>
<dd>the literal <code>Underline</code> (string)
</dd>
</dl>
<h2 id="element-components">Element components</h2>
<h3 id="type-attr">Attr</h3>
<p>A set of element attributes. Values of this type can be created with the <a href="#pandoc.attr"><code>pandoc.Attr</code></a> constructor. For convenience, it is usually not necessary to construct the value directly if it is part of an element, and it is sufficient to pass an HTML-like table. E.g., to create a span with identifier “text” and classes “a” and “b”, one can write:</p>
<pre><code>local span = pandoc.Span(&#39;text&#39;, {id = &#39;text&#39;, class = &#39;a b&#39;})</code></pre>
<p>This also works when using the <code>attr</code> setter:</p>
<pre><code>local span = pandoc.Span &#39;text&#39;
span.attr = {id = &#39;text&#39;, class = &#39;a b&#39;, other_attribute = &#39;1&#39;}</code></pre>
<p>Object equality is determined via <a href="#pandoc.utils.equals"><code>pandoc.utils.equals</code></a>.</p>
<p>Fields:</p>
<dl>
<dt><code>identifier</code></dt>
<dd>element identifier (string)
</dd>
<dt><code>classes</code></dt>
<dd>element classes (<a href="#type-list">List</a> of strings)
</dd>
<dt><code>attributes</code></dt>
<dd>collection of key/value pairs (<a href="#type-attributes">Attributes</a>)
</dd>
</dl>
<h3 id="type-attributes">Attributes</h3>
<p>List of key/value pairs. Values can be accessed by using keys as indices to the list table.</p>
<h3 id="type-caption">Caption</h3>
<p>The caption of a table, with an optional short caption.</p>
<p>Fields:</p>
<dl>
<dt><code>long</code></dt>
<dd>long caption (list of <a href="#type-block">Blocks</a>)
</dd>
<dt><code>short</code></dt>
<dd>short caption (list of <a href="#type-inline">Inlines</a>)
</dd>
</dl>
<h3 id="type-cell">Cell</h3>
<p>A table cell.</p>
<p>Fields:</p>
<dl>
<dt><code>attr</code></dt>
<dd>cell attributes
</dd>
<dt><code>alignment</code></dt>
<dd>individual cell alignment (<a href="#type-alignment">Alignment</a>).
</dd>
<dt><code>contents</code></dt>
<dd>cell contents (list of <a href="#type-block">Blocks</a>).
</dd>
<dt><code>col_span</code></dt>
<dd>number of columns occupied by the cell; the height of the cell (integer).
</dd>
<dt><code>row_span</code></dt>
<dd>number of rows occupied by the cell; the height of the cell (integer).
</dd>
</dl>
<h3 id="type-citation">Citation</h3>
<p>Single citation entry</p>
<p>Values of this type can be created with the <a href="#pandoc.citation"><code>pandoc.Citation</code></a> constructor.</p>
<p>Object equality is determined via <a href="#pandoc.utils.equals"><code>pandoc.utils.equals</code></a>.</p>
<p>Fields:</p>
<dl>
<dt><code>id</code></dt>
<dd>citation identifier, e.g., a bibtex key (string)
</dd>
<dt><code>mode</code></dt>
<dd>citation mode, one of <code>AuthorInText</code>, <code>SuppressAuthor</code>, or <code>NormalCitation</code> (string)
</dd>
<dt><code>prefix</code></dt>
<dd>citation prefix (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>suffix</code></dt>
<dd>citation suffix (<a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>)
</dd>
<dt><code>note_num</code></dt>
<dd>note number (integer)
</dd>
<dt><code>hash</code></dt>
<dd>hash (integer)
</dd>
</dl>
<h3 id="type-colspec">ColSpec</h3>
<p>Column alignment and width specification for a single table column.</p>
<p>This is a pair with the following components:</p>
<ol type="1">
<li>cell alignment (<a href="#type-alignment">Alignment</a>).</li>
<li>table column width, as a fraction of the total table width (number).</li>
</ol>
<h3 id="type-listattributes">ListAttributes</h3>
<p>List attributes</p>
<p>Values of this type can be created with the <a href="#pandoc.listattributes"><code>pandoc.ListAttributes</code></a> constructor.</p>
<p>Object equality is determined via <a href="#pandoc.utils.equals"><code>pandoc.utils.equals</code></a>.</p>
<p>Fields:</p>
<dl>
<dt><code>start</code></dt>
<dd>number of the first list item (integer)
</dd>
<dt><code>style</code></dt>
<dd>style used for list numbers; possible values are <code>DefaultStyle</code>, <code>Example</code>, <code>Decimal</code>, <code>LowerRoman</code>, <code>UpperRoman</code>, <code>LowerAlpha</code>, and <code>UpperAlpha</code> (string)
</dd>
<dt><code>delimiter</code></dt>
<dd>delimiter of list numbers; one of <code>DefaultDelim</code>, <code>Period</code>, <code>OneParen</code>, and <code>TwoParens</code> (string)
</dd>
</dl>
<h3 id="type-row">Row</h3>
<p>A table row.</p>
<p>Tuple fields:</p>
<ol type="1">
<li>row attributes</li>
<li>row cells (list of <a href="#type-cell">Cells</a>)</li>
</ol>
<h3 id="type-tablebody">TableBody</h3>
<p>A body of a table, with an intermediate head and the specified number of row header columns.</p>
<p>Fields:</p>
<dl>
<dt><code>attr</code></dt>
<dd>table body attributes (<a href="#type-attr">Attr</a>)
</dd>
<dt><code>body</code></dt>
<dd>table body rows (list of <a href="#type-row">Rows</a>)
</dd>
<dt><code>head</code></dt>
<dd>intermediate head (list of <a href="#type-row">Rows</a>)
</dd>
<dt><code>row_head_columns</code></dt>
<dd>number of columns taken up by the row head of each row of a <a href="#type-tablebody">TableBody</a>. The row body takes up the remaining columns.
</dd>
</dl>
<h3 id="type-tablefoot">TableFoot</h3>
<p>The foot of a table.</p>
<p>This is a pair with the following components:</p>
<ol type="1">
<li>attributes</li>
<li>foot rows (<a href="#type-row">Rows</a>)</li>
</ol>
<h3 id="type-tablehead">TableHead</h3>
<p>The head of a table.</p>
<p>This is a pair with the following components:</p>
<ol type="1">
<li>attributes</li>
<li>head rows (<a href="#type-row">Rows</a>)</li>
</ol>
<h2 id="type-readeroptions">ReaderOptions</h2>
<p>Pandoc reader options</p>
<p>Fields:</p>
<dl>
<dt><code>abbreviations</code></dt>
<dd>set of known abbreviations (set of strings)
</dd>
<dt><code>columns</code></dt>
<dd>number of columns in terminal (integer)
</dd>
<dt><code>default_image_extension</code></dt>
<dd>default extension for images (string)
</dd>
<dt><code>extensions</code></dt>
<dd>string representation of the syntax extensions bit field (string)
</dd>
<dt><code>indented_code_classes</code></dt>
<dd>default classes for indented code blocks (list of strings)
</dd>
<dt><code>standalone</code></dt>
<dd>whether the input was a standalone document with header (boolean)
</dd>
<dt><code>strip_comments</code></dt>
<dd>HTML comments are stripped instead of parsed as raw HTML (boolean)
</dd>
<dt><code>tab_stop</code></dt>
<dd>width (i.e. equivalent number of spaces) of tab stops (integer)
</dd>
<dt><code>track_changes</code></dt>
<dd>track changes setting for docx; one of <code>AcceptChanges</code>, <code>RejectChanges</code>, and <code>AllChanges</code> (string)
</dd>
</dl>
<h2 id="type-commonstate">CommonState</h2>
<p>The state used by pandoc to collect information and make it available to readers and writers.</p>
<p>Fields:</p>
<dl>
<dt><code>input_files</code></dt>
<dd>List of input files from command line (<a href="#type-list">List</a> of strings)
</dd>
<dt><code>output_file</code></dt>
<dd>Output file from command line (string or nil)
</dd>
<dt><code>log</code></dt>
<dd>A list of log messages in reverse order (<a href="#type-list">List</a> of <a href="#type-logmessage">LogMessage</a>s)
</dd>
<dt><code>request_headers</code></dt>
<dd>Headers to add for HTTP requests; table with header names as keys and header contents as value (table)
</dd>
<dt><code>resource_path</code></dt>
<dd>Path to search for resources like included images (<a href="#type-list">List</a> of strings)
</dd>
<dt><code>source_url</code></dt>
<dd>Absolute URL or directory of first source file (string or nil)
</dd>
<dt><code>user_data_dir</code></dt>
<dd>Directory to search for data files (string or nil)
</dd>
<dt><code>trace</code></dt>
<dd>Whether tracing messages are issued (boolean)
</dd>
<dt><code>verbosity</code></dt>
<dd>Verbosity level; one of <code>INFO</code>, <code>WARNING</code>, <code>ERROR</code> (string)
</dd>
</dl>
<h2 id="type-list">List</h2>
<p>A list is any Lua table with integer indices. Indices start at one, so if <code>alist = {'value'}</code> then <code>alist[1] == 'value'</code>.</p>
<p>Lists, when part of an element, or when generated during marshaling, are made instances of the <code>pandoc.List</code> type for convenience. The <code>pandoc.List</code> type is defined in the <a href="#module-pandoc.list"><em>pandoc.List</em></a> module. See there for available methods.</p>
<p>Values of this type can be created with the <a href="#pandoc.list"><code>pandoc.List</code></a> constructor, turning a normal Lua table into a List.</p>
<h2 id="type-logmessage">LogMessage</h2>
<p>A pandoc log message. Objects have no fields, but can be converted to a string via <code>tostring</code>.</p>
<h2 id="type-simpletable">SimpleTable</h2>
<p>A simple table is a table structure which resembles the old (pre pandoc 2.10) Table type. Bi-directional conversion from and to <a href="#type-table">Tables</a> is possible with the <a href="#pandoc.utils.to_simple_table"><code>pandoc.utils.to_simple_table</code></a> and <a href="#pandoc.utils.from_simple_table"><code>pandoc.utils.from_simple_table</code></a> function, respectively. Instances of this type can also be created directly with the <a href="#pandoc.simpletable"><code>pandoc.SimpleTable</code></a> constructor.</p>
<p>Fields:</p>
<dl>
<dt><code>caption</code>:</dt>
<dd><a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>
</dd>
<dt><code>aligns</code>:</dt>
<dd>column alignments (<a href="#type-list">List</a> of <a href="#type-alignment">Alignments</a>)
</dd>
<dt><code>widths</code>:</dt>
<dd>column widths; a (<a href="#type-list">List</a> of numbers)
</dd>
<dt><code>headers</code>:</dt>
<dd>table header row (<a href="#type-list">List</a> of lists of <a href="#type-block">Blocks</a>)
</dd>
<dt><code>rows</code>:</dt>
<dd>table rows (<a href="#type-list">List</a> of rows, where a row is a list of lists of <a href="#type-block">Blocks</a>)
</dd>
</dl>
<h2 id="type-version">Version</h2>
<p>A version object. This represents a software version like “2.7.3”. The object behaves like a numerically indexed table, i.e., if <code>version</code> represents the version <code>2.7.3</code>, then</p>
<pre><code>version[1] == 2
version[2] == 7
version[3] == 3
#version == 3   -- length</code></pre>
<p>Comparisons are performed element-wise, i.e.</p>
<pre><code>Version &#39;1.12&#39; &gt; Version &#39;1.9&#39;</code></pre>
<p>Values of this type can be created with the <a href="#pandoc.types.version"><code>pandoc.types.Version</code></a> constructor.</p>
<h3 id="must_be_at_least"><code>must_be_at_least</code></h3>
<p><code>must_be_at_least(actual, expected [, error_message])</code></p>
<p>Raise an error message if the actual version is older than the expected version; does nothing if actual is equal to or newer than the expected version.</p>
<p>Parameters:</p>
<dl>
<dt><code>actual</code></dt>
<dd>actual version specifier (<a href="#type-version">Version</a>)
</dd>
<dt><code>expected</code></dt>
<dd>minimum expected version (<a href="#type-version">Version</a>)
</dd>
<dt><code>error_message</code></dt>
<dd>optional error message template. The string is used as format string, with the expected and actual versions as arguments. Defaults to <code>"expected version %s or newer, got %s"</code>.
</dd>
</dl>
<p>Usage:</p>
<pre><code>PANDOC_VERSION:must_be_at_least &#39;2.7.3&#39;
PANDOC_API_VERSION:must_be_at_least(
  &#39;1.17.4&#39;,
  &#39;pandoc-types is too old: expected version %s, got %s&#39;
)</code></pre>
<h1 id="module-text">Module text</h1>
<p>UTF-8 aware text manipulation functions, implemented in Haskell. The module is made available as part of the <code>pandoc</code> module via <code>pandoc.text</code>. The text module can also be loaded explicitly:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb25-1" title="1"><span class="co">-- uppercase all regular text in a document:</span></a>
<a class="sourceLine" id="cb25-2" title="2">text <span class="op">=</span> <span class="fu">require</span> <span class="st">&#39;text&#39;</span></a>
<a class="sourceLine" id="cb25-3" title="3"><span class="kw">function</span> Str <span class="op">(</span>s<span class="op">)</span></a>
<a class="sourceLine" id="cb25-4" title="4">  s<span class="op">.</span>text <span class="op">=</span> text<span class="op">.</span>upper<span class="op">(</span>s<span class="op">.</span>text<span class="op">)</span></a>
<a class="sourceLine" id="cb25-5" title="5">  <span class="cf">return</span> s</a>
<a class="sourceLine" id="cb25-6" title="6"><span class="cf">end</span></a></code></pre></div>
<h3 id="text.lower">lower</h3>
<p><code>lower (s)</code></p>
<p>Returns a copy of a UTF-8 string, converted to lowercase.</p>
<h3 id="text.upper">upper</h3>
<p><code>upper (s)</code></p>
<p>Returns a copy of a UTF-8 string, converted to uppercase.</p>
<h3 id="text.reverse">reverse</h3>
<p><code>reverse (s)</code></p>
<p>Returns a copy of a UTF-8 string, with characters reversed.</p>
<h3 id="text.len">len</h3>
<p><code>len (s)</code></p>
<p>Returns the length of a UTF-8 string.</p>
<h3 id="text.sub">sub</h3>
<p><code>sub (s)</code></p>
<p>Returns a substring of a UTF-8 string, using Lua’s string indexing rules.</p>
<h1 id="module-pandoc">Module pandoc</h1>
<p>Lua functions for pandoc scripts; includes constructors for document tree elements, functions to parse text in a given format, and functions to filter and modify a subtree.</p>
<h2 id="pandoc">Pandoc</h2>
<dl>
<dt><span id="pandoc.pandoc"><code>Pandoc (blocks[, meta])</code></span></dt>
<dd><p>A complete pandoc document</p>
<p>Parameters:</p>
<dl>
<dt><code>blocks</code>:</dt>
<dd>document content
</dd>
<dt><code>meta</code>:</dt>
<dd>document meta data
</dd>
</dl>
<p>Returns: <a href="#type-pandoc">Pandoc</a> object</p>
</dd>
</dl>
<h2 id="meta">Meta</h2>
<dl>
<dt><span id="pandoc.meta"><code>Meta (table)</code></span></dt>
<dd><p>Create a new Meta object.</p>
<p>Parameters:</p>
<dl>
<dt><code>table</code>:</dt>
<dd>table containing document meta information
</dd>
</dl>
<p>Returns: <a href="#type-meta">Meta</a> object</p>
</dd>
</dl>
<h2 id="metavalue">MetaValue</h2>
<dl>
<dt><span id="pandoc.metablocks"><code>MetaBlocks (blocks)</code></span></dt>
<dd><p>Meta blocks</p>
<p>Parameters:</p>
<dl>
<dt><code>blocks</code>:</dt>
<dd>blocks
</dd>
</dl>
<p>Returns: <a href="#type-metablocks">MetaBlocks</a> object</p>
</dd>
<dt><span id="pandoc.metainlines"><code>MetaInlines (inlines)</code></span></dt>
<dd><p>Meta inlines</p>
<p>Parameters:</p>
<dl>
<dt><code>inlines</code>:</dt>
<dd>inlines
</dd>
</dl>
<p>Returns: <a href="#type-metainlines">MetaInlines</a> object</p>
</dd>
<dt><span id="pandoc.metalist"><code>MetaList (meta_values)</code></span></dt>
<dd><p>Meta list</p>
<p>Parameters:</p>
<dl>
<dt><code>meta_values</code>:</dt>
<dd>list of meta values
</dd>
</dl>
<p>Returns: <a href="#type-metalist">MetaList</a> object</p>
</dd>
<dt><span id="pandoc.metamap"><code>MetaMap (key_value_map)</code></span></dt>
<dd><p>Meta map</p>
<p>Parameters:</p>
<dl>
<dt><code>key_value_map</code>:</dt>
<dd>a string-indexed map of meta values
</dd>
</dl>
<p>Returns: <a href="#type-metamap">MetaMap</a> object</p>
</dd>
<dt><span id="pandoc.metastring"><code>MetaString (str)</code></span></dt>
<dd><p>Creates string to be used in meta data.</p>
<p>Parameters:</p>
<dl>
<dt><code>str</code>:</dt>
<dd>string value
</dd>
</dl>
<p>Returns: <a href="#type-metastring">MetaString</a> object</p>
</dd>
<dt><span id="pandoc.metabool"><code>MetaBool (bool)</code></span></dt>
<dd><p>Creates boolean to be used in meta data.</p>
<p>Parameters:</p>
<dl>
<dt><code>bool</code>:</dt>
<dd>boolean value
</dd>
</dl>
<p>Returns: <a href="#type-metabool">MetaBool</a> object</p>
</dd>
</dl>
<h2 id="blocks">Blocks</h2>
<dl>
<dt><span id="pandoc.blockquote"><code>BlockQuote (content)</code></span></dt>
<dd><p>Creates a block quote element</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>block content
</dd>
</dl>
<p>Returns: <a href="#type-blockquote">BlockQuote</a> object</p>
</dd>
<dt><span id="pandoc.bulletlist"><code>BulletList (items)</code></span></dt>
<dd><p>Creates a bullet list.</p>
<p>Parameters:</p>
<dl>
<dt><code>items</code>:</dt>
<dd>list items
</dd>
</dl>
<p>Returns: <a href="#type-bulletlist">BulletList</a> object</p>
</dd>
<dt><span id="pandoc.codeblock"><code>CodeBlock (text[, attr])</code></span></dt>
<dd><p>Creates a code block element</p>
<p>Parameters:</p>
<dl>
<dt><code>text</code>:</dt>
<dd>code string
</dd>
<dt><code>attr</code>:</dt>
<dd>element attributes
</dd>
</dl>
<p>Returns: <a href="#type-codeblock">CodeBlock</a> object</p>
</dd>
<dt><span id="pandoc.definitionlist"><code>DefinitionList (content)</code></span></dt>
<dd><p>Creates a definition list, containing terms and their explanation.</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>list of items
</dd>
</dl>
<p>Returns: <a href="#type-definitionlist">DefinitionList</a> object</p>
</dd>
<dt><span id="pandoc.div"><code>Div (content[, attr])</code></span></dt>
<dd><p>Creates a div element</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>block content
</dd>
<dt><code>attr</code>:</dt>
<dd>element attributes
</dd>
</dl>
<p>Returns: <a href="#type-div">Div</a> object</p>
</dd>
<dt><span id="pandoc.header"><code>Header (level, content[, attr])</code></span></dt>
<dd><p>Creates a header element.</p>
<p>Parameters:</p>
<dl>
<dt><code>level</code>:</dt>
<dd>header level
</dd>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
<dt><code>attr</code>:</dt>
<dd>element attributes
</dd>
</dl>
<p>Returns: <a href="#type-header">Header</a> object</p>
</dd>
<dt><span id="pandoc.horizontalrule"><code>HorizontalRule ()</code></span></dt>
<dd><p>Creates a horizontal rule.</p>
<p>Returns: <a href="#type-horizontalrule">HorizontalRule</a> object</p>
</dd>
<dt><span id="pandoc.lineblock"><code>LineBlock (content)</code></span></dt>
<dd><p>Creates a line block element.</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
</dl>
<p>Returns: <a href="#type-lineblock">LineBlock</a> object</p>
</dd>
<dt><span id="pandoc.null"><code>Null ()</code></span></dt>
<dd><p>Creates a null element.</p>
<p>Returns: <a href="#type-null">Null</a> object</p>
</dd>
<dt><span id="pandoc.orderedlist"><code>OrderedList (items[, listAttributes])</code></span></dt>
<dd><p>Creates an ordered list.</p>
<p>Parameters:</p>
<dl>
<dt><code>items</code>:</dt>
<dd>list items
</dd>
<dt><code>listAttributes</code>:</dt>
<dd>list parameters
</dd>
</dl>
<p>Returns: <a href="#type-orderedlist">OrderedList</a> object</p>
</dd>
<dt><span id="pandoc.para"><code>Para (content)</code></span></dt>
<dd><p>Creates a para element.</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
</dl>
<p>Returns: <a href="#type-para">Para</a> object</p>
</dd>
<dt><span id="pandoc.plain"><code>Plain (content)</code></span></dt>
<dd><p>Creates a plain element.</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
</dl>
<p>Returns: <a href="#type-plain">Plain</a> object</p>
</dd>
<dt><span id="pandoc.rawblock"><code>RawBlock (format, text)</code></span></dt>
<dd><p>Creates a raw content block of the specified format.</p>
<p>Parameters:</p>
<dl>
<dt><code>format</code>:</dt>
<dd>format of content
</dd>
<dt><code>text</code>:</dt>
<dd>string content
</dd>
</dl>
<p>Returns: <a href="#type-rawblock">RawBlock</a> object</p>
</dd>
<dt><span id="pandoc.table"><code>Table (caption, colspecs, head, bodies, foot[, attr])</code></span></dt>
<dd><p>Creates a table element.</p>
<p>Parameters:</p>
<dl>
<dt><code>caption</code>:</dt>
<dd>table <a href="#type-caption">caption</a>
</dd>
<dt><code>colspecs</code>:</dt>
<dd>column alignments and widths (list of <a href="#type-colspec">ColSpec</a>s)
</dd>
<dt><code>head</code>:</dt>
<dd><a href="#type-tablehead">table head</a>
</dd>
<dt><code>bodies</code>:</dt>
<dd><a href="#type-tablebody">table bodies</a>
</dd>
<dt><code>foot</code>:</dt>
<dd><a href="#type-tablefoot">table foot</a>
</dd>
<dt><code>attr</code>:</dt>
<dd>element attributes
</dd>
</dl>
<p>Returns: <a href="#type-table">Table</a> object</p>
</dd>
</dl>
<h2 id="inline">Inline</h2>
<dl>
<dt><span id="pandoc.cite"><code>Cite (content, citations)</code></span></dt>
<dd><p>Creates a Cite inline element</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>List of inlines
</dd>
<dt><code>citations</code>:</dt>
<dd>List of citations
</dd>
</dl>
<p>Returns: <a href="#type-cite">Cite</a> object</p>
</dd>
<dt><span id="pandoc.code"><code>Code (text[, attr])</code></span></dt>
<dd><p>Creates a Code inline element</p>
<p>Parameters:</p>
<dl>
<dt><code>text</code>:</dt>
<dd>code string
</dd>
<dt><code>attr</code>:</dt>
<dd>additional attributes
</dd>
</dl>
<p>Returns: <a href="#type-code">Code</a> object</p>
</dd>
<dt><span id="pandoc.emph"><code>Emph (content)</code></span></dt>
<dd><p>Creates an inline element representing emphasized text.</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
</dl>
<p>Returns: <a href="#type-emph">Emph</a> object</p>
</dd>
<dt><span id="pandoc.image"><code>Image (caption, src[, title[, attr]])</code></span></dt>
<dd><p>Creates a Image inline element</p>
<p>Parameters:</p>
<dl>
<dt><code>caption</code>:</dt>
<dd>text used to describe the image
</dd>
<dt><code>src</code>:</dt>
<dd>path to the image file
</dd>
<dt><code>title</code>:</dt>
<dd>brief image description
</dd>
<dt><code>attr</code>:</dt>
<dd>additional attributes
</dd>
</dl>
<p>Returns: <a href="#type-image">Image</a> object</p>
</dd>
<dt><span id="pandoc.linebreak"><code>LineBreak ()</code></span></dt>
<dd><p>Create a LineBreak inline element</p>
<p>Returns: <a href="#type-linebreak">LineBreak</a> object</p>
</dd>
<dt><span id="pandoc.link"><code>Link (content, target[, title[, attr]])</code></span></dt>
<dd><p>Creates a link inline element, usually a hyperlink.</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>text for this link
</dd>
<dt><code>target</code>:</dt>
<dd>the link target
</dd>
<dt><code>title</code>:</dt>
<dd>brief link description
</dd>
<dt><code>attr</code>:</dt>
<dd>additional attributes
</dd>
</dl>
<p>Returns: <a href="#type-link">Link</a> object</p>
</dd>
<dt><span id="pandoc.math"><code>Math (mathtype, text)</code></span></dt>
<dd><p>Creates a Math element, either inline or displayed.</p>
<p>Parameters:</p>
<dl>
<dt><code>mathtype</code>:</dt>
<dd>rendering specifier
</dd>
<dt><code>text</code>:</dt>
<dd>Math content
</dd>
</dl>
<p>Returns: <a href="#type-math">Math</a> object</p>
</dd>
<dt><span id="pandoc.displaymath"><code>DisplayMath (text)</code></span></dt>
<dd><p>Creates a math element of type “DisplayMath” (DEPRECATED).</p>
<p>Parameters:</p>
<dl>
<dt><code>text</code>:</dt>
<dd>Math content
</dd>
</dl>
<p>Returns: <a href="#type-math">Math</a> object</p>
</dd>
<dt><span id="pandoc.inlinemath"><code>InlineMath (text)</code></span></dt>
<dd><p>Creates a math element of type “InlineMath” (DEPRECATED).</p>
<p>Parameters:</p>
<dl>
<dt><code>text</code>:</dt>
<dd>Math content
</dd>
</dl>
<p>Returns: <a href="#type-math">Math</a> object</p>
</dd>
<dt><span id="pandoc.note"><code>Note (content)</code></span></dt>
<dd><p>Creates a Note inline element</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>footnote block content
</dd>
</dl>
<p>Returns: <a href="#type-note">Note</a> object</p>
</dd>
<dt><span id="pandoc.quoted"><code>Quoted (quotetype, content)</code></span></dt>
<dd><p>Creates a Quoted inline element given the quote type and quoted content.</p>
<p>Parameters:</p>
<dl>
<dt><code>quotetype</code>:</dt>
<dd>type of quotes to be used
</dd>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
</dl>
<p>Returns: <a href="#type-quoted">Quoted</a> object</p>
</dd>
<dt><span id="pandoc.singlequoted"><code>SingleQuoted (content)</code></span></dt>
<dd><p>Creates a single-quoted inline element (DEPRECATED).</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
</dl>
<p>Returns: <a href="#type-quoted">Quoted</a></p>
</dd>
<dt><span id="pandoc.doublequoted"><code>DoubleQuoted (content)</code></span></dt>
<dd><p>Creates a single-quoted inline element (DEPRECATED).</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
</dl>
<p>Returns: <a href="#type-quoted">Quoted</a></p>
</dd>
<dt><span id="pandoc.rawinline"><code>RawInline (format, text)</code></span></dt>
<dd><p>Creates a raw inline element</p>
<p>Parameters:</p>
<dl>
<dt><code>format</code>:</dt>
<dd>format of the contents
</dd>
<dt><code>text</code>:</dt>
<dd>string content
</dd>
</dl>
<p>Returns: <a href="#type-rawinline">RawInline</a> object</p>
</dd>
<dt><span id="pandoc.smallcaps"><code>SmallCaps (content)</code></span></dt>
<dd><p>Creates text rendered in small caps</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
</dl>
<p>Returns: <a href="#type-smallcaps">SmallCaps</a> object</p>
</dd>
<dt><span id="pandoc.softbreak"><code>SoftBreak ()</code></span></dt>
<dd><p>Creates a SoftBreak inline element.</p>
<p>Returns: <a href="#type-softbreak">SoftBreak</a> object</p>
</dd>
<dt><span id="pandoc.space"><code>Space ()</code></span></dt>
<dd><p>Create a Space inline element</p>
<p>Returns: <a href="#type-space">Space</a> object</p>
</dd>
<dt><span id="pandoc.span"><code>Span (content[, attr])</code></span></dt>
<dd><p>Creates a Span inline element</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
<dt><code>attr</code>:</dt>
<dd>additional attributes
</dd>
</dl>
<p>Returns: <a href="#type-span">Span</a> object</p>
</dd>
<dt><span id="pandoc.str"><code>Str (text)</code></span></dt>
<dd><p>Creates a Str inline element</p>
<p>Parameters:</p>
<dl>
<dt><code>text</code>:</dt>
<dd>content
</dd>
</dl>
<p>Returns: <a href="#type-str">Str</a> object</p>
</dd>
<dt><span id="pandoc.strikeout"><code>Strikeout (content)</code></span></dt>
<dd><p>Creates text which is struck out.</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
</dl>
<p>Returns: <a href="#type-strikeout">Strikeout</a> object</p>
</dd>
<dt><span id="pandoc.strong"><code>Strong (content)</code></span></dt>
<dd><p>Creates a Strong element, whose text is usually displayed in a bold font.</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
</dl>
<p>Returns: <a href="#type-strong">Strong</a> object</p>
</dd>
<dt><span id="pandoc.subscript"><code>Subscript (content)</code></span></dt>
<dd><p>Creates a Subscript inline element</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
</dl>
<p>Returns: <a href="#type-subscript">Subscript</a> object</p>
</dd>
<dt><span id="pandoc.superscript"><code>Superscript (content)</code></span></dt>
<dd><p>Creates a Superscript inline element</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
</dl>
<p>Returns: <a href="#type-superscript">Superscript</a> object</p>
</dd>
<dt><span id="pandoc.underline"><code>Underline (content)</code></span></dt>
<dd><p>Creates an Underline inline element</p>
<p>Parameters:</p>
<dl>
<dt><code>content</code>:</dt>
<dd>inline content
</dd>
</dl>
<p>Returns: <a href="#type-underline">Underline</a> object</p>
</dd>
</dl>
<h2 id="element-components-1">Element components</h2>
<dl>
<dt><span id="pandoc.attr"><code>Attr ([identifier[, classes[, attributes]]])</code></span></dt>
<dd><p>Create a new set of attributes (Attr).</p>
<p>Parameters:</p>
<dl>
<dt><code>identifier</code>:</dt>
<dd>element identifier
</dd>
<dt><code>classes</code>:</dt>
<dd>element classes
</dd>
<dt><code>attributes</code>:</dt>
<dd>table containing string keys and values
</dd>
</dl>
<p>Returns: <a href="#type-attr">Attr</a> object</p>
</dd>
<dt><span id="pandoc.citation"><code>Citation (id, mode[, prefix[, suffix[, note_num[, hash]]]])</code></span></dt>
<dd><p>Creates a single citation.</p>
<p>Parameters:</p>
<dl>
<dt><code>id</code>:</dt>
<dd>citation identifier (like a bibtex key)
</dd>
<dt><code>mode</code>:</dt>
<dd>citation mode
</dd>
<dt><code>prefix</code>:</dt>
<dd>citation prefix
</dd>
<dt><code>suffix</code>:</dt>
<dd>citation suffix
</dd>
<dt><code>note_num</code>:</dt>
<dd>note number
</dd>
<dt><code>hash</code>:</dt>
<dd>hash number
</dd>
</dl>
<p>Returns: <a href="#type-citation">Citation</a> object</p>
</dd>
<dt><span id="pandoc.listattributes"><code>ListAttributes ([start[, style[, delimiter]]])</code></span></dt>
<dd><p>Creates a set of list attributes.</p>
<p>Parameters:</p>
<dl>
<dt><code>start</code>:</dt>
<dd>number of the first list item
</dd>
<dt><code>style</code>:</dt>
<dd>style used for list numbering
</dd>
<dt><code>delimiter</code>:</dt>
<dd>delimiter of list numbers
</dd>
</dl>
<p>Returns: <a href="#type-listattributes">ListAttributes</a> object</p>
</dd>
</dl>
<h2 id="legacy-types">Legacy types</h2>
<dl>
<dt><span id="pandoc.simpletable"><code>SimpleTable (caption, aligns, widths, headers, rows)</code></span></dt>
<dd><p>Creates a simple table resembling the old (pre pandoc 2.10) table type.</p>
<p>Parameters:</p>
<dl>
<dt><code>caption</code>:</dt>
<dd><a href="#type-list">List</a> of <a href="#type-inline">Inlines</a>
</dd>
<dt><code>aligns</code>:</dt>
<dd>column alignments (<a href="#type-list">List</a> of <a href="#type-alignment">Alignments</a>)
</dd>
<dt><code>widths</code>:</dt>
<dd>column widths; a (<a href="#type-list">List</a> of numbers)
</dd>
<dt><code>headers</code>:</dt>
<dd>table header row (<a href="#type-list">List</a> of lists of <a href="#type-block">Blocks</a>)
</dd>
<dt><code>rows</code>:</dt>
<dd>table rows (<a href="#type-list">List</a> of rows, where a row is a list of lists of <a href="#type-block">Blocks</a>)
</dd>
</dl>
<p>Returns: <a href="#type-simpletable">SimpleTable</a> object</p>
<p>Usage:</p>
<pre><code>local caption = &quot;Overview&quot;
local aligns = {pandoc.AlignDefault, pandoc.AlignDefault}
local widths = {0, 0} -- let pandoc determine col widths
local headers = {{pandoc.Plain({pandoc.Str &quot;Language&quot;})},
                 {pandoc.Plain({pandoc.Str &quot;Typing&quot;})}}
local rows = {
  {{pandoc.Plain &quot;Haskell&quot;}, {pandoc.Plain &quot;static&quot;}},
  {{pandoc.Plain &quot;Lua&quot;}, {pandoc.Plain &quot;Dynamic&quot;}},
}
simple_table = pandoc.SimpleTable(
  caption,
  aligns,
  widths,
  headers,
  rows
)</code></pre>
</dd>
</dl>
<h2 id="constants">Constants</h2>
<dl>
<dt><span id="pandoc.authorintext"><code>AuthorInText</code></span></dt>
<dd><p>Author name is mentioned in the text.</p>
<p>See also: <a href="#type-citation">Citation</a></p>
</dd>
<dt><span id="pandoc.suppressauthor"><code>SuppressAuthor</code></span></dt>
<dd><p>Author name is suppressed.</p>
<p>See also: <a href="#type-citation">Citation</a></p>
</dd>
<dt><span id="pandoc.normalcitation"><code>NormalCitation</code></span></dt>
<dd><p>Default citation style is used.</p>
<p>See also: <a href="#type-citation">Citation</a></p>
</dd>
<dt><span id="pandoc.alignleft"><code>AlignLeft</code></span></dt>
<dd><p>Table cells aligned left.</p>
<p>See also: <a href="#type-alignment">Table</a></p>
</dd>
<dt><span id="pandoc.alignright"><code>AlignRight</code></span></dt>
<dd><p>Table cells right-aligned.</p>
<p>See also: <a href="#type-alignment">Table</a></p>
</dd>
<dt><span id="pandoc.aligncenter"><code>AlignCenter</code></span></dt>
<dd><p>Table cell content is centered.</p>
<p>See also: <a href="#type-alignment">Table</a></p>
</dd>
<dt><span id="pandoc.aligndefault"><code>AlignDefault</code></span></dt>
<dd><p>Table cells are alignment is unaltered.</p>
<p>See also: <a href="#type-alignment">Table</a></p>
</dd>
<dt><span id="pandoc.defaultdelim"><code>DefaultDelim</code></span></dt>
<dd><p>Default list number delimiters are used.</p>
<p>See also: <a href="#type-listattributes">ListAttributes</a></p>
</dd>
<dt><span id="pandoc.period"><code>Period</code></span></dt>
<dd><p>List numbers are delimited by a period.</p>
<p>See also: <a href="#type-listattributes">ListAttributes</a></p>
</dd>
<dt><span id="pandoc.oneparen"><code>OneParen</code></span></dt>
<dd><p>List numbers are delimited by a single parenthesis.</p>
<p>See also: <a href="#type-listattributes">ListAttributes</a></p>
</dd>
<dt><span id="pandoc.twoparens"><code>TwoParens</code></span></dt>
<dd><p>List numbers are delimited by a double parentheses.</p>
<p>See also: <a href="#type-listattributes">ListAttributes</a></p>
</dd>
<dt><span id="pandoc.defaultstyle"><code>DefaultStyle</code></span></dt>
<dd><p>List are numbered in the default style</p>
<p>See also: <a href="#type-listattributes">ListAttributes</a></p>
</dd>
<dt><span id="pandoc.example"><code>Example</code></span></dt>
<dd><p>List items are numbered as examples.</p>
<p>See also: <a href="#type-listattributes">ListAttributes</a></p>
</dd>
<dt><span id="pandoc.decimal"><code>Decimal</code></span></dt>
<dd><p>List are numbered using decimal integers.</p>
<p>See also: <a href="#type-listattributes">ListAttributes</a></p>
</dd>
<dt><span id="pandoc.lowerroman"><code>LowerRoman</code></span></dt>
<dd><p>List are numbered using lower-case roman numerals.</p>
<p>See also: <a href="#type-listattributes">ListAttributes</a></p>
</dd>
<dt><span id="pandoc.upperroman"><code>UpperRoman</code></span></dt>
<dd><p>List are numbered using upper-case roman numerals</p>
<p>See also: <a href="#type-listattributes">ListAttributes</a></p>
</dd>
<dt><span id="pandoc.loweralpha"><code>LowerAlpha</code></span></dt>
<dd><p>List are numbered using lower-case alphabetic characters.</p>
<p>See also: <a href="#type-listattributes">ListAttributes</a></p>
</dd>
<dt><span id="pandoc.upperalpha"><code>UpperAlpha</code></span></dt>
<dd><p>List are numbered using upper-case alphabetic characters.</p>
<p>See also: <a href="#type-listattributes">ListAttributes</a></p>
</dd>
<dt><span id="pandoc.sha1"><code>sha1</code></span></dt>
<dd><p>Alias for <a href="#pandoc.utils.sha1"><code>pandoc.utils.sha1</code></a> (DEPRECATED).</p>
</dd>
</dl>
<h2 id="helper-functions">Helper functions</h2>
<h3 id="pandoc.pipe">pipe</h3>
<p><code>pipe (command, args, input)</code></p>
<p>Runs command with arguments, passing it some input, and returns the output.</p>
<p>Parameters:</p>
<dl>
<dt><code>command</code></dt>
<dd>program to run; the executable will be resolved using default system methods (string).
</dd>
<dt><code>args</code></dt>
<dd>list of arguments to pass to the program (list of strings).
</dd>
<dt><code>input</code></dt>
<dd>data which is piped into the program via stdin (string).
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>Output of command, i.e. data printed to stdout (string)</li>
</ul>
<p>Raises:</p>
<ul>
<li>A table containing the keys <code>command</code>, <code>error_code</code>, and <code>output</code> is thrown if the command exits with a non-zero error code.</li>
</ul>
<p>Usage:</p>
<pre><code>local output = pandoc.pipe(&quot;sed&quot;, {&quot;-e&quot;,&quot;s/a/b/&quot;}, &quot;abc&quot;)</code></pre>
<h3 id="pandoc.walk_block">walk_block</h3>
<p><code>walk_block (element, filter)</code></p>
<p>Apply a filter inside a block element, walking its contents.</p>
<p>Parameters:</p>
<dl>
<dt><code>element</code>:</dt>
<dd>the block element
</dd>
<dt><code>filter</code>:</dt>
<dd>a Lua filter (table of functions) to be applied within the block element
</dd>
</dl>
<p>Returns: the transformed block element</p>
<h3 id="pandoc.walk_inline">walk_inline</h3>
<p><code>walk_inline (element, filter)</code></p>
<p>Apply a filter inside an inline element, walking its contents.</p>
<p>Parameters:</p>
<dl>
<dt><code>element</code>:</dt>
<dd>the inline element
</dd>
<dt><code>filter</code>:</dt>
<dd>a Lua filter (table of functions) to be applied within the inline element
</dd>
</dl>
<p>Returns: the transformed inline element</p>
<h3 id="pandoc.read">read</h3>
<p><code>read (markup[, format])</code></p>
<p>Parse the given string into a Pandoc document.</p>
<p>Parameters:</p>
<dl>
<dt><code>markup</code>:</dt>
<dd>the markup to be parsed
</dd>
<dt><code>format</code>:</dt>
<dd>format specification, defaults to <code>"markdown"</code>.
</dd>
</dl>
<p>Returns: pandoc document</p>
<p>Usage:</p>
<pre><code>local org_markup = &quot;/emphasis/&quot;  -- Input to be read
local document = pandoc.read(org_markup, &quot;org&quot;)
-- Get the first block of the document
local block = document.blocks[1]
-- The inline element in that block is an `Emph`
assert(block.content[1].t == &quot;Emph&quot;)</code></pre>
<h1 id="module-pandoc.utils">Module pandoc.utils</h1>
<p>This module exposes internal pandoc functions and utility functions.</p>
<p>The module is loaded as part of the <code>pandoc</code> module and available as <code>pandoc.utils</code>. In versions up-to and including pandoc 2.6, this module had to be loaded explicitly. Example:</p>
<pre><code>pandoc.utils = require &#39;pandoc.utils&#39;</code></pre>
<p>Use the above for backwards compatibility.</p>
<h3 id="pandoc.utils.blocks_to_inlines">blocks_to_inlines</h3>
<p><code>blocks_to_inlines (blocks[, sep])</code></p>
<p>Squash a list of blocks into a list of inlines.</p>
<p>Parameters:</p>
<dl>
<dt><code>blocks</code>:</dt>
<dd>List of <a href="#type-block">Blocks</a> to be flattened.
</dd>
<dt><code>sep</code>:</dt>
<dd>List of <a href="#type-inline">Inlines</a> inserted as separator between two consecutive blocks; defaults to <code>{ pandoc.Space(), pandoc.Str'¶', pandoc.Space()}</code>.
</dd>
</dl>
<p>Returns:</p>
<ul>
<li><a href="#type-list">List</a> of <a href="#type-inline">Inlines</a></li>
</ul>
<p>Usage:</p>
<pre><code>local blocks = {
  pandoc.Para{ pandoc.Str &#39;Paragraph1&#39; },
  pandoc.Para{ pandoc.Emph &#39;Paragraph2&#39; }
}
local inlines = pandoc.utils.blocks_to_inlines(blocks)
-- inlines = {
--   pandoc.Str &#39;Paragraph1&#39;,
--   pandoc.Space(), pandoc.Str&#39;¶&#39;, pandoc.Space(),
--   pandoc.Emph{ pandoc.Str &#39;Paragraph2&#39; }
-- }</code></pre>
<h3 id="pandoc.utils.equals">equals</h3>
<p><code>equals (element1, element2)</code></p>
<p>Test equality of AST elements. Elements in Lua are considered equal if and only if the objects obtained by unmarshaling are equal.</p>
<p>Parameters:</p>
<dl>
<dt><code>element1</code>, <code>element2</code>:</dt>
<dd>Objects to be compared. Acceptable input types are <a href="#type-pandoc">Pandoc</a>, <a href="#type-meta">Meta</a>, <a href="#type-metavalue">MetaValue</a>, <a href="#type-block">Block</a>, <a href="#type-inline">Inline</a>, <a href="#type-attr">Attr</a>, <a href="#type-listattributes">ListAttributes</a>, and <a href="#type-citation">Citation</a>.
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>Whether the two objects represent the same element (boolean)</li>
</ul>
<h3 id="pandoc.utils.from_simple_table">from_simple_table</h3>
<p><code>from_simple_table (table)</code></p>
<p>Creates a <a href="#type-table">Table</a> block element from a <a href="#type-simpletable">SimpleTable</a>. This is useful for dealing with legacy code which was written for pandoc versions older than 2.10.</p>
<p>Returns:</p>
<ul>
<li>table block element (<a href="#type-table">Table</a>)</li>
</ul>
<p>Usage:</p>
<pre><code>local simple = pandoc.SimpleTable(table)
-- modify, using pre pandoc 2.10 methods
simple.caption = pandoc.SmallCaps(simple.caption)
-- create normal table block again
table = pandoc.utils.from_simple_table(simple)</code></pre>
<h3 id="pandoc.utils.make_sections">make_sections</h3>
<p><code>make_sections (number_sections, base_level, blocks)</code></p>
<p>Converts list of <a href="#type-block">Blocks</a> into sections. <code>Div</code>s will be created beginning at each <code>Header</code> and containing following content until the next <code>Header</code> of comparable level. If <code>number_sections</code> is true, a <code>number</code> attribute will be added to each <code>Header</code> containing the section number. If <code>base_level</code> is non-null, <code>Header</code> levels will be reorganized so that there are no gaps, and so that the base level is the level specified.</p>
<p>Returns:</p>
<ul>
<li>List of <a href="#type-block">Blocks</a>.</li>
</ul>
<p>Usage:</p>
<pre><code>local blocks = {
  pandoc.Header(2, pandoc.Str &#39;first&#39;),
  pandoc.Header(2, pandoc.Str &#39;second&#39;),
}
local newblocks = pandoc.utils.make_sections(true, 1, blocks)</code></pre>
<h3 id="pandoc.utils.run_json_filter">run_json_filter</h3>
<p><code>run_json_filter (doc, filter[, args])</code></p>
<p>Filter the given doc by passing it through the a JSON filter.</p>
<p>Parameters:</p>
<dl>
<dt><code>doc</code>:</dt>
<dd>the Pandoc document to filter
</dd>
<dt><code>filter</code>:</dt>
<dd>filter to run
</dd>
<dt><code>args</code>:</dt>
<dd>list of arguments passed to the filter. Defaults to <code>{FORMAT}</code>.
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>(<a href="#type-pandoc">Pandoc</a>) Filtered document</li>
</ul>
<p>Usage:</p>
<pre><code>-- Assumes `some_blocks` contains blocks for which a
-- separate literature section is required.
local sub_doc = pandoc.Pandoc(some_blocks, metadata)
sub_doc_with_bib = pandoc.utils.run_json_filter(
  sub_doc,
  &#39;pandoc-citeproc&#39;
)
some_blocks = sub_doc.blocks -- some blocks with bib</code></pre>
<h3 id="pandoc.utils.normalize_date">normalize_date</h3>
<p><code>normalize_date (date_string)</code></p>
<p>Parse a date and convert (if possible) to “YYYY-MM-DD” format. We limit years to the range 1601-9999 (ISO 8601 accepts greater than or equal to 1583, but MS Word only accepts dates starting 1601).</p>
<p>Returns:</p>
<ul>
<li>A date string, or nil when the conversion failed.</li>
</ul>
<h3 id="pandoc.utils.sha1">sha1</h3>
<p><code>sha1 (contents)</code></p>
<p>Returns the SHA1 has of the contents.</p>
<p>Returns:</p>
<ul>
<li>SHA1 hash of the contents.</li>
</ul>
<p>Usage:</p>
<pre><code>local fp = pandoc.utils.sha1(&quot;foobar&quot;)</code></pre>
<h3 id="pandoc.utils.stringify">stringify</h3>
<p><code>stringify (element)</code></p>
<p>Converts the given element (Pandoc, Meta, Block, or Inline) into a string with all formatting removed.</p>
<p>Returns:</p>
<ul>
<li>A plain string representation of the given element.</li>
</ul>
<p>Usage:</p>
<pre><code>local inline = pandoc.Emph{pandoc.Str &#39;Moin&#39;}
-- outputs &quot;Moin&quot;
print(pandoc.utils.stringify(inline))</code></pre>
<h3 id="pandoc.utils.to_roman_numeral">to_roman_numeral</h3>
<p><code>to_roman_numeral (integer)</code></p>
<p>Converts an integer &lt; 4000 to uppercase roman numeral.</p>
<p>Returns:</p>
<ul>
<li>A roman numeral string.</li>
</ul>
<p>Usage:</p>
<pre><code>local to_roman_numeral = pandoc.utils.to_roman_numeral
local pandoc_birth_year = to_roman_numeral(2006)
-- pandoc_birth_year == &#39;MMVI&#39;</code></pre>
<h3 id="pandoc.utils.to_simple_table">to_simple_table</h3>
<p><code>to_simple_table (table)</code></p>
<p>Creates a <a href="#type-simpletable">SimpleTable</a> out of a <a href="#type-table">Table</a> block.</p>
<p>Returns:</p>
<ul>
<li>a simple table object (<a href="#type-simpletable">SimpleTable</a>)</li>
</ul>
<p>Usage:</p>
<pre><code>local simple = pandoc.utils.to_simple_table(table)
-- modify, using pre pandoc 2.10 methods
simple.caption = pandoc.SmallCaps(simple.caption)
-- create normal table block again
table = pandoc.utils.from_simple_table(simple)</code></pre>
<h1 id="module-pandoc.mediabag">Module pandoc.mediabag</h1>
<p>The <code>pandoc.mediabag</code> module allows accessing pandoc’s media storage. The “media bag” is used when pandoc is called with the <code>--extract-media</code> or (for HTML only) <code>--self-contained</code> option.</p>
<p>The module is loaded as part of module <code>pandoc</code> and can either be accessed via the <code>pandoc.mediabag</code> field, or explicitly required, e.g.:</p>
<pre><code>local mb = require &#39;pandoc.mediabag&#39;</code></pre>
<h3 id="pandoc.mediabag.delete">delete</h3>
<p><code>delete (filepath)</code></p>
<p>Removes a single entry from the media bag.</p>
<p>Parameters:</p>
<dl>
<dt><code>filepath</code>:</dt>
<dd>filename of the item to be deleted. The media bag will be left unchanged if no entry with the given filename exists.
</dd>
</dl>
<h3 id="pandoc.mediabag.empty">empty</h3>
<p><code>empty ()</code></p>
<p>Clear-out the media bag, deleting all items.</p>
<h3 id="pandoc.mediabag.insert">insert</h3>
<p><code>insert (filepath, mime_type, contents)</code></p>
<p>Adds a new entry to pandoc’s media bag. Replaces any existing mediabag entry with the same <code>filepath</code>.</p>
<p>Parameters:</p>
<dl>
<dt><code>filepath</code>:</dt>
<dd>filename and path relative to the output folder.
</dd>
<dt><code>mime_type</code>:</dt>
<dd>the file’s MIME type; use <code>nil</code> if unknown or unavailable.
</dd>
<dt><code>contents</code>:</dt>
<dd>the binary contents of the file.
</dd>
</dl>
<p>Usage:</p>
<pre><code>local fp = &quot;media/hello.txt&quot;
local mt = &quot;text/plain&quot;
local contents = &quot;Hello, World!&quot;
pandoc.mediabag.insert(fp, mt, contents)</code></pre>
<h3 id="pandoc.mediabag.items">items</h3>
<p><code>items ()</code></p>
<p>Returns an iterator triple to be used with Lua’s generic <code>for</code> statement. The iterator returns the filepath, MIME type, and content of a media bag item on each invocation. Items are processed one-by-one to avoid excessive memory use.</p>
<p>This function should be used only when full access to all items, including their contents, is required. For all other cases, <a href="#pandoc.mediabag.list"><code>list</code></a> should be preferred.</p>
<p>Returns:</p>
<ul>
<li>The iterator function; must be called with the iterator state and the current iterator value.</li>
<li>Iterator state – an opaque value to be passed to the iterator function.</li>
<li>Initial iterator value.</li>
</ul>
<p>Usage:</p>
<pre><code>for fp, mt, contents in pandoc.mediabag.items() do
  -- print(fp, mt, contents)
end</code></pre>
<h3 id="pandoc.mediabag.list">list</h3>
<p><code>list ()</code></p>
<p>Get a summary of the current media bag contents.</p>
<p>Returns: A list of elements summarizing each entry in the media bag. The summary item contains the keys <code>path</code>, <code>type</code>, and <code>length</code>, giving the filepath, MIME type, and length of contents in bytes, respectively.</p>
<p>Usage:</p>
<pre><code>-- calculate the size of the media bag.
local mb_items = pandoc.mediabag.list()
local sum = 0
for i = 1, #mb_items do
    sum = sum + mb_items[i].length
end
print(sum)</code></pre>
<h3 id="pandoc.mediabag.lookup">lookup</h3>
<p><code>lookup (filepath)</code></p>
<p>Lookup a media item in the media bag, and return its MIME type and contents.</p>
<p>Parameters:</p>
<dl>
<dt><code>filepath</code>:</dt>
<dd>name of the file to look up.
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>the entry’s MIME type, or nil if the file was not found.</li>
<li>contents of the file, or nil if the file was not found.</li>
</ul>
<p>Usage:</p>
<pre><code>local filename = &quot;media/diagram.png&quot;
local mt, contents = pandoc.mediabag.lookup(filename)</code></pre>
<h3 id="pandoc.mediabag.fetch">fetch</h3>
<p><code>fetch (source)</code></p>
<p>Fetches the given source from a URL or local file. Returns two values: the contents of the file and the MIME type (or an empty string).</p>
<p>The function will first try to retrieve <code>source</code> from the mediabag; if that fails, it will try to download it or read it from the local file system while respecting pandoc’s “resource path” setting.</p>
<p>Parameters:</p>
<dl>
<dt><code>source</code>:</dt>
<dd>path to a resource; either a local file path or URI
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>the entries MIME type, or nil if the file was not found.</li>
<li>contents of the file, or nil if the file was not found.</li>
</ul>
<p>Usage:</p>
<pre><code>local diagram_url = &quot;https://pandoc.org/diagram.jpg&quot;
local mt, contents = pandoc.mediabag.fetch(diagram_url)</code></pre>
<h1 id="module-pandoc.list">Module pandoc.List</h1>
<p>This module defines pandoc’s list type. It comes with useful methods and convenience functions.</p>
<h2 id="constructor">Constructor</h2>
<dl>
<dt><span id="pandoc.list"><code>pandoc.List([table])</code></span></dt>
<dd><p>Create a new List. If the optional argument <code>table</code> is given, set the metatable of that value to <code>pandoc.List</code>. This is an alias for <a href="#pandoc.list:new"><code>pandoc.List:new([table])</code></a>.</p>
</dd>
</dl>
<h2 id="metamethods">Metamethods</h2>
<dl>
<dt><span id="pandoc.list:__concat"><code>pandoc.List:__concat (list)</code></span></dt>
<dd><p>Concatenates two lists.</p>
<p>Parameters:</p>
<dl>
<dt><code>list</code>:</dt>
<dd>second list concatenated to the first
</dd>
</dl>
<p>Returns: a new list containing all elements from list1 and list2</p>
</dd>
</dl>
<h2 id="methods">Methods</h2>
<dl>
<dt><span id="pandoc.list:clone"><code>pandoc.List:clone ()</code></span></dt>
<dd><p>Returns a (shallow) copy of the list.</p>
</dd>
<dt><span id="pandoc.list:extend"><code>pandoc.List:extend (list)</code></span></dt>
<dd><p>Adds the given list to the end of this list.</p>
<p>Parameters:</p>
<dl>
<dt><code>list</code>:</dt>
<dd>list to appended
</dd>
</dl>
</dd>
<dt><span id="pandoc.list:find"><code>pandoc.List:find (needle, init)</code></span></dt>
<dd><p>Returns the value and index of the first occurrence of the given item.</p>
<p>Parameters:</p>
<dl>
<dt><code>needle</code>:</dt>
<dd>item to search for
</dd>
<dt><code>init</code>:</dt>
<dd>index at which the search is started
</dd>
</dl>
<p>Returns: first item equal to the needle, or nil if no such item exists.</p>
</dd>
<dt><span id="pandoc.list:find_if"><code>pandoc.List:find_if (pred, init)</code></span></dt>
<dd><p>Returns the value and index of the first element for which the predicate holds true.</p>
<p>Parameters:</p>
<dl>
<dt><code>pred</code>:</dt>
<dd>the predicate function
</dd>
<dt><code>init</code>:</dt>
<dd>index at which the search is started
</dd>
</dl>
<p>Returns: first item for which `test` succeeds, or nil if no such item exists.</p>
</dd>
<dt><span id="pandoc.list:filter"><code>pandoc.List:filter (pred)</code></span></dt>
<dd><p>Returns a new list containing all items satisfying a given condition.</p>
<p>Parameters:</p>
<dl>
<dt><code>pred</code>:</dt>
<dd>condition items must satisfy.
</dd>
</dl>
<p>Returns: a new list containing all items for which `test` was true.</p>
</dd>
<dt><span id="pandoc.list:includes"><code>pandoc.List:includes (needle, init)</code></span></dt>
<dd><p>Checks if the list has an item equal to the given needle.</p>
<p>Parameters:</p>
<dl>
<dt><code>needle</code>:</dt>
<dd>item to search for
</dd>
<dt><code>init</code>:</dt>
<dd>index at which the search is started
</dd>
</dl>
<p>Returns: true if a list item is equal to the needle, false otherwise</p>
</dd>
<dt><span id="pandoc.list:insert"><code>pandoc.List:insert ([pos], value)</code></span></dt>
<dd><p>Inserts element <code>value</code> at position <code>pos</code> in list, shifting elements to the next-greater index if necessary.</p>
<p>This function is identical to <a href="https://www.lua.org/manual/5.3/manual.html#6.6"><code>table.insert</code></a>.</p>
<p>Parameters:</p>
<dl>
<dt><code>pos</code>:</dt>
<dd>index of the new value; defaults to length of the list + 1
</dd>
<dt><code>value</code>:</dt>
<dd>value to insert into the list
</dd>
</dl>
</dd>
<dt><span id="pandoc.list:map"><code>pandoc.List:map (fn)</code></span></dt>
<dd><p>Returns a copy of the current list by applying the given function to all elements.</p>
<p>Parameters:</p>
<dl>
<dt><code>fn</code>:</dt>
<dd>function which is applied to all list items.
</dd>
</dl>
</dd>
<dt><span id="pandoc.list:new"><code>pandoc.List:new([table])</code></span></dt>
<dd><p>Create a new List. If the optional argument <code>table</code> is given, set the metatable of that value to <code>pandoc.List</code>.</p>
<p>Parameters:</p>
<dl>
<dt><code>table</code>:</dt>
<dd>table which should be treatable as a list; defaults to an empty table
</dd>
</dl>
<p>Returns: the updated input value</p>
</dd>
<dt><span id="pandoc.list:remove"><code>pandoc.List:remove ([pos])</code></span></dt>
<dd><p>Removes the element at position <code>pos</code>, returning the value of the removed element.</p>
<p>This function is identical to <a href="https://www.lua.org/manual/5.3/manual.html#6.6"><code>table.remove</code></a>.</p>
<p>Parameters:</p>
<dl>
<dt><code>pos</code>:</dt>
<dd>position of the list value that will be removed; defaults to the index of the last element
</dd>
</dl>
<p>Returns: the removed element</p>
</dd>
<dt><span id="pandoc.list:sort"><code>pandoc.List:sort ([comp])</code></span></dt>
<dd><p>Sorts list elements in a given order, in-place. If <code>comp</code> is given, then it must be a function that receives two list elements and returns true when the first element must come before the second in the final order (so that, after the sort, <code>i &lt; j</code> implies <code>not comp(list[j],list[i]))</code>. If comp is not given, then the standard Lua operator <code>&lt;</code> is used instead.</p>
<p>Note that the comp function must define a strict partial order over the elements in the list; that is, it must be asymmetric and transitive. Otherwise, no valid sort may be possible.</p>
<p>The sort algorithm is not stable: elements considered equal by the given order may have their relative positions changed by the sort.</p>
<p>This function is identical to <a href="https://www.lua.org/manual/5.3/manual.html#6.6"><code>table.sort</code></a>.</p>
<p>Parameters:</p>
<dl>
<dt><code>comp</code>:</dt>
<dd>Comparison function as described above.
</dd>
</dl>
</dd>
</dl>
<h1 id="module-pandoc.path">Module pandoc.path</h1>
<p>Module for file path manipulations.</p>
<h2 id="pandoc.path-fields">Static Fields</h2>
<h3 id="pandoc.path.separator">separator</h3>
<p>The character that separates directories.</p>
<h3 id="pandoc.path.search_path_separator">search_path_separator</h3>
<p>The character that is used to separate the entries in the <code>PATH</code> environment variable.</p>
<h2 id="pandoc.path-functions">Functions</h2>
<h3 id="pandoc.path.directory">directory (filepath)</h3>
<p>Gets the directory name, i.e., removes the last directory separator and everything after from the given path.</p>
<p>Parameters:</p>
<dl>
<dt>filepath</dt>
<dd>path (string)
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>The filepath up to the last directory separator. (string)</li>
</ul>
<h3 id="pandoc.path.filename">filename (filepath)</h3>
<p>Get the file name.</p>
<p>Parameters:</p>
<dl>
<dt>filepath</dt>
<dd>path (string)
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>File name part of the input path. (string)</li>
</ul>
<h3 id="pandoc.path.is_absolute">is_absolute (filepath)</h3>
<p>Checks whether a path is absolute, i.e. not fixed to a root.</p>
<p>Parameters:</p>
<dl>
<dt>filepath</dt>
<dd>path (string)
</dd>
</dl>
<p>Returns:</p>
<ul>
<li><code>true</code> if <code>filepath</code> is an absolute path, <code>false</code> otherwise. (boolean)</li>
</ul>
<h3 id="pandoc.path.is_relative">is_relative (filepath)</h3>
<p>Checks whether a path is relative or fixed to a root.</p>
<p>Parameters:</p>
<dl>
<dt>filepath</dt>
<dd>path (string)
</dd>
</dl>
<p>Returns:</p>
<ul>
<li><code>true</code> if <code>filepath</code> is a relative path, <code>false</code> otherwise. (boolean)</li>
</ul>
<h3 id="pandoc.path.join">join (filepaths)</h3>
<p>Join path elements back together by the directory separator.</p>
<p>Parameters:</p>
<dl>
<dt>filepaths</dt>
<dd>path components (list of strings)
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>The joined path. (string)</li>
</ul>
<h3 id="pandoc.path.make_relative">make_relative (path, root[, unsafe])</h3>
<p>Contract a filename, based on a relative path. Note that the resulting path will usually not introduce <code>..</code> paths, as the presence of symlinks means <code>../b</code> may not reach <code>a/b</code> if it starts from <code>a/c</code>. For a worked example see <a href="https://neilmitchell.blogspot.co.uk/2015/10/filepaths-are-subtle-symlinks-are-hard.html">this blog post</a>.</p>
<p>Set <code>unsafe</code> to a truthy value to a allow <code>..</code> in paths.</p>
<p>Parameters:</p>
<dl>
<dt>path</dt>
<dd>path to be made relative (string)
</dd>
<dt>root</dt>
<dd>root path (string)
</dd>
<dt>unsafe</dt>
<dd>whether to allow <code>..</code> in the result. (boolean)
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>contracted filename (string)</li>
</ul>
<h3 id="pandoc.path.normalize">normalize (filepath)</h3>
<p>Normalizes a path.</p>
<ul>
<li><code>//</code> makes sense only as part of a (Windows) network drive; elsewhere, multiple slashes are reduced to a single <code>path.separator</code> (platform dependent).</li>
<li><code>/</code> becomes <code>path.separator</code> (platform dependent)</li>
<li><code>./</code> -&gt; ’’</li>
<li>an empty path becomes <code>.</code></li>
</ul>
<p>Parameters:</p>
<dl>
<dt>filepath</dt>
<dd>path (string)
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>The normalized path. (string)</li>
</ul>
<h3 id="pandoc.path.split">split (filepath)</h3>
<p>Splits a path by the directory separator.</p>
<p>Parameters:</p>
<dl>
<dt>filepath</dt>
<dd>path (string)
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>List of all path components. (list of strings)</li>
</ul>
<h3 id="pandoc.path.split_extension">split_extension (filepath)</h3>
<p>Splits the last extension from a file path and returns the parts. The extension, if present, includes the leading separator; if the path has no extension, then the empty string is returned as the extension.</p>
<p>Parameters:</p>
<dl>
<dt>filepath</dt>
<dd>path (string)
</dd>
</dl>
<p>Returns:</p>
<ul>
<li><p>filepath without extension (string)</p></li>
<li><p>extension or empty string (string)</p></li>
</ul>
<h3 id="pandoc.path.split_search_path">split_search_path (search_path)</h3>
<p>Takes a string and splits it on the <code>search_path_separator</code> character. Blank items are ignored on Windows, and converted to <code>.</code> on Posix. On Windows path elements are stripped of quotes.</p>
<p>Parameters:</p>
<dl>
<dt>search_path</dt>
<dd>platform-specific search path (string)
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>list of directories in search path (list of strings)</li>
</ul>
<h1 id="module-pandoc.system">Module pandoc.system</h1>
<p>Access to system information and functionality.</p>
<h2 id="static-fields">Static Fields</h2>
<h3 id="pandoc.system.arch">arch</h3>
<p>The machine architecture on which the program is running.</p>
<h3 id="pandoc.system.os">os</h3>
<p>The operating system on which the program is running.</p>
<h2 id="functions">Functions</h2>
<h3 id="pandoc.system.environment">environment</h3>
<p><code>environment ()</code></p>
<p>Retrieve the entire environment as a string-indexed table.</p>
<p>Returns:</p>
<ul>
<li>A table mapping environment variables names to their string value (table).</li>
</ul>
<h3 id="pandoc.system.get_working_directory">get_working_directory</h3>
<p><code>get_working_directory ()</code></p>
<p>Obtain the current working directory as an absolute path.</p>
<p>Returns:</p>
<ul>
<li>The current working directory (string).</li>
</ul>
<h3 id="pandoc.system.with_environment">with_environment</h3>
<p><code>with_environment (environment, callback)</code></p>
<p>Run an action within a custom environment. Only the environment variables given by <code>environment</code> will be set, when <code>callback</code> is called. The original environment is restored after this function finishes, even if an error occurs while running the callback action.</p>
<p>Parameters:</p>
<dl>
<dt><code>environment</code></dt>
<dd>Environment variables and their values to be set before running <code>callback</code>. (table with string keys and string values)
</dd>
<dt><code>callback</code></dt>
<dd>Action to execute in the custom environment (function)
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>The result(s) of the call to <code>callback</code></li>
</ul>
<h3 id="pandoc.system.with_temporary_directory">with_temporary_directory</h3>
<p><code>with_temporary_directory ([parent_dir,] templ, callback)</code></p>
<p>Create and use a temporary directory inside the given directory. The directory is deleted after the callback returns.</p>
<p>Parameters:</p>
<dl>
<dt><code>parent_dir</code></dt>
<dd>Parent directory to create the directory in (string). If this parameter is omitted, the system’s canonical temporary directory is used.
</dd>
<dt><code>templ</code></dt>
<dd>Directory name template (string).
</dd>
<dt><code>callback</code></dt>
<dd>Function which takes the name of the temporary directory as its first argument (function).
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>The result of the call to <code>callback</code>.</li>
</ul>
<h3 id="pandoc.system.with_working_directory">with_working_directory</h3>
<p><code>with_working_directory (directory, callback)</code></p>
<p>Run an action within a different directory. This function will change the working directory to <code>directory</code>, execute <code>callback</code>, then switch back to the original working directory, even if an error occurs while running the callback action.</p>
<p>Parameters:</p>
<dl>
<dt><code>directory</code></dt>
<dd>Directory in which the given <code>callback</code> should be executed (string)
</dd>
<dt><code>callback</code></dt>
<dd>Action to execute in the given directory (function)
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>The result(s) of the call to <code>callback</code></li>
</ul>
<h1 id="module-pandoc.types">Module pandoc.types</h1>
<p>Constructors for types which are not part of the pandoc AST.</p>
<h3 id="pandoc.types.version">Version</h3>
<p><code>Version (version_specifier)</code></p>
<p>Creates a Version object.</p>
<p>Parameters:</p>
<dl>
<dt><code>version_specifier</code>:</dt>
<dd>Version specifier: this can be a version string like <code>'2.7.3'</code>, a list of integers like <code>{2, 7, 3}</code>, a single integer, or a <a href="#type-version">Version</a>.
</dd>
</dl>
<p>Returns:</p>
<ul>
<li>A new <a href="#type-version">Version</a> object.</li>
</ul>
</body>
</html>
